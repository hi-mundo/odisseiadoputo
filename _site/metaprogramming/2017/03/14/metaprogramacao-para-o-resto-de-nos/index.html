<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento ‚Äî artigos, tutoriais e opini√£o.">

    <title>Metaprograma√ß√£o para o resto de n√≥s - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Metaprograma√ß√£o para o resto de n√≥s</h1>
                        
                        <h2 class="subheading">Pare de escrever boilerplate</h2>
                        
                        <span class="meta">Postado por Francesco Perrotti-Garcia em 14/03/2017</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Metaprograma√ß√£o para o resto de n√≥s&url=http://localhost:4000/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>Francesco Perrotti-Garcia (<a href="https://twitter.com/fpg1503" target="_blank">@fpg1503</a>) √© desenvolvedor iOS. Atualmente trabalha na <a href="https://www.moobie.com.br" target="_blank">Moobie</a>, j√° trabalhou em aplicativos como PlayKids, iFood e SpoonRocket. Programa desde os 12 anos e nos √∫ltimos 6 est√° cada vez mais pr√≥ximo do desenvolvimento iOS. Swift mudou sua maneira de ver o mundo e at√© de como programar em Objective-C. Adora gatos e nas horas vagas gosta de viajar, cozinhar e tirar fotos. üê•</p>
</blockquote>

<h1 id="o-que-√©">O Que √©?</h1>
<p>Metaprograma√ß√£o √© uma palvara dif√≠cil simplesmente para dizer <em>programas que manipulam programas</em>. Especificamente neste artigo iremos falar sobre programas que escrevem programas (gera√ß√£o de c√≥digo).</p>

<h1 id="por-que-fazer">Por que fazer?</h1>
<p>Voc√™ j√° se deparou copiando e colando c√≥digo ou ent√£o fazendo um c√≥digo extremamente verboso, com pouco signficado e propenso a erros? J√° copiou e colou a chave errada ao serializar um JSON? J√° consertou um bug em um lugar do c√≥digo e depois descobriu que aquela trecho estava replicado por v√°rios lugares e teve que sair ca√ßando eles por a√≠?</p>

<p>Para mim programar √© criar abstra√ß√µes de problemas do mundo real e metaprograma√ß√£o √© <strong>a arte de abstrair uma abstra√ß√£o</strong>.
Ao usar metaprograma√ß√£o voc√™ escreve menos c√≥digo repetitivo e, com isso, menos bugs.</p>

<h1 id="sourcery">Sourcery</h1>
<p><a href="https://github.com/krzysztofzablocki/Sourcery">Sourcery</a> √© uma ferramenta open source mantida pelo <a href="https://github.com/krzysztofzablocki">Krzysztof Zab≈Çocki</a> que alavanca metaprograma√ß√£o em Swift usando templates. N√£o se preocupe, vou explicar o que isso significa nos pr√≥ximos par√°grafos.</p>

<h2 id="o-que-√©-um-template">O que √© um <em>template</em>?</h2>
<p><em>Template</em> √© uma palavra em ingl√™s que pode ser traduzida como <strong>modelo</strong> ou <strong>gabarito</strong>. Imagine um template como um cortador de biscoitos, algo que d√° forma ao que √© colocado dentro, <strong>voc√™ pode usar um cortador de biscoitos em massinha de crian√ßas mas isso n√£o vai transform√°-la em biscoito</strong>.
<img src="/img/fpg1503/template.jpg" /></p>

<h2 id="por-que-templates">Por que <em>templates</em>?</h2>
<p>A magia dos templates √© desacoplar o formato da implementa√ß√£o de fato. Quando tempos um formato que diz como algo vai ser implementado basta mudar um lugar (o template) e a mudan√ßa √© propagada. Al√©m disso podemos fazer templates para diferentes vers√µes da linguagem ou at√© mesmo para diferentes linguagens!</p>

<h2 id="stencil">Stencil</h2>
<p><a href="http://github.com/kylef/Stencil">Stencil</a> √© uma linguagem de templates para Swift criada e mantida pelo <a href="https://github.com/kylef">Kyle Fuller</a>, a ideia √© criar uma maneira de expressar a apresenta√ß√£o de algo. Farei uma introdu√ß√£o r√°pida ao Stencil por√©m encorajo voc√™ a dar uma lida na <a href="http://stencil.fuller.li">documenta√ß√£o oficial</a>!</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">{{ ... }}</code>: imprime vari√°veis</li>
  <li><code class="language-plaintext highlighter-rouge">{% ... %}</code>: funciona para tags (mais sobre elas abaixo)</li>
</ul>

<h2 id="tags">Tags</h2>
<p>As duas tags mais importantes s√£o <code class="language-plaintext highlighter-rouge">for</code> e <code class="language-plaintext highlighter-rouge">if</code>:</p>

<h3 id="for"><code class="language-plaintext highlighter-rouge">for</code></h3>
<p>Suponhamos que h√° uma lista de usu√°rios (chamada <code class="language-plaintext highlighter-rouge">users</code>) e queremos listar todos eles um embaixo do outro:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for user in users %}
{{ user.name }}
{% endfor %}</code></pre></figure>

<p>Al√©m disso podemos usar a tag <code class="language-plaintext highlighter-rouge">empty</code> para lidar com listas vazias:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for user in users %}
{{ user.name }}
{% empty %}
N√£o h√° usu√°rios :(
{% endfor %}</code></pre></figure>

<p>E por final temos √† nossa disposi√ß√£o o contexto <code class="language-plaintext highlighter-rouge">forloop</code> que possui tr√™s vari√°veis:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">first</code>: boleano que indica se √© a primeira itera√ß√£o do loop</li>
  <li><code class="language-plaintext highlighter-rouge">last</code>: boleano que indica se √© a √∫ltima itera√ß√£o do loop</li>
  <li><code class="language-plaintext highlighter-rouge">counter</code>: itera√ß√£o atual do loop</li>
</ul>

<h3 id="if"><code class="language-plaintext highlighter-rouge">if</code></h3>
<p>O <code class="language-plaintext highlighter-rouge">if</code> avalia uma vari√°vel para verdadeira se um dos abaixo for v√°lido:</p>
<ul>
  <li>presente no contexto</li>
  <li>cole√ß√µes: n√£o vazias</li>
  <li>boleano: verdadeiro</li>
  <li>n√∫mero: maior que zero</li>
  <li>string: n√£o vazia</li>
</ul>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% if users.count == 42 and users.first.name == "Admin" %}
Lista de usu√°rios interessante
{% else %}
Lista de usu√°rios padr√£o
{% endif %}</code></pre></figure>

<h3 id="filtros">Filtros</h3>
<p>Al√©m disso Stencil possui alguns filtros (e Sourcery adiciona outros bem interessantes):</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">capitalize</code>: deixa a primeira letra da string em caixa alta e as demais em caixa baixa (<code class="language-plaintext highlighter-rouge">Taylor Swift -&gt; Tayor swift</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">uppercase</code>: deixa todas as letras da string em caixa alta (<code class="language-plaintext highlighter-rouge">Taylor Swift -&gt; TAYLOR SWIFT</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">lowercase</code>: deixa todas as letras da string em caixa baixa (<code class="language-plaintext highlighter-rouge">Taylor Swift -&gt; taylor swift</code>)</li>
</ul>

<p>Filtros s√£o aplicados a uma vari√°vel usando o pipe (<code class="language-plaintext highlighter-rouge">|</code>), por exemplo: <code class="language-plaintext highlighter-rouge">Taylor Swift</code></p>

<p>H√° filtros que possuem par√¢metros, esses par√¢metros devem ser inclu√≠dos na forma <code class="language-plaintext highlighter-rouge">vari√°vel|filtro:par√¢metro</code>, um exemplo √© o filtro <code class="language-plaintext highlighter-rouge">join</code> em listas:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">// myList = ["Uma", "lista", "com", "v√°rias", "palavras"]
{{ myList|join:" ü•ë "}}
// Imprime "Uma ü•ë lista ü•ë com ü•ë v√°rias ü•ë palavras"</code></pre></figure>

<p>Al√©m disso podemos usar as e filtros <a href="https://github.com/krzysztofzablocki/Sourcery#custom-stencil-tags-and-filter">adicionadas pelo Sourcery</a> e nas √∫ltimas vers√µes voc√™ tamb√©m pode usar os <a href="https://github.com/SwiftGen/StencilSwiftKit">exportados pelo StencilSwfitKit</a>.</p>

<h3 id="anota√ß√µes">Anota√ß√µes</h3>
<p>Infelizmente Swift n√£o possui suporte a anota√ß√µes de c√≥digo, no entanto Sourcery traz uma alternativa para isso: coment√°rios com <code class="language-plaintext highlighter-rouge">/// sourcery</code>, veja o exemplo abaixo onde o <code class="language-plaintext highlighter-rouge">struct User</code> √© anotado <code class="language-plaintext highlighter-rouge">AutoEquatable</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">/// sourcery: AutoEquatable</span>
<span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Falaremos mais de como aproveitar anota√ß√µes mais abaixo por√©m por enquanto √© interessante saber que podemos usar um filtro de Stencil (<code class="language-plaintext highlighter-rouge">annotated</code>) para encontrar apenas coisas anotadas, ou seja, se quisermos escrever algum c√≥digo apenas para todas as vari√°veis anotadas <code class="language-plaintext highlighter-rouge">AutoInject</code> entro de um tipo <code class="language-plaintext highlighter-rouge">type</code> far√≠amos assim:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for variable in type.variables|annotated:"AutoInject" %}
{{ variable }}
{% endfor %}</code></pre></figure>

<p>A beleza das anota√ß√µes serem inseridas em coment√°rios √© que c√≥digos anotados ainda s√£o c√≥digos Swift v√°lidos que compilam normalmente!</p>

<p><img src="/img/fpg1503/sourcerer.jpg" /></p>

<h2 id="instala√ß√£o">Instala√ß√£o</h2>

<p>Instalar o Sourcery √© muito simples e para brincar com ele √© interessante <a href="https://github.com/krzysztofzablocki/Sourcery/releases">baixar o bin√°rio</a> e usar. Por√©m, para us√°-lo dentro de projetos e garantir que todos est√£o na mesma vers√£o voc√™ pode usar CoocaPods ou Swift Package Manager:</p>

<h3 id="cocoapods">CocoaPods</h3>
<p>Simplesmente adicione <code class="language-plaintext highlighter-rouge">pod 'Sourcery'</code> na sua Podfile e <code class="language-plaintext highlighter-rouge">$PODS_ROOT/Sourcery/bin/sourcery {source} {templates} {output}</code> em uma Build Phase de Script.</p>

<h3 id="swift-package-manager">Swift Package Manager</h3>
<p>Adicione a depend√™ncia e rode <code class="language-plaintext highlighter-rouge">.build/debug/sourcery {source} {templates} {output}.</code></p>

<p>Para os exemplos a baixo eu recomendo que voc√™ tenha um bin√°rio preparado (na √∫ltima vers√£o) e tr√™s arquivos:</p>

<ul>
  <li>Input.swift</li>
  <li>Template.stencil</li>
  <li>Output.swift</li>
</ul>

<p>Eu sempre fa√ßo assim e crio um Script em shell para facilitar minha vida, seu conte√∫do √© somente:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">sourcery Input.swift Template.stencil Output.swift <span class="nt">--watch</span></code></pre></figure>

<p>Note que a flag <code class="language-plaintext highlighter-rouge">--watch</code> acompanha seus arquivos e automaticamente regera a sa√≠da baseado nas mudan√ßas, √© m√°gico! Note que para isso funcionar eu tenho o sourcery na minha <code class="language-plaintext highlighter-rouge">PATH</code>, caso voc√™ n√£o tenha ser√° necess√°rio fornecer o caminho para o bin√°rio.</p>

<h2 id="editores-de-texto">Editores de texto</h2>
<p>Para poder acompanhar as mudan√ßas em tempo real aconselho que voc√™ divida sua tela em duas partes: c√≥digo sendo editado (template/fonte) e sa√≠da gerada automaticamente. Usando a flag <code class="language-plaintext highlighter-rouge">--watch</code> que comentei acima basta salvar o arquivo que as mudan√ßas s√£o refletidas automaticamente</p>

<h3 id="sublime-text"><em>Sublime Text</em></h3>
<p>Infelizmente o Sublime Text n√£o atualiza arquivos abertos automaticamente quando h√° mudan√ßas no disco ent√£o n√£o recomendo o uso dele. Voc√™ poderia instalar algum plugin para isso por√©m a falta dessa feature inviabiliza o uso dele junto para visualizar mudan√ßas automaticamente.</p>

<h3 id="atom"><em>Atom</em></h3>
<p>O Atom funciona incrivelmente bem para isso, al√©m de permitir que voc√™ divida sua tela em v√°rios panes em sentidos diferentes simult√¢neamente!
<img src="/img/fpg1503/atom.gif" /></p>

<h3 id="vscode"><em>VSCode</em></h3>

<p>Gosto muito do Visual Studio Code por√©m ele possui a limita√ß√£o de s√≥ permitir a divis√£o em panes em um sentido (s√≥ vertical ou s√≥ horizontal). Esse n√£o √© um grande limitador para mim ent√£o costuma usar o VSCode com metade mostrando o c√≥digo/template (2 abas) e a outra metade mostrando o c√≥digo gerado.
<img src="/img/fpg1503/vscode.gif" /></p>

<h1 id="casos-de-uso">Casos de Uso</h1>
<p>Para todos os exemplos abaixo farei implementa√ß√µes simples, elas n√£o cobrem todos os casos por√©m estar√° explicito em quais casos elas funcionam e uma refer√™ncia para uma implementa√ß√£o que lida com todos os <em>edge cases</em> (caso ela exista).
Nem sempre √© necess√°rio fazer um c√≥digo ultra-complexo que cobre todos os casos poss√≠veis e imagin√°veis, com metaprograma√ß√£o voc√™ pode come√ßar com um template que cumpra suas necessiades e ir evoluindo-o com o passar do tempo.</p>

<h2 id="equatable"><code class="language-plaintext highlighter-rouge">Equatable</code></h2>
<p>Uma maneira simples de pensar em igualdade de tipos concretos √©: todas as suas propriedades n√£o computadas devem ser iguais. Essa implementa√ß√£o n√£o lida com: Optionals, Enums, Arrays, Heran√ßa. Exemplo de implementa√ß√£o mais completa: <a href="https://github.com/krzysztofzablocki/Sourcery/blob/master/Templates/AutoEquatable.stencil">AutoEquatable</a>.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for type in types.implementing.AutoEquatable %}
extension {{ type.name }}: Equatable {}
{{ type.accessLevel }} func == (lhs: {{ type.name }}, rhs: {{ type.name }}) -&gt; Bool {
    {% for variable in type.storedVariables %}
    guard lhs.{{ variable.name }} == rhs.{{ variable.name }} else { return false }
    {% endfor %}
    return true
}
{% endfor %}</code></pre></figure>

<p>Para o <code class="language-plaintext highlighter-rouge">struct User</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">AutoEquatable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Foi gerado o c√≥digo:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{}</span>
<span class="kd">internal</span> <span class="kd">func</span> <span class="o">==</span> <span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">User</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="n">lhs</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
    <span class="k">guard</span> <span class="n">lhs</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
    <span class="k">guard</span> <span class="n">lhs</span><span class="o">.</span><span class="n">email</span> <span class="o">==</span> <span class="n">rhs</span><span class="o">.</span><span class="n">email</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span> <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="p">}</span></code></pre></figure>

<h2 id="autoinjectable"><code class="language-plaintext highlighter-rouge">AutoInjectable</code></h2>
<p>Imagine que voc√™ possui um <code class="language-plaintext highlighter-rouge">struct</code> com diversas propriedades por√©m quer que algumas delas sejam injetadas automaticamente e n√£o quer perder o construtor que voc√™ ganhou, podemos para isso inserir uma anota√ß√£o <code class="language-plaintext highlighter-rouge">AutoInjectable</code>, nosso <code class="language-plaintext highlighter-rouge">struct</code> ficaria assim:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">ApiService</span><span class="p">:</span> <span class="kt">AutoInjectable</span> <span class="p">{</span>

    <span class="c1">/// sourcery: AutoInject</span>
    <span class="k">let</span> <span class="nv">requestManager</span><span class="p">:</span> <span class="kt">RequestManager</span>
    <span class="c1">/// sourcery: AutoInject</span>
    <span class="k">let</span> <span class="nv">sessionManager</span><span class="p">:</span> <span class="kt">SessionManager</span>
    
    <span class="k">let</span> <span class="nv">baseURL</span><span class="p">:</span> <span class="kt">URL</span>
    <span class="k">let</span> <span class="nv">serviceName</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Podemos escrever um template assim:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for type in types.all.implementing:"AutoInjected" %}
extension {{type.name}} {
    convenience init({% for variable in type.variables|instance|!annotated:"AutoInject" %}{{variable.name}}: {{variable.typeName}}{% if not forloop.last %}, {% endif %}{% endfor %}) {
    {% for variable in type.variables|instance|stored|annotated:"AutoInject" %}
        let {{variable.name}}: {{variable.typeName}} = try! autoInject()
    {% endfor %}
        init({% for variable in type.variables %}{{variable.name}}: {{variable.name}}{% if not forloop.last %}, {% endif %}{% endfor %})
}

{% endfor %}

func autoInject<span class="nt">&lt;T&gt;</span>() throws -&gt; T {
    //TODO: Sua l√≥gica de inje√ß√£o de depend√™ncias aqui!
}</code></pre></figure>

<p>C√≥digo gerado:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">ApiService</span> <span class="p">{</span>
    <span class="kd">convenience</span> <span class="nf">init</span><span class="p">(</span><span class="nv">baseURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">serviceName</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">requestManager</span><span class="p">:</span> <span class="kt">RequestManager</span> <span class="o">=</span> <span class="k">try!</span> <span class="nf">autoInject</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">sessionManager</span><span class="p">:</span> <span class="kt">SessionManager</span> <span class="o">=</span> <span class="k">try!</span> <span class="nf">autoInject</span><span class="p">()</span>
        <span class="nf">init</span><span class="p">(</span><span class="nv">requestManager</span><span class="p">:</span> <span class="n">requestManager</span><span class="p">,</span> <span class="nv">sessionManager</span><span class="p">:</span> <span class="n">sessionManager</span><span class="p">,</span> <span class="nv">baseURL</span><span class="p">:</span> <span class="n">baseURL</span><span class="p">,</span> <span class="nv">serviceName</span><span class="p">:</span> <span class="n">serviceName</span><span class="p">)</span>
<span class="p">}</span>


<span class="kd">func</span> <span class="n">autoInject</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">()</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">T</span> <span class="p">{</span>
    <span class="c1">//TODO: Sua l√≥gica de inje√ß√£o de depend√™ncias aqui!</span>
<span class="p">}</span></code></pre></figure>

<p>No exemplo acima somente criamos um construtor de conveni√™ncia que chama nossa fun√ß√£o capaz de prover depend√™ncias e junta isso com os par√¢metros n√£o injetados numa chamada para o construtor designado.</p>

<h2 id="desserializa√ß√£o-de-jsons">Desserializa√ß√£o de JSONs</h2>
<p>Para desserializa√ß√£o de JSONs usaremos o protocolo <code class="language-plaintext highlighter-rouge">JsonCreatable</code> que consiste de coisas que podem ser criadas a partir de um dicion√°rio:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">JsonCreatable</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">?(</span><span class="nv">json</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span>
<span class="p">}</span></code></pre></figure>

<p>Nesse caso assumiremos que todas as propriedades n√£o <code class="language-plaintext highlighter-rouge">Optional</code> s√£o obrigat√≥rias, que todas as vari√°veis sem um nome pr√©-definido tem seu pr√≥prio nome no JSON e n√£o lidamos com tipos diferentes de N√∫meros, Strings e Booleanos.</p>

<p>Nosso <code class="language-plaintext highlighter-rouge">struct</code>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">AutoJsonCreatable</span> <span class="p">{</span>
    <span class="c1">/// sourcery: JsonName = "fullName"</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">favoriteNumber</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">isCool</span><span class="p">:</span> <span class="kt">Bool</span>
    <span class="k">let</span> <span class="nv">numberOfTaylorSwiftAlbums</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">favoriteQuote</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
<span class="p">}</span></code></pre></figure>

<p>Template:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for type in types.all.implementing:"AutoJsonCreatable" %}
extension {{type.name}}: JsonCreatable {
    init?(json: [String: Any]) {
        {% for variable in type.variables|instance|stored %}
        {% ifnot variable.isOptional %}guard {% endif %}let {{variable.name}} = json["{{variable.annotations.JsonName|default:variable.name}}"] as? {{variable.unwrappedTypeName}}{% ifnot variable.isOptional %} else { return nil }{% endif %}
        {% endfor %}

        {% for variable in type.variables|instance|stored %}
        self.{{variable.name}} = {{variable.name}}
        {% endfor %}
    }
}
{% endfor %}</code></pre></figure>

<p>C√≥digo gerado:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">JsonCreatable</span> <span class="p">{</span>
    <span class="nf">init</span><span class="p">?(</span><span class="nv">json</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"fullName"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">favoriteNumber</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"favoriteNumber"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">isCool</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"isCool"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Bool</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">numberOfTaylorSwiftAlbums</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"numberOfTaylorSwiftAlbums"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">favoriteQuote</span> <span class="o">=</span> <span class="n">json</span><span class="p">[</span><span class="s">"favoriteQuote"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span>

        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">self</span><span class="o">.</span><span class="n">favoriteNumber</span> <span class="o">=</span> <span class="n">favoriteNumber</span>
        <span class="k">self</span><span class="o">.</span><span class="n">isCool</span> <span class="o">=</span> <span class="n">isCool</span>
        <span class="k">self</span><span class="o">.</span><span class="n">numberOfTaylorSwiftAlbums</span> <span class="o">=</span> <span class="n">numberOfTaylorSwiftAlbums</span>
        <span class="k">self</span><span class="o">.</span><span class="n">favoriteQuote</span> <span class="o">=</span> <span class="n">favoriteQuote</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>A beleza de usarmos templates √© que n√£o precisamos nos limitar a Swfit! Imagine que seu colega Android vai ter que implementar tudo de novo ent√£o voc√™ poderia escrever um template para ele!</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for type in types.all.implementing:"AutoJsonCreatable" %}
package com.equinocios.{{type.name}};

import com.google.gson.annotations.SerializedName;

import java.io.Serializable;

public class {{type.name}} implements Serializable {

    {% for variable in type.variables|instance|stored %}
    @SerializedName("{{variable.annotations.JsonName|default:variable.name}}")
    private {{variable.unwrappedTypeName}} {{variable.name}} = null;

    {% endfor %}

    {% for variable in type.variables|instance|stored %}
    public {{variable.unwrappedTypeName}} get{{variable.name|swiftIdentifier}}({{variable.unwrappedTypeName}} {{variable.name}}) {
        return {{variable.name}};
    } 

    public void set{{variable.name|swiftIdentifier}}({{variable.unwrappedTypeName}} {{variable.name}}) {
        this.{{variable.name}} = {{variable.name}};
    }

    {% endfor %}
}
{% endfor %}</code></pre></figure>

<p>Esse template gera o c√≥digo abaixo:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="nn">com.equinocios.User</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.gson.annotations.SerializedName</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"fullName"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"favoriteNumber"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Int</span> <span class="n">favoriteNumber</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"isCool"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Bool</span> <span class="n">isCool</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"numberOfTaylorSwiftAlbums"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Int</span> <span class="n">numberOfTaylorSwiftAlbums</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

    <span class="nd">@SerializedName</span><span class="o">(</span><span class="s">"favoriteQuote"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">favoriteQuote</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>


    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Int</span> <span class="nf">getFavoriteNumber</span><span class="o">(</span><span class="nc">Int</span> <span class="n">favoriteNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">favoriteNumber</span><span class="o">;</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFavoriteNumber</span><span class="o">(</span><span class="nc">Int</span> <span class="n">favoriteNumber</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">favoriteNumber</span> <span class="o">=</span> <span class="n">favoriteNumber</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Bool</span> <span class="nf">getIsCool</span><span class="o">(</span><span class="nc">Bool</span> <span class="n">isCool</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">isCool</span><span class="o">;</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setIsCool</span><span class="o">(</span><span class="nc">Bool</span> <span class="n">isCool</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isCool</span> <span class="o">=</span> <span class="n">isCool</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Int</span> <span class="nf">getNumberOfTaylorSwiftAlbums</span><span class="o">(</span><span class="nc">Int</span> <span class="n">numberOfTaylorSwiftAlbums</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">numberOfTaylorSwiftAlbums</span><span class="o">;</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setNumberOfTaylorSwiftAlbums</span><span class="o">(</span><span class="nc">Int</span> <span class="n">numberOfTaylorSwiftAlbums</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">numberOfTaylorSwiftAlbums</span> <span class="o">=</span> <span class="n">numberOfTaylorSwiftAlbums</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFavoriteQuote</span><span class="o">(</span><span class="nc">String</span> <span class="n">favoriteQuote</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">favoriteQuote</span><span class="o">;</span>
    <span class="o">}</span> 

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFavoriteQuote</span><span class="o">(</span><span class="nc">String</span> <span class="n">favoriteQuote</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">favoriteQuote</span> <span class="o">=</span> <span class="n">favoriteQuote</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>Lindo, n√£o? O √∫nico problema √© que o c√≥digo acima n√£o compila pois os tipos que usamos tem nomes diferentes em Java, poder√≠amos criar um <a href="https://github.com/kylef/Stencil/blob/master/docs/custom-template-tags-and-filters.rst">filtro customizado do Stencil</a> (provavelmente chamado <code class="language-plaintext highlighter-rouge">javaTypeName</code>) que fizesse essa convers√£o. O ponto deste exemplo √© mostrar o qu√£o flex√≠vel templates nos permitem ser!</p>

<h2 id="cliente-http">Cliente HTTP</h2>
<p>Como exemplo final vamos fazer um pequeno cliente HTTP de uma API Rest.</p>

<p>Dado uma interface da API (expressa em um protocol) queremos produzir uma implementa√ß√£o concreta.
Para fazer isso usaremos o fato de que Sourcery copia o que inserimos dentro das anota√ß√µes para nosso c√≥digo. Usaremos dicion√°rios de Swift para simular anota√ß√µes de par√¢metros.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">public</span> <span class="kd">protocol</span> <span class="kt">GitHubService</span><span class="p">:</span> <span class="kt">AutoImplementable</span> <span class="p">{</span>
  <span class="c1">/// sourcery: GET = "users/{user}/repos"</span>
  <span class="c1">/// sourcery: Path = ["user": user]</span>
  <span class="kd">func</span> <span class="nf">listRepos</span><span class="p">(</span><span class="k">for</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">test</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">Completion</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repo</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Cancelable</span>

  <span class="c1">/// sourcery: GET = "group/{id}/users"</span>
  <span class="c1">/// sourcery: Path = ["id": groupId]</span>
  <span class="kd">func</span> <span class="nf">groupList</span><span class="p">(</span><span class="k">for</span> <span class="nv">groupId</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">Completion</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">User</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Cancelable</span>
<span class="p">}</span></code></pre></figure>

<p>Usando o template:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">{% for protocol in types.protocols.implementing:"AutoImplementable" %}
struct {{protocol.name}}Implementation: {{protocol.name}} {
	{% for method in protocol.methods %}
	func {{method.name}} -&gt; {{method.returnTypeName}} {
		let httpMethod: HTTPMethod = .{% if method.annotations.GET %}get{% endif %}{% if method.annotations.POST %}post{% endif %}{% if method.annotations.PUT %}put{% endif %}{% if method.annotations.DELETE %}delete{% endif %}
		let rawPath = "{{method.annotations.GET}}{{method.annotations.PUT}}{{method.annotations.POST}}{{method.annotations.DELETE}}"
		let rawQuery: [String: Any] = {% ifnot method.annotations.Query %}[:]{% endif %}{{method.annotations.Query}}

		let path = rawPath.expanded(using: {% ifnot method.annotations.Path %}[:]{% endif %}{{method.annotations.Path}})
		let pathAndQuery = path.adding(rawQuery)

		return request(httpMethod, path: path, completion: completion)
	}

	{% endfor %}
}
{% endfor %}</code></pre></figure>

<p>O c√≥digo gerado neste caso √©:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">GitHubServiceImplementation</span><span class="p">:</span> <span class="kt">GitHubService</span> <span class="p">{</span>
	<span class="kd">func</span> <span class="nf">listRepos</span><span class="p">(</span><span class="k">for</span> <span class="nv">user</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">Completion</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repo</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Cancelable</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">httpMethod</span><span class="p">:</span> <span class="kt">HTTPMethod</span> <span class="o">=</span> <span class="o">.</span><span class="k">get</span>
		<span class="k">let</span> <span class="nv">rawPath</span> <span class="o">=</span> <span class="s">"users/{user}/repos"</span>
		<span class="k">let</span> <span class="nv">rawQuery</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>

		<span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="n">rawPath</span><span class="o">.</span><span class="nf">expanded</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="p">[</span><span class="s">"user"</span><span class="p">:</span> <span class="n">user</span><span class="p">])</span>
		<span class="k">let</span> <span class="nv">pathAndQuery</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="nf">adding</span><span class="p">(</span><span class="n">rawQuery</span><span class="p">)</span>

		<span class="k">return</span> <span class="nf">request</span><span class="p">(</span><span class="n">httpMethod</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="n">completion</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="kd">func</span> <span class="nf">groupList</span><span class="p">(</span><span class="k">for</span> <span class="nv">groupId</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">Completion</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">User</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Cancelable</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">httpMethod</span><span class="p">:</span> <span class="kt">HTTPMethod</span> <span class="o">=</span> <span class="o">.</span><span class="k">get</span>
		<span class="k">let</span> <span class="nv">rawPath</span> <span class="o">=</span> <span class="s">"group/{id}/users"</span>
		<span class="k">let</span> <span class="nv">rawQuery</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:]</span>

		<span class="k">let</span> <span class="nv">path</span> <span class="o">=</span> <span class="n">rawPath</span><span class="o">.</span><span class="nf">expanded</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="p">[</span><span class="s">"id"</span><span class="p">:</span> <span class="n">groupId</span><span class="p">])</span>
		<span class="k">let</span> <span class="nv">pathAndQuery</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="nf">adding</span><span class="p">(</span><span class="n">rawQuery</span><span class="p">)</span>

		<span class="k">return</span> <span class="nf">request</span><span class="p">(</span><span class="n">httpMethod</span><span class="p">,</span> <span class="nv">path</span><span class="p">:</span> <span class="n">path</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="n">completion</span><span class="p">)</span>
	<span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>Repare como utilizamos os dicion√°rios para mapear <code class="language-plaintext highlighter-rouge">String</code>s para valores espec√≠ficos que ser√£o passados para a fun√ß√£o, por isso nosso dicion√°rio tem o formato <code class="language-plaintext highlighter-rouge">["chave": valor]</code>, fazendo isso teremos uma garantia em tempo de compila√ß√£o de que os valores utilizados existem.</p>

<p>Cabe ressaltar n√£o √© poss√≠vel acessar dentro do template as anotea√ß√µes dos campos indvidualmente por√©m isso n√£o √© um problema pois temos uma extens√£o que permite expandir <code class="language-plaintext highlighter-rouge">String</code>s usando dicion√°rios. Al√©m disso o c√≥digo gerado conta com outras abstra√ß√µes como a fun√ß√£o gen√©rica <code class="language-plaintext highlighter-rouge">request</code>, a closure gen√©rica <code class="language-plaintext highlighter-rouge">Completion</code>, o <code class="language-plaintext highlighter-rouge">enum HTTPMethod</code> e o protocolo <code class="language-plaintext highlighter-rouge">Cancelable</code>, o c√≥digo dessas abstra√ß√µes n√£o ser√° incluso para manter o artigo sucinto por√©m elas podem facilmente ser subistitu√≠das por outras de sua prefer√™ncia.</p>

<h1 id="mais-sobre-sourcery">Mais sobre Sourcery</h1>
<p>Al√©m de Stencil o Sourcery tamb√©m permite o uso de <a href="https://github.com/krzysztofzablocki/Sourcery/blob/master/SourceryTests/Stub/SwiftTemplates/Equality.swifttemplate">SwiftTemplates</a> e <a href="https://github.com/krzysztofzablocki/Sourcery/blob/master/SourceryTests/Stub/JavaScriptTemplates/Equality.js">templates em JavaScript</a>, usando o <a href="http://ejs.co">EJS</a>.</p>

<p>Para saber mais soubre Sourcery d√™ uma lida no <a href="https://github.com/krzysztofzablocki/Sourcery">README do reposit√≥rio</a>, que cont√©m mais informa√ß√µes sobre o que pode ser extra√≠do de cada tipo e detalhes sobre como especificar o local de armazenamento do c√≥digo gerado.</p>

<h1 id="outras-ferramentas">Outras ferramentas</h1>
<p>Para trabalhar com Strings localizadas, Cores, Imagens, Storyboards e Fontes use o <a href="https://github.com/SwiftGen/SwiftGen">SwiftGen</a>, uma ferramenta para gerar c√≥digo e te ajudar a garantir (em tempo de compila√ß√£o) que os recursos sendo utilizados de fato existem. SwiftGen tamb√©m utiliza templates Stencil.</p>

<h1 id="em-suma">Em suma</h1>
<p>Metaprograma√ß√£o √© uma ferramenta muito poderosa pois permite que voc√™ escreva menos c√≥digo, c√≥digo mais expressivo. Sourcery √© uma ferramenta que faz com que voc√™ alavanque o sistema de tipos junto com o compilador para economizar tempo e reduzir potenciais erros. Al√©m disso voc√™ sempre pode usar mais metapgroma√ß√£o: Se perceber que h√° algo que se repete muito voc√™ pode fazer um programa que faz um programa que faz um programa.</p>

<p>E voc√™? Qual c√≥digo faz no dia-a-dia que √© repetitivo? Como voc√™ resolveu isso?</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/viper/2017/03/13/comecando-com-viper/" data-toggle="tooltip" data-placement="top" title="Come√ßando com VIPER">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/reativo/2017/03/16/Eu-preciso-reativar-minha-aplicacao/" data-toggle="tooltip" data-placement="top" title="Eu preciso reativar minha aplica√ß√£o?">Pr√≥ximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto ‚Äî Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
