<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento ‚Äî artigos, tutoriais e opini√£o.">

    <title>Persist√™ncia de dados usando Core Data - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/banco%20de%20dados/2017/03/30/persistencia-de-dados-usando-core-data/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Persist√™ncia de dados usando Core Data</h1>
                        
                        <h2 class="subheading">Uma introdu√ß√£o de como persistir dados no iOS usando o framework nativo</h2>
                        
                        <span class="meta">Postado por Douglas Taquary em 30/03/2017</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Persist√™ncia de dados usando Core Data&url=http://localhost:4000/banco%20de%20dados/2017/03/30/persistencia-de-dados-usando-core-data/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/banco%20de%20dados/2017/03/30/persistencia-de-dados-usando-core-data/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/banco%20de%20dados/2017/03/30/persistencia-de-dados-usando-core-data/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/banco%20de%20dados/2017/03/30/persistencia-de-dados-usando-core-data/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>Ol√° pessoal, esse √© meu primeiro artigo aqui no EquinociOS e ent√£o farei uma breve apresenta√ß√£o.
 Me chamo <a href="https://twitter.com/bluesprogrammer">Douglas Taquary</a> sou desenvolvedor iOS um pouco mais de 3 anos, fundador e l√≠der do Cocoaheads Teresina desde de 2015, nasci e me criei dentro da eletr√¥nica do meu <a href="https://www.facebook.com/profile.php?id=100009371490482&amp;fref=ts">Pai</a> üì∫üîåüîß por isso a paix√£o tamb√©m por IoT, eletr√¥nica e seus derivados. Sou <a href="https://www.youtube.com/watch?v=J0imW0Xu6nY">guitarrista</a> (apesar de n√£o estar mais na atividade j√° algum tempo, somente vez ou outra), sou f√£ de blues, Jimi Hendrix,  e gosto de beber cerva e cozinhar ao mesmo tempo.
Feita essa introdu√ß√£o, vamos nessa: <strong>Core Data</strong>!</p>
</blockquote>

<h2 id="motiva√ß√£o">Motiva√ß√£o</h2>

<p>H√° uns dois meses me deparei com uma situa√ß√£o em que precisaria persistir dados em um aplicativo. Eu nunca fui muito f√£ de trabalhar com banco de dados, talvez por experi√™ncias anteriores ou por causa de v√°rias configura√ß√µes chatas que voc√™ tem que fazer pra deixar tudo funcionando.
Acredito que em determinadas tecnologias, n√£o era eu ou voc√™ quem deveria estar fazendo esse tipo de configura√ß√£o(<em>o framework ou qualquer outra coisa que voc√™ esteja usando</em>) tem que deixar tudo pronto somente para voc√™ ir l√° e usar. Devo me preocupar com minha l√≥gica de neg√≥cios, que no momento √© o mais importante.</p>

<p>Bom, mas o jeito foi engolir o choro. ¬Ø\_(„ÉÑ)_/¬Ø</p>

<h2 id="o-que-√©-o-core-data">O que √© o Core Data</h2>

<p>O <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/index.html?utm_source=iosstash.io">CoreData</a> √© um framework nativo como qualquer outro da <strong>Apple</strong>: <em>UIKit, Foundation</em> e alguns outros. Ele √© usado para persistir, manipular dados no iOS/OSX e usa o <code class="language-plaintext highlighter-rouge">SQLite</code> por baixo dos panos, mas voc√™ n√£o precisar saber <code class="language-plaintext highlighter-rouge">SQL</code> para us√°-lo, ele interage com o <em>sql</em> sem voc√™ ver ou precisar saber o que est√° acontecendo.
Usamos o esquema de <em>key/value</em> para acessar nossos objetos persistidos.</p>

<p>Algumas de v√°rias caracter√≠sticas que esse framework possui:</p>

<ul>
  <li>Gerenciamento e manipula√ß√£o de objetos(CRUD)</li>
  <li>Buscas sofisticadas. Em vez de escrever SQL, voc√™ pode criar consultas complexas associando um objeto <em>NSPredicate</em> a uma solicita√ß√£o de busca.</li>
  <li>Ferramentas de migra√ß√£o de esquema</li>
  <li>Filtragem e gerenciamento de dados na mem√≥ria e na interface de usu√°rio</li>
  <li>Controle de vers√£o</li>
</ul>

<p>E v√°rias outras que voc√™ pode conferir <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/index.html?utm_source=iosstash.io">aqui</a>.</p>

<p>Sei que existem outras tecnologias <em>open source</em> como o <code class="language-plaintext highlighter-rouge">Realm</code>, que tamb√©m podem ser usadas para persistir dados no iOS e que podem ser adicionadas em seu projeto atrav√©s do <code class="language-plaintext highlighter-rouge">CocoaPods</code> ou via <code class="language-plaintext highlighter-rouge">m√≥dulo</code>. Mas n√£o √© o intuito desse artigo falar sobre pr√≥s e contras de tecnologias. Cabe a voc√™ escolher a tecnologia que faz sentido no seu projeto.</p>

<p>Bl√°, bl√°, bl√°‚Ä¶ ent√£o vamos l√°. üéâ</p>

<h2 id="explicando">Explicando</h2>

<p>H√° um tempo atr√°s, como eu falei, eu criei um <a href="https://github.com/douglastaquary/mymovies">app</a> para estudar o <strong>Core Data</strong>.</p>

<p><img src="/img/douglastaquary/mymovies.png" alt="" /></p>

<blockquote>
  <p>O c√≥digo do app ainda pode melhorar com algumas <em>refactors</em> .</p>
</blockquote>

<p>No app voc√™ pode inserir nomes de filmes favoritos, e pesquisar por eles atrav√©s de uma <em>API</em> chamada <a href="http://www.omdbapi.com">Open Movie Database</a>. A ideia √© salvar as informa√ß√µes sobre os filmes e poder v√™-las offline, aqui que o <em>framework entra em a√ß√£o</em>. Nosso foco √© somente o <em>Core Data</em>. ;)</p>

<h2 id="vamos-l√°">Vamos l√°</h2>

<p>Para poder usar o <em>Core Data</em> no seu projeto, √© necess√°rio habilit√°-lo no Xcode no momento que voc√™ esta criando um novo projeto, mas ele pode ser adicionado tamb√©m depois do projeto criado. Al√©m disso, basta fazer <code class="language-plaintext highlighter-rouge">import CoreData</code> do m√≥dulo nas suas classes e pronto. Isso ser√° uma das poucas configura√ß√µes que voc√™ precisar√° fazer para sair usando.</p>

<p><img src="/img/douglastaquary/start_coredata.png" alt="" /></p>

<p>Olha que maravilha?! Mais uma vez o <em>teorema do taquary</em> agindo: nosso trabalho n√£o √© configurar, √© usar, criar.. e bl√°, bl√°..</p>

<p>Com projeto criado, abrindo a sua class <code class="language-plaintext highlighter-rouge">AppDelegate.swift</code>, l√° no final do arquivo tem uma vari√°vel chamada <code class="language-plaintext highlighter-rouge">var persistentContainer: NSPersistentContainer</code>.
O Xcode cria essa implementa√ß√£o automaticamente. Ela √© basicamente o meio de acesso ao seu banco de dados dentro do Core Data. Ele retorna um <code class="language-plaintext highlighter-rouge">container</code> se seu banco de dados existe, caso contr√°rio ele retornar√° um erro, o seu app <code class="language-plaintext highlighter-rouge">crasha</code> e o Xcode imprime um <code class="language-plaintext highlighter-rouge">log</code> no console.</p>

<p>Somente isso que precisamos para criarmos nossas <code class="language-plaintext highlighter-rouge">queries</code>.</p>

<p>Com a chegada do <a href="">Swift 3</a> as coisas ficaram bem mais f√°ceis para se trabalhar com o <em>Core Data</em>. Menos c√≥digo e mais efici√™ncia. Como eu disse, deixa o framework cuidar de configura√ß√µes dele mesmo.</p>

<p>Para mostrar o quanto se trabalhar com <code class="language-plaintext highlighter-rouge">Core Data</code> depois do <code class="language-plaintext highlighter-rouge">Swift 3</code> melhorou eu tenho dois arquivos aqui que o <em>Xcode</em> gera no <code class="language-plaintext highlighter-rouge">AppDelegate</code>.</p>

<p>O primeiro com <strong>Swift 2</strong>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">applicationDocumentsDirectory</span><span class="p">:</span> <span class="kt">NSURL</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">urls</span> <span class="o">=</span> <span class="kt">NSFileManager</span><span class="o">.</span><span class="nf">defaultManager</span><span class="p">()</span><span class="o">.</span><span class="kt">URLsForDirectory</span><span class="p">(</span><span class="o">.</span><span class="kt">DocumentDirectory</span><span class="p">,</span> <span class="nv">inDomains</span><span class="p">:</span> <span class="o">.</span><span class="kt">UserDomainMask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">urls</span><span class="p">[</span><span class="n">urls</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">}()</span>

    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">managedObjectModel</span><span class="p">:</span> <span class="kt">NSManagedObjectModel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">modelURL</span> <span class="o">=</span> <span class="kt">NSBundle</span><span class="o">.</span><span class="nf">mainBundle</span><span class="p">()</span><span class="o">.</span><span class="kt">URLForResource</span><span class="p">(</span><span class="s">"DATAMODELNAME"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"momd"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">return</span> <span class="kt">NSManagedObjectModel</span><span class="p">(</span><span class="nv">contentsOfURL</span><span class="p">:</span> <span class="n">modelURL</span><span class="p">)</span><span class="o">!</span>
    <span class="p">}()</span>
        <span class="c1">// Create the coordinator and store</span>
        <span class="k">let</span> <span class="nv">coordinator</span> <span class="o">=</span> <span class="kt">NSPersistentStoreCoordinator</span><span class="p">(</span><span class="nv">managedObjectModel</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">managedObjectModel</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">applicationDocumentsDirectory</span><span class="o">.</span><span class="kt">URLByAppendingPathComponent</span><span class="p">(</span><span class="s">"PROJECTNAME.sqlite"</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">failureReason</span> <span class="o">=</span> <span class="s">"There was an error creating or loading the application's saved data."</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">coordinator</span><span class="o">.</span><span class="nf">addPersistentStoreWithType</span><span class="p">(</span><span class="kt">NSSQLiteStoreType</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span> <span class="kt">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="c1">// Report any error we got.</span>
            <span class="k">var</span> <span class="nv">dict</span> <span class="o">=</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">]()</span>
            <span class="n">dict</span><span class="p">[</span><span class="kt">NSLocalizedDescriptionKey</span><span class="p">]</span> <span class="o">=</span> <span class="s">"Failed to initialize the application's saved data"</span>
            <span class="n">dict</span><span class="p">[</span><span class="kt">NSLocalizedFailureReasonErrorKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">failureReason</span>

            <span class="n">dict</span><span class="p">[</span><span class="kt">NSUnderlyingErrorKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as</span> <span class="kt">NSError</span>
            <span class="k">let</span> <span class="nv">wrappedError</span> <span class="o">=</span> <span class="kt">NSError</span><span class="p">(</span><span class="nv">domain</span><span class="p">:</span> <span class="s">"YOUR_ERROR_DOMAIN"</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="mi">9999</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="n">dict</span><span class="p">)</span>
            <span class="kt">NSLog</span><span class="p">(</span><span class="s">"Unresolved error </span><span class="se">\(</span><span class="n">wrappedError</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">wrappedError</span><span class="o">.</span><span class="n">userInfo</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="nf">abort</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">coordinator</span>
    <span class="p">}()</span>

    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">managedObjectContext</span><span class="p">:</span> <span class="kt">NSManagedObjectContext</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// Returns the managed object context for the application (which is already bound to the persistent store coordinator for the application.) This property is optional since there are legitimate error conditions that could cause the creation of the context to fail.</span>
        <span class="k">let</span> <span class="nv">coordinator</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">persistentStoreCoordinator</span>
        <span class="k">var</span> <span class="nv">managedObjectContext</span> <span class="o">=</span> <span class="kt">NSManagedObjectContext</span><span class="p">(</span><span class="nv">concurrencyType</span><span class="p">:</span> <span class="o">.</span><span class="kt">MainQueueConcurrencyType</span><span class="p">)</span>
        <span class="n">managedObjectContext</span><span class="o">.</span><span class="n">persistentStoreCoordinator</span> <span class="o">=</span> <span class="n">coordinator</span>
        <span class="k">return</span> <span class="n">managedObjectContext</span>
    <span class="p">}()</span>
</code></pre></div></div>

<p>Com <strong>Swift 3</strong>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">persistentContainer</span><span class="p">:</span> <span class="kt">NSPersistentContainer</span> <span class="o">=</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">container</span> <span class="o">=</span> <span class="kt">NSPersistentContainer</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="s">"CoreData_app"</span><span class="p">)</span>
        <span class="n">container</span><span class="o">.</span><span class="nf">loadPersistentStores</span><span class="p">(</span><span class="nv">completionHandler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">storeDescription</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="k">as</span> <span class="kt">NSError</span><span class="p">?</span> <span class="p">{</span>
                <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Unresolved error </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">userInfo</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="n">container</span>
    <span class="p">}()</span>
</code></pre></div></div>

<p>Que diferen√ßa hein?! Pois √©‚Ä¶ imagina isso em Objective C?! üôèüèº</p>

<h2 id="criando-modelos">Criando modelos</h2>

<p>Outra coisa que podemos observar no nosso projeto, √© que temos um arquivo com extens√£o <code class="language-plaintext highlighter-rouge">.xcdatamodel</code> que no nosso caso, √© chamado <code class="language-plaintext highlighter-rouge">CoreData_app.xcdatamodel</code>.</p>

<p><img src="/img/douglastaquary/tree2x.png" alt="" /></p>

<p>Vamos analisar esse arquivo gerado, aqui criamos e gerenciamos nossas tabelas usando uma interface bem f√°cil e que poupa muito trabalho. Sem contar que quando voc√™ criar uma nova tabela <code class="language-plaintext highlighter-rouge">+ Add Entity</code> e popular com seus atributos, assim que voc√™ <code class="language-plaintext highlighter-rouge">buildar</code> seu projeto, o Xcode magicamente gera as classes referentes √† <em>estrutura/esquema/modelo</em> da sua tabela de dados criada. Olha que beleza 2! üèÑüèª</p>

<p><strong>Aqui os f√£s de geradores de c√≥digo piram</strong> üòÖ</p>

<blockquote>
  <p>O <em>Xcode</em> agora suporta a gera√ß√£o autom√°tica de subclasses de <code class="language-plaintext highlighter-rouge">NSManagedObject</code> na ferramenta de modelagem.</p>
</blockquote>

<p>Inspetor de entidade:</p>

<p><img src="/img/douglastaquary/coredata_panel.png" alt="" /></p>

<h2 id="o-mito-do-app-delegate">O Mito do App Delegate</h2>

<p>J√° √© de costume os <code class="language-plaintext highlighter-rouge">devs</code> deixarem esse c√≥digo onde Xcode o cria. Algo como: eu n√£o vou nem tocar para n√£o quebrar‚Ä¶ Isso √© <strong>MITO</strong>!!üòÖ
O melhor que voc√™ faz √© tirar essa implementa√ß√£o do <code class="language-plaintext highlighter-rouge">AppDelegate</code> e criar algo como <code class="language-plaintext highlighter-rouge">DataManager.swift</code> e colar ele l√°.</p>

<h2 id="nsmanagedobject">NSManagedObject</h2>

<p>O <code class="language-plaintext highlighter-rouge">NSManagedObject</code> √© uma classe gen√©rica que implementa todo o comportamento b√°sico para um objeto no modelo que o Core Data espera. N√£o √© poss√≠vel usar inst√¢ncias de subclasses diretas de <code class="language-plaintext highlighter-rouge">NSObject</code> (ou qualquer outra classe que n√£o herde de <code class="language-plaintext highlighter-rouge">NSManagedObject</code>) com um contexto de um objeto gerenciado.
Voc√™ pode criar subclasses customizadas do <code class="language-plaintext highlighter-rouge">NSManagedObject</code>, embora isso nem sempre seja necess√°rio, como eu falei o framework ‚Äú<em>gera</em>‚Äù as classes refente as suas tabelas e propriedades.üç∫</p>

<h2 id="adicionar-dados">Adicionar Dados</h2>

<p>No app temos um tela para inserir t√≠tulos de filmes. Ent√£o, precisamos persistir um atributo <em>name</em> do tipo <code class="language-plaintext highlighter-rouge">String</code> na tabela <code class="language-plaintext highlighter-rouge">Title</code>. Para eu inserir essa informa√ß√£o, eu simplesmente carrego meu <code class="language-plaintext highlighter-rouge">persistentContainer</code> atrav√©s da minha classe <code class="language-plaintext highlighter-rouge">DataManager</code> no meu <code class="language-plaintext highlighter-rouge">ViewController</code></p>

<p><code class="language-plaintext highlighter-rouge">var dataManager = DataManager()</code></p>

<p>e implemento minha fun√ß√£o para inserir dados:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">func</span> <span class="nf">saveNameOfMovie</span><span class="p">(</span><span class="n">with</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">managedContext</span> <span class="o">=</span> <span class="n">dataManager</span><span class="o">.</span><span class="n">persistentContainer</span><span class="o">.</span><span class="n">viewContext</span>
        <span class="k">let</span> <span class="nv">entity</span> <span class="o">=</span> <span class="kt">NSEntityDescription</span><span class="o">.</span><span class="nf">entity</span><span class="p">(</span><span class="nv">forEntityName</span><span class="p">:</span> <span class="s">"Title"</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="n">managedContext</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">movie</span> <span class="o">=</span> <span class="kt">NSManagedObject</span><span class="p">(</span><span class="nv">entity</span><span class="p">:</span> <span class="n">entity</span><span class="p">,</span> <span class="nv">insertInto</span><span class="p">:</span> <span class="n">managedContext</span><span class="p">)</span>
        
        <span class="n">movie</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="s">"title"</span><span class="p">)</span>
        
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">try</span> <span class="n">managedContext</span><span class="o">.</span><span class="nf">save</span><span class="p">()</span>
            <span class="nf">didEnd</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">NSError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Could not save. </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">, </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">userInfo</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

</code></pre></div></div>

<p>Aqui n√≥s instanciamos nosso container usando o <code class="language-plaintext highlighter-rouge">managedContext</code>, depois pegamos a refer√™ncia da tabela(<em>voc√™ pode ter v√°rias tabelas</em>) com <code class="language-plaintext highlighter-rouge">entity</code> e criamos o objeto que ser√° persistido:</p>

<p><code class="language-plaintext highlighter-rouge">let name = NSManagedObject(entity: entity, insertInto: managedContext)</code></p>

<p>E a√≠ eu salvo de fato meu dado usando a func√£o <code class="language-plaintext highlighter-rouge">save()</code> padr√£o do framework.</p>

<p><code class="language-plaintext highlighter-rouge">try managedContext.save()</code></p>

<p>Tranquilo demais!</p>

<h2 id="nsfetchrequest">NSFetchRequest</h2>

<p><code class="language-plaintext highlighter-rouge">NSFetchRequest</code> √© um <em>tipo parametrizado</em> baseado no novo protocolo <code class="language-plaintext highlighter-rouge">NSFetchRequestResult</code> adicionado no <em>Swift 3</em>. As principais <em>APIs do Core Data</em> agora se referem a <code class="language-plaintext highlighter-rouge">NSFetchRequest</code> <em>parametrizado</em> no <code class="language-plaintext highlighter-rouge">Objective C</code> e no <code class="language-plaintext highlighter-rouge">Swift</code>.</p>

<p>Al√©m disso, no <code class="language-plaintext highlighter-rouge">Swift</code>, <code class="language-plaintext highlighter-rouge">NSManagedObjectContext</code> oferece variantes parametrizadas de <code class="language-plaintext highlighter-rouge">fetch(:)</code>, que antes do Swift 3 era chamado de <code class="language-plaintext highlighter-rouge">executeFetchRequest: error:</code>, e <code class="language-plaintext highlighter-rouge">count(:)</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">public</span> <span class="kd">func</span> <span class="n">fetch</span><span class="o">&lt;</span><span class="kt">T</span> <span class="p">:</span> <span class="kt">NSFetchRequestResult</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">NSFetchRequest</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="n">count</span><span class="o">&lt;</span><span class="kt">T</span> <span class="p">:</span> <span class="kt">NSFetchRequestResult</span><span class="o">&gt;</span><span class="p">(</span><span class="k">for</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">NSFetchRequest</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Int</span>

</code></pre></div></div>

<p>√â com ele que vamos recuperar nossos dados. üç∑</p>

<h2 id="listar-nossos-dados">Listar nossos dados</h2>

<p>Para a minha <code class="language-plaintext highlighter-rouge">tableview</code> mostrar meus registros de filmes favoritos √© mais simples ainda.</p>

<p>Para recuperar os dados persistidos, n√≥s usamos a inst√¢ncia de  <code class="language-plaintext highlighter-rouge">NSFetchRequest</code>, onde temos que passar o nome da tabela.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">loadData</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">fetchRequest</span> <span class="o">=</span> <span class="kt">NSFetchRequest</span><span class="o">&lt;</span><span class="kt">NSFetchRequestResult</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">entityName</span><span class="p">:</span> <span class="s">"Title"</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">context</span> <span class="o">=</span> <span class="n">dataManager</span><span class="o">.</span><span class="n">persistentContainer</span><span class="o">.</span><span class="n">viewContext</span>
        <span class="k">do</span><span class="p">{</span>
            <span class="k">let</span> <span class="nv">results</span> <span class="o">=</span> <span class="k">try</span> <span class="n">context</span><span class="o">.</span><span class="nf">fetch</span><span class="p">(</span><span class="n">fetchRequest</span><span class="p">)</span>
            <span class="n">namesOfMovies</span> <span class="o">=</span> <span class="n">results</span> <span class="k">as!</span> <span class="p">[</span><span class="kt">NSManagedObject</span><span class="p">]</span>
            <span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span><span class="k">catch</span><span class="p">{</span>
            <span class="nf">fatalError</span><span class="p">(</span><span class="s">"Error is retriving titles items"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<p>Depois eu chamo a func√£o <code class="language-plaintext highlighter-rouge">fetch()</code> usando o <code class="language-plaintext highlighter-rouge">context</code> e passando o <code class="language-plaintext highlighter-rouge">fetchRequest</code> como par√¢metro.</p>

<p>Dai √© s√≥ transformar o resultado da sua busca em uma <code class="language-plaintext highlighter-rouge">array</code> de <code class="language-plaintext highlighter-rouge">[NSManagedObject]</code>, nesse caso, atribu√≠do √† <em>vari√°vel</em> <code class="language-plaintext highlighter-rouge">namesOfMovies</code> e dar reload na <code class="language-plaintext highlighter-rouge">tableview</code>.</p>

<p>Ent√£o l√° na fun√ß√£o <code class="language-plaintext highlighter-rouge">cellForRowAt</code> da <code class="language-plaintext highlighter-rouge">tableView</code> eu consigo fazer isso:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cell</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">nameOfMovie</span><span class="o">.</span><span class="nf">value</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="s">"title"</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">String</span>
</code></pre></div></div>
<p>e listar meus objetos persistidos, moleza hein?!</p>

<p>Bom, ent√£o √© isso, essa foi uma breve introdu√ß√£o.</p>

<p>Existem muito mais opera√ß√µes que podem ser feitas com esse poderoso framework nativo que est√° ali, s√≥ no ponto pra voc√™ usar. Espero que esse artigo tenha ajudado voc√™ a entender melhor o <code class="language-plaintext highlighter-rouge">Core Data</code> e algumas de suas estruturas.
Quem sabe em um pr√≥ximo podemos ir mais a fundo e brincar um pouco mais com ele.</p>

<p><em>Quer saber mais</em>:</p>

<p><a href="https://developer.apple.com/reference/coredata">Core Data documentation</a></p>

<p><a href="https://developer.apple.com/library/content/releasenotes/General/WhatNewCoreData2016/ReleaseNotes.html">What`s New In Core Data</a></p>

<p><a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/CoreData/index.html?utm_source=iosstash.io">What Is Core Data?</a></p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/ui/2017/03/29/introducao-ao-asyncdisplaykit-construa-interfaces-asyncronas-no-iOS/" data-toggle="tooltip" data-placement="top" title="Interfaces ass√≠ncronas com AsyncDisplayKit">&larr; Post Anterior</a>
                    </li>
                    
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto ‚Äî Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
