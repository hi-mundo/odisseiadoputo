<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento — artigos, tutoriais e opinião.">

    <title>ReactiveCocoa + MVVM - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/reactive/2016/03/28/Reactivecocoa-+-MVVM/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>ReactiveCocoa + MVVM</h1>
                        
                        <h2 class="subheading">Utilizando ReactiveCocoa e MVVM</h2>
                        
                        <span class="meta">Postado por Alessandro Santos em 28/03/2016</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=ReactiveCocoa + MVVM&url=http://localhost:4000/reactive/2016/03/28/Reactivecocoa-+-MVVM/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/reactive/2016/03/28/Reactivecocoa-+-MVVM/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/reactive/2016/03/28/Reactivecocoa-+-MVVM/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/reactive/2016/03/28/Reactivecocoa-+-MVVM/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>Alessandro Santos (<a href="https://twitter.com/andydelarge" target="_blank">@andydelarge</a>) Carioca, desenvolvedor iOS desde 2011, atualmente faz parte (orgulhosamente) do time iOS da 99 Táxis, e está prestes a realizar o sonho em Trabalhar fora do país.</p>
</blockquote>

<h2 id="introdução">Introdução</h2>
<p>A utilização dos paradigmas de linguagens funcional e/ou reativas parecem estar “na moda” já há algum tempo, em linguagens como Scala, ou até mesmo com o lançamento do Swift. O que a maioria parece não saber, ou ignorar, é que “qualquer” linguagem permite o uso destes conceitos, sendo que algumas dão um “pouco mais de trabalho” para utilizar estas técnicas. É importante ressaltar que o uso do ReactiveCocoa muitas vezes pode parecer como conhecemos “uma bazuca para matar formiga” e embora possamos nos beneficiar destas técnicas escrevendo menos código, o seu uso deve ser bem avaliado. Para começarmos de forma simples, vamos ver um pouco do seu uso como bindings em um padrão de arquitetura conhecido como MVVM.</p>

<h2 id="reactivecocoa">ReactiveCocoa</h2>
<p>ReactiveCocoa (RAC) nada mais é que um framework, inspirado pelo paradigma funcional e reativo de programação. Existem várias matérias explicando os conceitos de programação reativa e funcional (inclusive aqui no blog), portanto, vamos nos ater ao seu uso apenas para o uso de “bindings” na arquiterura MVVM.</p>

<h2 id="bindings">Bindings</h2>
<p>Utilizar ReactiveCocoa para efetuar bindings significa obter apenas algumas adições, no mecanismo já existente de KVO em Objective-C. Existe algo novo, que o ReactiveCocoa traz para o KVO? Uma interface mais amigável com certeza, adicionando ainda, as habilidades de se descrever regras, de um estado de um modelo de dados para o estado da interface de forma declarativa.</p>

<h2 id="mvvm">MVVM</h2>
<p><img src="/img/delarge/MVVMPattern.png" alt="" /></p>

<p>Model-View-ViewModel, ou MVVM como é conhecido, trata-se de um design pattern que consiste em separar lógicas de UI, da lógica de negócios,
tornando as aplicações mais fáceis de serem desenvolvidas e testadas. Reúne todos os dados brutos que podem vir de banco de dados, webservices e etc, aplica lógicas e formata estes dados para apresentação em uma ViewController. Expõe via properties somente a informação que a ViewController precisa saber para efetuar o trabalho de mostrar os dados em uma view.</p>

<h2 id="mvvm-e-binding-de-dados">MVVM e binding de dados</h2>

<p><img src="/img/delarge/MVVMReactiveCocoa.png" alt="" /></p>

<p>No contexto deste post, de utilizar ReactiveCocoa somente para binding de dados, usando a arquitetura MVVM, o ReactiveCocoa executa uma função muito específica. Ele fornece uma espécie de “ponte” da ViewModel para a view, monitorando todas as mudanças realizadas no modelo de dados e mapeando estas mudanças para as properties da ViewModel efetuando qualquer lógica de negócios necessária.
Para dar um exemplo, imagine que nosso modelo de dados contenha uma property do tipo NSDate chamada de dateAdded. Nós iremos monitorar suas mudanças para atualizar uma property do nosso ViewModel, também chamada de dateAdded, mas esta, do nosso ViewModel. A property dateAdded do nosso modelo, como dito anteriormente, será uma NSDate enquanto a do nosso ViewModel será uma NSString. O binding irá parecer com algo descrito abaixo:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">dateAdded</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">Model</span> <span class="o">*</span><span class="n">model</span><span class="p">;</span>

<span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="n">dateAdded</span><span class="p">)</span><span class="o">=</span><span class="p">[</span><span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">,</span><span class="n">dateAdded</span><span class="p">)</span>
	<span class="nl">map:</span><span class="o">^</span><span class="p">(</span><span class="n">NSDate</span> <span class="o">*</span><span class="n">date</span><span class="p">){</span>
	 <span class="k">return</span> <span class="p">[[</span><span class="n">ViewModel</span> <span class="nf">dateFormatter</span><span class="p">]</span> <span class="nf">stringFromDate</span><span class="p">:</span><span class="n">date</span><span class="p">];</span>
 <span class="err">}</span><span class="p">];</span>
</code></pre></div></div>

<p>dateFormatter é um método de classe em nosso ViewModel, que faz uso de cache de uma instância NSDateFormatter que estará pronta para reuso (NSDateFormatter são muito custosas para se criar a todo tempo). Então nossa ViewController poderá monitorar todas as mudanças da property dateAdded da ViewModel, exibindo em uma label, por exemplo.</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">label</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">=</span> <span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">ViewModel</span><span class="p">,</span><span class="n">dateAdded</span><span class="p">);</span>
</code></pre></div></div>

<p>Aqui nós estamos abstraindo toda a lógica de se transformar um NSDate para uma NSString para a nossa ViewModel, possibilitando escrever testes unitários para garantir seu funcionamento. Pode parecer um pouco confuso neste exemplo e um tanto quanto trivial como podemos ver, mas como vimos isso ajuda a reduzir significamente a quantidade de código de lógica de UI de nossas ViewControllers.
Desta forma toda vez que a property dateAdded do nosso modelo, for modificada a property dateAdded do modelo será populada com o valor correspondente. E nós criamos uma conexão “invisível” entre elas. Essa é a razão pela qual chamamos reativa: duas properties estão agora relacionadas, então as mudanças que ocorrerem em uma irão afetar reativamente a outra.</p>

<h2 id="mas-o-que-seria-um-view-model">Mas o que seria um view-model?</h2>

<p>Resumindo, é a parte que trata da lógica de como se representam os dados. Os dados raramente são representados em sua aplicação da mesma forma em que são persistidos, quase sempre são transformados antes. Assim como citamos no exemplo acima, precisamos transformar um NSDate para uma NSString para melhor compreensão do usuário. E é para isto que uma ViewModel serve: Ela possui o modelo de dados, transforma-o e normaliza-o para ser exibido posteriormente pela UI. A ViewModel não é responsável apenas por estas transformações, mas também por ações associadas ao modelo.</p>

<h2 id="desacoplando-e-compondo-viewmodels">Desacoplando e compondo ViewModels.</h2>
<p>Esta é uma parte importante, em qualquer parte no desenvolvimento de software - poder ser facilmente desacoplado. Na maioria das vezes, uma particular ViewModel serve toda uma tela do aplicativo, fazendo mais de uma coisa dinamicamente. Agora imagine outra ViewModel servindo outra view com alguma coisa em comum com esta outra. Neste cenário ViewModels podem ser refatoradas, de forma com que funcionalidades em comum sejam movidas para uma terceira ViewModel. Isso nos permite ter um código mais granular e menos dependente. Como reusar uma ViewModel em comum? Simplesmente crie uma property de outra ViewModel conectando entradas e saídas desta forma:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">SubViewModel</span> <span class="o">*</span><span class="n">subViewModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">Model</span> <span class="o">*</span><span class="n">inputModel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">outputValue</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//tune subViewModel</span>
        <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">subViewModel</span><span class="p">.</span><span class="n">model</span><span class="p">)</span> <span class="o">=</span> <span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inputModel</span><span class="p">);</span>

        <span class="c1">//tune output</span>
        <span class="n">RAC</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">outputValue</span><span class="p">)</span> <span class="o">=</span> <span class="n">RACObserve</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">subViewModel</span><span class="p">.</span><span class="n">itsOutputValue</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="testabilidade">Testabilidade</h2>

<p>Aparentemente ViewModels possuem um padrão muito conveniente para se cobrir com testes, por possuir entrada e saída de dados. Testes possuem um padrão muito bem definido: Configurar valores arbitrários de entrada e verificar os valores esperados em sua saída..
ViewModels que fazem uso de FRP, particularmente ReactiveCocoa, fazem de maneira mais limpa e direta como implementar a funcionalidade desejada. Isto não significa necessariamente que você escreverá menos código, mas com certeza o fará de maneira mais limpa. Quanto mais claramente você entender o que precisa fazer, menos erros irá cometer. E esta é a vantagem principal do ReactiveCocoa e porque MVVM é tão bom: permitem com que você cometa cada vez menos erros.</p>

<h2 id="e-agora-como-proceder">E agora? Como proceder?</h2>
<p>As utilizações do ReactiveCocoa vão MUITO além de simples bindings. Seu conteúdo é bastante vasto e sua curva de aprendizado bastante alta. Desde simples bindings até camadas de conexão, vale a pena o seu estudo, por tornar sua aplicação reativa com todas as vantagens que isto pode oferecer.</p>

<h2 id="algumas-valiosas-fontes-de-informação">Algumas (valiosas) Fontes de informação</h2>
<ul>
  <li><a href="https://www.objc.io/issues/13-architecture/mvvm/">Introduction to MVVM by Ash Furrow </a></li>
  <li><a href="https://github.com/AshFurrow/C-41">A sample app by Ash Furrow</a></li>
  <li><a href="http://cocoamanifest.net/articles/2013/10/mvc-mvvm-frp-and-building-bridges.html">MVC, MVVM, FRP, And Building Bridges by Jonathan Penn</a></li>
  <li><a href="https://www.raywenderlich.com/74106/mvvm-tutorial-with-ReactiveCocoa-part-1">MVVM Tutorial with ReactiveCocoa</a></li>
  <li><a href="http://cocoasamurai.blogspot.com.br/2013/03/basic-mvvm-with-ReactiveCocoa.html">Basic MVVM with ReactiveCocoa by Colin Wheeler</a></li>
  <li><a href="http://twocentstudios.com/2014/06/08/on-mvvm-and-architecture-questions/">On MVVM, and Architecture Questions by Chris Trott</a></li>
  <li><a href="https://gist.github.com/JaviLorbada/4a7bd6129275ebefd5a6">JaviLorbada/FRP iOS Learning resources</a></li>
</ul>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/swift/2016/03/27/swift-in-the-sky-with-types/" data-toggle="tooltip" data-placement="top" title="Swift In The Sky With Types">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/comunidade/2016/04/04/agradecimentos-time-equinocios/" data-toggle="tooltip" data-placement="top" title="Obrigado!">Próximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto — Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
