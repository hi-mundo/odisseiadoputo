<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento ‚Äî artigos, tutoriais e opini√£o.">

    <title>RxSwift: como eu vim parar aqui? - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/2016/03/13/rxswift-como-eu-vim-parar-aqui/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>RxSwift: como eu vim parar aqui?</h1>
                        
                        <h2 class="subheading">Minha experi√™ncia aprendendo programa√ß√£o reativa e funcional</h2>
                        
                        <span class="meta">Postado por Bruno Koga em 13/03/2016</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=RxSwift: como eu vim parar aqui?&url=http://localhost:4000/2016/03/13/rxswift-como-eu-vim-parar-aqui/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/2016/03/13/rxswift-como-eu-vim-parar-aqui/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/2016/03/13/rxswift-como-eu-vim-parar-aqui/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/2016/03/13/rxswift-como-eu-vim-parar-aqui/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>‚òùÔ∏è
Esse artigo n√£o visa ensinar nenhum conceito ou t√©cnica diretamente. Ele √© muito mais um relato pessoal da minha experi√™ncia no aprendizado de alguns conceitos e paradigmas. Se voc√™ n√£o tem ideia do que √© programa√ß√£o reativa, eu recomendo fortemente <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">esse guia</a>.</p>
</blockquote>

<blockquote>
  <p>‚úåÔ∏è
A maioria dos exemplos contidos nesse artigo foram retirados de projetos reais e de documenta√ß√µes ou exemplos providos pelos autores das bibliotecas citadas. Todos os respectivos links est√£o dispon√≠veis no final do artigo.</p>
</blockquote>

<h3 id="passado">Passado</h3>
<p>Programo para iOS desde 2009. At√© 8 meses atr√°s, Objective-C (e o b√°sico de C) eram as duas √∫nicas linguagens que eu sabia programar.</p>

<p>E por muitos anos a minha abordagem para desenvolver software sempre envolveu: Objective-C, <a href="https://pt.wikipedia.org/wiki/Orienta√ß√£o_a_objetos">programa√ß√£o 100% orientada a objetos</a> e <a href="https://pt.wikipedia.org/wiki/Programa√ß√£o_imperativa">programa√ß√£o imperativa</a>. Foi assim que aprendi a programar e foi assim que sempre programei.</p>

<h3 id="presente">Presente</h3>
<p>Em junho de 2015, logo ap√≥s o lan√ßamento do Swift 2.0, entrei num projeto 100% escrito em Swift (1.2). Era meu primeiro contato real com Swift.</p>

<p><img src="/img/brunokoga/aleera.jpg" alt="" />
<span class="caption text-muted">Logo eu me vingarei!</span></p>

<blockquote>
  <p><strong>Opini√£o:</strong> aprender Swift √© como aprender qualquer outra linguagem de programa√ß√£o. Sua sintaxe √© relativamente simples de aprender e j√° h√° muita documenta√ß√£o e exemplos na internet. N√£o acho que Swift deveria ser barreira para ningu√©m: √© algo que se aprende (o b√°sico) em poucos dias. E √© quest√£o de dias para voc√™ ser produtivo usando Swift.</p>
</blockquote>

<p>Por√©m, a camada de comunica√ß√£o com o servidor desse aplicativo era constru√≠da em cima de uma biblioteca escrita chamada <a href="https://github.com/Thomvis/BrightFutures">BrightFutures</a>. E com isso me deparei com dois outros conceitos que eu nunca havia estudado (muito menos usado): <a href="https://pt.wikipedia.org/wiki/Programa√ß√£o_funcional">programa√ß√£o funcional</a> e <a href="https://en.wikipedia.org/wiki/Reactive_programming">programa√ß√£o reativa</a>.</p>

<blockquote>
  <p><strong>Opini√£o:</strong> o resumo de programa√ß√£o funcional √©, <strong>para mim</strong>, algo do tipo: uma mudan√ßa de pensamento que, ao inv√©s de voc√™ pensar em classes e objetos e na intera√ß√£o entre essas entidades, voc√™ pensa muito mais em fun√ß√µes e composi√ß√£o de fun√ß√µes. √â um tema bastante extenso. Pela minha experi√™ncia, isso √© algo que leva um certo tempo para aprender e requer disciplina para ler teorias e documenta√ß√µes.</p>
</blockquote>

<p>E por fim: programa√ß√£o reativa. At√© ent√£o, eu nunca tinha conseguido entender exatamete o que era programa√ß√£o reativa. Todas a vezes que tentei usar <a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a> desisti no meio por perder o controle do que estava acontecendo.</p>

<blockquote>
  <p><strong>Opini√£o:</strong> <img src="/img/brunokoga/rac.png" alt="" />
<span class="caption text-muted">meu snippet para <code class="language-plaintext highlighter-rouge">;rac</code> no TextExpander</span></p>
</blockquote>

<h3 id="futuro">Futuro</h3>
<p>Voltando ao <code class="language-plaintext highlighter-rouge">BrightFutures</code>: na √©poca, mesmo sem saber nada de programa√ß√£o funcional e programa√ß√£o reativa, foi f√°cil para eu entender a teoria e a filosofia por tr√°s do <em>framework</em>: prover uma forma de tratar com c√≥digo ass√≠ncrono e tratamento de erros atrav√©s de <a href="https://en.wikipedia.org/wiki/Futures_and_promises">futuros e promessas</a>.</p>

<p>E foi a√≠ que comecei a entender <em>um pouco</em> o que significava programa√ß√£o funcional e porque o Swift era uma linguagem que permitia a implementa√ß√£o e o uso de conceitos funcionais.</p>

<blockquote>
  <p>Vamos come√ßar a viajar um pouco. Essa √© a hora ideal para uma dose de cafe√≠na ‚òïÔ∏è.</p>
</blockquote>

<p>Imagine o caso em que voc√™ tem uma s√©rie de eventos futuros que voc√™ quer que sejam encadeados, respeitando (ou n√£o) uma ordem e que no final desse encadeamento de eventos (ou seja, no futuro) voc√™ quer ser notificado.</p>

<p>Por exemplo: um aplicativo em que o usu√°rio pode logar com a sua conta e baixar todos os seus posts. Temos ent√£o um evento de <code class="language-plaintext highlighter-rouge">logIn</code> que, em caso de sucesso, dispara um evento de <code class="language-plaintext highlighter-rouge">fetchPosts</code> para aquele usu√°rio. Tanto o evento de <code class="language-plaintext highlighter-rouge">logIn</code> como o de <code class="language-plaintext highlighter-rouge">fetchPosts</code> seriam fun√ß√µes que retornam um ‚ÄúFuturo‚Äù (no caso do <em>BrightFutures</em>, um <code class="language-plaintext highlighter-rouge">Future</code>). O resultado da execu√ß√£o do <code class="language-plaintext highlighter-rouge">logIn</code>, por exemplo, √© um <code class="language-plaintext highlighter-rouge">future</code> que representa um erro (em caso de erro) ou um <code class="language-plaintext highlighter-rouge">userId</code> (em caso de sucesso). No caso do <code class="language-plaintext highlighter-rouge">fetchPosts</code>, o retorno seria um  <code class="language-plaintext highlighter-rouge">future</code> representando um erro (falha) ou um array de posts (sucesso).</p>

<p>Antes mesmo de ler sequer uma linha de c√≥digo, a abstra√ß√£o acima faz sentido. O problema agora √© como programar usando essa ‚Äúarquitetura‚Äù. No exemplo acima, o c√≥digo seria algo assim (c√≥digo retirado do <a href="https://github.com/Thomvis/BrightFutures">reposit√≥rio do Bright Futures</a>):</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">User</span><span class="o">.</span><span class="nf">logIn</span><span class="p">(</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">user</span> <span class="k">in</span>
    <span class="kt">Posts</span><span class="o">.</span><span class="nf">fetchPosts</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="p">}</span><span class="o">.</span><span class="n">onSuccess</span> <span class="p">{</span> <span class="n">posts</span> <span class="k">in</span>
    <span class="c1">// do something with the user's posts</span>
<span class="p">}</span><span class="o">.</span><span class="n">onFailure</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// either logging in or fetching posts failed</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A assinatura das fun√ß√µes <code class="language-plaintext highlighter-rouge">User.logIn</code> e <code class="language-plaintext highlighter-rouge">Posts.fetchPosts</code> seria algo assim:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">logIn</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="kt">User</span><span class="p">,</span> <span class="kt">ErrorType</span><span class="o">&gt;</span>
<span class="kd">func</span> <span class="nf">fetchPosts</span><span class="p">(</span><span class="nv">user</span><span class="p">:</span> <span class="kt">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Future</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Posts</span><span class="p">],</span> <span class="kt">ErrorType</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Se voc√™ n√£o estiver acostumado com a sintaxe do Swift ou o c√≥digo acima parecer muito confuso para voc√™, essa √© a explica√ß√£o desse c√≥digo (traduzido do <a href="https://github.com/Thomvis/BrightFutures">reposit√≥rio do Bright Futures</a>):</p>

<p>Quando o futuro retornado por <code class="language-plaintext highlighter-rouge">User.logIn</code> falha (por exemplo, se o <code class="language-plaintext highlighter-rouge">username</code> e <code class="language-plaintext highlighter-rouge">password</code> n√£o estiverem corretos), tanto o <code class="language-plaintext highlighter-rouge">flatMap</code> como o <code class="language-plaintext highlighter-rouge">onSuccess</code> s√£o pulados, e o closure <code class="language-plaintext highlighter-rouge">onFailure</code> √© chamado com o <code class="language-plaintext highlighter-rouge">error</code> que ocorreu na tentativa de <code class="language-plaintext highlighter-rouge">logIn</code>. Se a tentativa de realizar o <code class="language-plaintext highlighter-rouge">logIn</code> for bem sucedida, o resultado da opera√ß√£o (que √© um objeto <code class="language-plaintext highlighter-rouge">user</code>) √© passado para o <code class="language-plaintext highlighter-rouge">flatMap</code>, que ‚Äútransforma‚Äù o usu√°rio em um <em>array</em> com seus posts. Se os posts n√£o puderem ser baixados (por causa de um erro), <code class="language-plaintext highlighter-rouge">onSuccess</code> √© pulado, e <code class="language-plaintext highlighter-rouge">onFailure</code> √© chamado com o <code class="language-plaintext highlighter-rouge">error</code> que ocorreu na tentativa de baixar os posts. Se os posts puderem ser baixados com sucesso, <code class="language-plaintext highlighter-rouge">onSuccess</code> √© chamado com os posts do usu√°rio.</p>

<blockquote>
  <p><strong>Opini√£o:</strong> o c√≥digo pode parecer estranho a princ√≠pio, mas novamente a teoria faz sentido. E por isso que acho que tanto programa√ß√£o funcional como programa√ß√£o reativa s√£o dois conceitos que requerem estudo da teoria antes da pr√°tica. √â um pouco diferente de aprender uma linguagem de programa√ß√£o nova (como Swift), que algo 100% <em>hands on</em> pode ser efetivo.</p>
</blockquote>

<p>Falando nisso, o <code class="language-plaintext highlighter-rouge">flatMap</code> a√≠ em cima √© um dos caras que fazem parte dos conceitos funcionais. Caso voc√™ n√£o o entenda (ainda!), a id√©ia √© que ele ‚Äútransforma‚Äù (ou ‚Äúmapeia‚Äù) o <strong>resultado</strong> de um <code class="language-plaintext highlighter-rouge">Future</code> no <strong>valor</strong> de um novo <code class="language-plaintext highlighter-rouge">Future</code>. Ou seja, ele transforma o resultado do <code class="language-plaintext highlighter-rouge">logIn</code> (que √© um <code class="language-plaintext highlighter-rouge">user</code>) no valor de entrada para o <code class="language-plaintext highlighter-rouge">fetchPosts</code> (que por sua vez retorna outro <code class="language-plaintext highlighter-rouge">Future</code>).</p>

<p>E √© a√≠ que entra a m√°gica do Swift ser t√£o restrito em rela√ß√£o a tipos (ou seja, ser uma linguagem <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/TheBasics.html"><em>type safe</em></a>, totalmente diferente do Objective-C): o compilador consegue te garantir que os tipos de dados dos valores retornados por uma fun√ß√£o e passados para outra fun√ß√£o est√£o sempre corretos. E a partir da√≠, o atalho preferido do Xcode passa a ser <code class="language-plaintext highlighter-rouge">‚å• + click</code>:</p>

<p><img src="/img/brunokoga/typesafe1.png" alt="" />
<span class="caption text-muted"> O compilador est√° do nosso lado! Ap√≥s concatenar v√°rias fun√ß√µes, voc√™ (quase) sempre pode confiar nele para te dizer o tipo do retorno das suas fun√ß√µes. Essa t√©cnica √© muito √∫til para voc√™ checar se o tipo retornado √© mesmo o que voc√™ espera.</span></p>

<p><img src="/img/brunokoga/typesafe2.png" alt="" />
<span class="caption text-muted">a mesma estrat√©gia funciona tamb√©m para os par√¢metros das fun√ß√µes concatenadas. Mesmo que voc√™ n√£o entenda o c√≥digo acima, a id√©ia √© que voc√™ tem a seguran√ßa de saber que est√° trabalhando com o tipo de dado correto (diferentemente do Objective-C, onde n√£o h√° essa garantia).</span></p>

<h3 id="resumindo">Resumindo</h3>

<p><code class="language-plaintext highlighter-rouge">Futures</code> s√£o a√ß√µes futuras (ass√≠ncronas, com tratamento de erros). O paradigma da programa√ß√£o funcional permite transformar e encadear essas a√ß√µes de uma forma clara e segura. Al√©m disso, ao trabalhar com <code class="language-plaintext highlighter-rouge">Futures</code>, estamos trabalhando de uma forma ‚Äúreativa‚Äù. Em outras palavras, estamos programando baseado no ‚Äúretorno‚Äù dos <code class="language-plaintext highlighter-rouge">futures</code>. Esses <code class="language-plaintext highlighter-rouge">futures</code> se responsabilizam de fazer o trabalho deles assincronamente. E ao encadear esses <code class="language-plaintext highlighter-rouge">futures</code>, estamos trabalhando com os conceitos funcionais. Por isso que, apesar de diferentes, esses dois termos s√£o vistos comumente juntos: <strong>Programa√ß√£o Reativa Funcional</strong>.</p>

<h3 id="rxswift">RxSwift</h3>

<p><a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> √© a vers√£o escrita em Swift do <a href="http://reactivex.io">ReactiveX</a>. O <a href="http://reactivex.io">ReactiveX</a> por sua vez √© uma biblioteca que possibilita o uso de programa√ß√£o baseada em eventos (reativa), de forma ass√≠ncrona e que pode ser composta e encadeada (funcional) atrav√©s de <a href="http://reactivex.io/documentation/operators.html"><strong>operadores</strong></a>.</p>

<blockquote>
  <p><strong>Opini√£o:</strong> novamente, a melhor forma - na minha opini√£o - de aprender os conceitos b√°sicos de programa√ß√£o reativa √© esse link: <a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">The introduction to Reactive Programming you‚Äôve been missing</a>.</p>
</blockquote>

<p>A id√©ia b√°sica da programa√ß√£o reativa √© que voc√™ trabalha em cima de <em>streams</em> (fluxos, correntes, sequ√™ncias) de dados. Cada <em>stream</em> √© uma sequ√™ncia de eventos que acontecem em uma linha de tempo e podem emitir tr√™s tipos de ‚Äúcoisas‚Äù: um valor, um erro ou um <em>sinal de finalizado</em>.</p>

<p>No nosso exemplo anterior, usando <a href="(https://github.com/Thomvis/BrightFutures)">BrightFutures</a>, a nossa entidade <code class="language-plaintext highlighter-rouge">Future</code> nada mais √© do que um <em>stream</em>, que pode produzir um valor (e um sinal de ‚Äúfinalizado‚Äù logo em seguida) ou um erro.</p>

<p>Com o <code class="language-plaintext highlighter-rouge">RxSwift</code>, por√©m, as coisas s√£o mais amplas que apenas <code class="language-plaintext highlighter-rouge">Futures</code>. Voc√™ pode definir outros tipos de <em>streams</em>. Um bom exemplo √© um <code class="language-plaintext highlighter-rouge">UITextField</code>: ao inv√©s de programar pensando nos conceitos de <em>delegates</em>, o <code class="language-plaintext highlighter-rouge">RxSwift</code> te permite <strong>observar</strong> os valores do <em>stream</em> <code class="language-plaintext highlighter-rouge">rx_text</code> do <code class="language-plaintext highlighter-rouge">UITextField</code> e <strong>reagir</strong> de acordo com a emiss√£o desses valores. Veja um exemplo:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">lengthOfBytes</span> <span class="o">=</span>
        <span class="n">textView</span><span class="o">.</span><span class="n">rx_text</span>
            <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">lengthOfBytesUsingEncoding</span><span class="p">(</span><span class="kt">NSUTF8StringEncoding</span><span class="p">)</span> <span class="p">}</span>
            <span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">}</span>
</code></pre></div></div>

<p>Com o c√≥digo acima, estamos definindo que a cada vez que <code class="language-plaintext highlighter-rouge">rx_text</code> emitir um valor, n√≥s iremos <em>mapear</em> (ou seja, transformar) esse valor em um <code class="language-plaintext highlighter-rouge">Int</code>, e ent√£o iremos filtrar esse valor, seguindo adiante apenas se ele for maior que 5.</p>

<p>Fazendo novamente a compara√ß√£o com <code class="language-plaintext highlighter-rouge">Futures</code>, o <code class="language-plaintext highlighter-rouge">RxSwift</code> encapsula seus <em>streams</em>  em <code class="language-plaintext highlighter-rouge">Observables</code>. Ou seja, o tipo de dado de <code class="language-plaintext highlighter-rouge">rx_text</code> √© um <code class="language-plaintext highlighter-rouge">Observable&lt;String&gt;</code>, enquanto, no exemplo acima, o tipo de dados de <code class="language-plaintext highlighter-rouge">lengthOfBytes</code> √© um <code class="language-plaintext highlighter-rouge">Observable&lt;Int&gt;</code> (ou seja, √© um <em>stream</em> tamb√©m):</p>

<p><img src="/img/brunokoga/rxswift1.png" alt="" />
<span class="caption text-muted">Lembre-se: <code class="language-plaintext highlighter-rouge">‚å• + click</code> √© seu melhor amigo!</span></p>

<p>A √∫ltima pe√ßa que falta nesse quebra-cabe√ßas do <code class="language-plaintext highlighter-rouge">RxSwift</code> √© que <strong>nada acontece</strong> at√© voc√™ dar um <em>subscribe</em> no seu <em>stream</em> (ou na sua sequ√™ncia de <em>streams</em>). Antes disso, voc√™ est√° apenas definindo as a√ß√µes que voc√™ ir√° tomar, baseada nos eventos que podem acontecer. O <em>subscribe</em> √© o sinal verde para que o <code class="language-plaintext highlighter-rouge">Observable</code> comece a emitir itens:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">messagesHandler</span><span class="o">.</span><span class="n">messages</span>
            <span class="o">.</span><span class="nf">window</span><span class="p">(</span><span class="nv">timeSpan</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">count</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">MainScheduler</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
            <span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">observable</span> <span class="o">-&gt;</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">ServerMessage</span><span class="o">&gt;</span> <span class="k">in</span>
                <span class="n">observable</span><span class="o">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="n">subscribeNext</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">message</span> <span class="k">in</span>
                    <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="nf">playMessageArrivedSound</span><span class="p">()</span>
                <span class="p">}</span>
            <span class="p">}</span><span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>O <code class="language-plaintext highlighter-rouge">disposeBag</code>, a grosso modo, √© a forma do <code class="language-plaintext highlighter-rouge">RxSwift</code> liberar os recursos alocados, quando voc√™ acabar de observar a sequ√™ncia (seja por op√ß√£o ou porque ela terminou). N√£o vou entrar em detalhes sobre como usar o <code class="language-plaintext highlighter-rouge">dispose</code> do <code class="language-plaintext highlighter-rouge">RxSwift</code>. N√£o √© algo muito complicado e voc√™ pode ler mais sobre o assunto <a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/GettingStarted.md#disposing">aqui</a>.</p>
</blockquote>

<p>O <code class="language-plaintext highlighter-rouge">subscribeNext</code> √© a forma que o seu <code class="language-plaintext highlighter-rouge">Observer</code> fala ‚Äúa cada valor emitido, fa√ßa isso‚Äù. O c√≥digo acima √© um exemplo de como observar mensagens recebidas em um aplicativo de mensagens instant√¢neas e disparar um som cada vez que uma mensagem chega. Os operadores <code class="language-plaintext highlighter-rouge">window</code> e <code class="language-plaintext highlighter-rouge">flatMap</code> garantem que haja um intervalo m√≠nimo de 0.5 segundo entre cada som disparado (para saber mais, veja <a href="http://stackoverflow.com/questions/35438268/rxswift-debounce-throttle-inverse">essa pergunta no StackOverflow</a>). No exemplo acima, n√£o estamos reagindo em caso de erro, nem para os sinais de <code class="language-plaintext highlighter-rouge">completed</code>, j√° que, em teoria, esse <em>stream</em> de mensagens recebidas nunca encerra.</p>

<p>Uma forma comum de se usar esse paradigma de observar <code class="language-plaintext highlighter-rouge">streams</code> √© com <strong>binding</strong>. <a href="https://en.wikipedia.org/wiki/Data_binding">Data binding</a> √© o processo de ‚Äúconectar‚Äù a informa√ß√£o apresentada na sua UI com o seu modelo ou l√≥gica de neg√≥cios.</p>

<p>Usando o <code class="language-plaintext highlighter-rouge">RxSwift</code> por exemplo, a implementa√ß√£o de uma tela de Settings poderia ser a seguinte:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="c1">//bind, onde nameLabel = firstName + " " + lastName</span>
        <span class="kt">Observable</span>
         <span class="o">.</span><span class="nf">combineLatest</span><span class="p">(</span><span class="n">firstNameTextField</span><span class="o">.</span><span class="n">rx_text</span><span class="p">,</span> <span class="n">lastNameTextField</span><span class="o">.</span><span class="n">rx_text</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$0</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="nv">$1</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">bindTo</span><span class="p">(</span><span class="n">nameLabel</span><span class="o">.</span><span class="n">rx_text</span><span class="p">)</span>
         <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
        
        <span class="c1">//bind, onde mapeamos o valor do Switch em um emoji:</span>
        <span class="n">settingsSwitch</span><span class="o">.</span><span class="n">rx_value</span>
         <span class="o">.</span><span class="n">map</span> <span class="p">{</span>
            <span class="nv">$0</span> <span class="p">?</span> <span class="s">"üëç"</span> <span class="p">:</span> <span class="s">"üëé"</span>
        <span class="p">}</span><span class="o">.</span><span class="nf">bindTo</span><span class="p">(</span><span class="n">settingsLabel</span><span class="o">.</span><span class="n">rx_text</span><span class="p">)</span>
         <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>
<blockquote>
  <p>Se a sintaxe de <code class="language-plaintext highlighter-rouge">$0</code> e <code class="language-plaintext highlighter-rouge">$1</code> for meio etranha pra voc√™, eles s√£o recursos do pr√≥prio Swift. Recomendo a leitura do cap√≠tulo de <em>Closures</em> do <a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Closures.html">The Swift Programming Language</a>.</p>
</blockquote>

<p>E esse √© o resultado:</p>

<center><img src="/img/brunokoga/bind.gif" alt="" /></center>
<p><span class="caption text-muted">Suas telas de Settings nunca mais ser√£o as mesmas! ‚ú®</span></p>

<h3 id="e-esse-√©-s√≥-o-come√ßo">E esse √© s√≥ o come√ßo</h3>

<p>Acredite: esses s√£o apenas os primeiros passos dentro do mundo de programa√ß√£o reativa e/ou funcional. Ainda existe muito a ser explorado e muito, muito a ser aprendido.
Algo que tem me ajudado bastante nesse processo de aprendizado √© ter a consci√™ncia de que o tema √© extenso e n√£o se aprende da noite pro dia (diferente de aprender uma nova linguagem de programa√ß√£o, por exemplo). A verdade √© que Programa√ß√£o Funcional e Reativa s√£o conceitos longos e complexos e que levam tempo para serem assimilados. Mas acredito que uma vez que voc√™ aprenda a teoria, a escolha de bibliotecas seja um ‚Äúmero‚Äù detalhe.</p>

<p>Espero que compartilhar a minha experi√™ncia possa ser √∫til para voc√™ come√ßar a entender um pouco mais desses paradigmas de programa√ß√£o. Caso queira se aprofundar mais, coloquei alguns links nas <strong>Refer√™ncias</strong> abaixo.</p>

<h3 id="agradecimentos">Agradecimentos</h3>
<ul>
  <li><a href="https://twitter.com/larslockefeer">Lars</a> por me ensinar Swift e os conceitos do <a href="https://github.com/Thomvis/BrightFutures">BrightFutures</a>;</li>
  <li><a href="https://twitter.com/thomvis88">Thomas</a> por ter escrito a <a href="https://github.com/Thomvis/BrightFutures">BrightFutures</a>;</li>
  <li><a href="https://twitter.com/gsampaio">Mentos</a> por ter sido a inspira√ß√£o para eu criar meu snippet <code class="language-plaintext highlighter-rouge">;rac</code> no TextExpander.</li>
</ul>

<h3 id="refer√™ncias">Refer√™ncias</h3>
<p>Fontes utilizadas para a escrita deste artigo:</p>

<ul>
  <li><a href="https://github.com/Thomvis/BrightFutures">Bright Futures</a></li>
  <li><a href="https://github.com/ReactiveX/RxSwift/blob/master/Documentation/Examples.md">RxSwift</a></li>
  <li><a href="http://slack.rxswift.org">Slack do RxSwift</a></li>
  <li><a href="https://gist.github.com/staltz/868e7e9bc2a7b8c1f754">The introduction to Reactive Programming you‚Äôve been missing</a></li>
  <li><a href="http://reactivex.io">ReactiveX</a></li>
  <li><a href="http://rxmarbles.com">RxMarbles</a></li>
</ul>

<p>Obrigado pela leitura!</p>

<blockquote>
  <p>Bruno Koga
<br /><a href="https://twitter.com/brunokoga">@brunokoga</a>
<br />http://www.brunokoga.com</p>
</blockquote>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/webview/2016/03/12/webview-a-porta-de-entrada-para-desenvolvedores-web/" data-toggle="tooltip" data-placement="top" title="WebView">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/functional/2016/03/14/generic-functional-reactive-post/" data-toggle="tooltip" data-placement="top" title="Programa√ß√£o funcional e reativa √© para todos">Pr√≥ximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto ‚Äî Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
