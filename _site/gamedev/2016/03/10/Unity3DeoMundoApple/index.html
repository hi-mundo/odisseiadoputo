<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento — artigos, tutoriais e opinião.">

    <title>Unity3D e o Mundo Apple - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/gamedev/2016/03/10/Unity3DeoMundoApple/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Unity3D e o Mundo Apple</h1>
                        
                        <h2 class="subheading">Introdução e Integração da engine com iOS</h2>
                        
                        <span class="meta">Postado por Mauricio Cardozo em 10/03/2016</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Unity3D e o Mundo Apple&url=http://localhost:4000/gamedev/2016/03/10/Unity3DeoMundoApple/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/gamedev/2016/03/10/Unity3DeoMundoApple/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/gamedev/2016/03/10/Unity3DeoMundoApple/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/gamedev/2016/03/10/Unity3DeoMundoApple/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<!-- galera com licença aí mas eu preciso centralizar e limitar umas coisas pro meu post -->
<style>
video, iframe{
	width: 100%;
}

img, iframe{
	margin: 0 auto;
}

</style>

<p><img src="/img/loloop/muchocaliente.png" alt="O fps mais inovador que eu já joguei em anos" /></p>

<p>Nascida no OS X em 2005 e portada para o resto do mundo todo, a Unity é uma das maiores game engines da atualidade, e uma das melhores escolhas que se pode fazer quando o assunto é gamedev para aparelhos mobile. Com suporte a tantas plataformas que eu não duvidaria que ela funciona até em torradeiras, e isto naturalmente traz aquela dúvida que todo framework que promete mil e uma plataformas traz: Mas realmente funciona?</p>

<p>Sim, funciona. Diferente de apps híbridos, que na maior parte do tempo são várias Web Views com uns hooks para acessar algumas funcionalidades nativas, o core da Unity é todo em C++ (<a href="http://blogs.unity3d.com/2015/05/06/an-introduction-to-ilcpp-internals/">E o build que ela gera para o iOS também</a>) e ela implementa o <a href="http://blogs.unity3d.com/2015/04/17/ios-64-bit-and-metal-update/">Metal</a> no iOS, e assim tem uma performance ótima mesmo quando comparada com o SceneKit.</p>

<p>Agora que você já conhece um pouco da Unity e o core dela, vamos começar? :)</p>

<h2 id="primeiros-passos">Primeiros Passos</h2>

<p><img src="/img/loloop/GetUnity.png" alt="Página Inicial da Unity3D" /></p>

<p>Bom, vamos começar baixando a Unity né? Não precisa se preocupar muito se ela vai rodar bem no seu Mac, pois estou usando um <a href="https://support.apple.com/kb/sp618?locale=en_US">MacBook Air de 2010</a> para escrever este artigo. A versão que eu usei pra escrever ele é a 5.3.2, mas já saiu uma versão mais nova, a 5.3.3, mas tudo que eu fizer aqui deve funcionar nela sem o menor dos problemas. O download tá no <a href="http://unity3d.com/download">site da Unity</a>, e a Personal Edition é completa o suficiente pra funcionar com tudo que a gente vai usar.</p>

<p><img src="/img/loloop/BuildSupport.png" /></p>

<p>Não se esqueça de marcar pro Download Assistant baixar o Build Support para as plataformas que vamos usar :)</p>

<h3 id="o-unity-remote">O Unity Remote</h3>

<p><img src="/img/loloop/UnityRemote4.png" alt="Unity Remote 4 na App Store" />
<span class="caption text-muted"><a href="https://itunes.apple.com/us/app/unity-remote-4/id871767552?mt=8">Download do UnityRemote na App Store</a></span></p>

<p>Testar builds em aparelhos iOS com a Unity é um processo demorado e chato. Para aqueles testes onde queremos apenas o input do celular, o Remote é uma 
ótima ferramenta de auxílio no desenvolvimento. Ele pode utilizar os sensores do seu celular, como acelerômetro e etc, mas não roda o jogo no hardware dele, apenas renderizando o jogo no Editor no computador, e enviando o vídeo pelo USB e captando os inputs feitos no device. Um downside é que não dá pra capturar a câmera do device com o remote.</p>

<h3 id="git">Git</h3>

<p><img src="/img/loloop/EditorSettings.png" /></p>

<p>Para deixar o mais amigável para se trabalhar com o Git, nós precisamos mudar a forma como ela trata com alguns arquivos lá em <code class="language-plaintext highlighter-rouge">Edit &gt; Project Settings &gt; Editor Settings</code>. Precisamos mudar o Version Control Mode para <em>Visible Meta Files</em> e o Asset Serialization Mode para <em>Force Text</em>. Isso faz com que a Unity não esconda os arquivos de configuração dela, e todos os arquivos que ela puder deixar como texto, como cenas, prefabs e até os ProjectSettings sejam textos.</p>

<p>Fica bem mais fácil de identificar problemas assim, já que antes não era possível fazer diff dos arquivos, mas isso deixa os commits um número de linhas bem exagerado, como dá pra ver nos graphs do GitHub de um dos meus projetos.</p>

<p><img src="/img/loloop/3MilhoesDeLinhas.png" alt="3mi linhas de código" /></p>

<h3 id="player-settings">Player Settings</h3>

<p>As outras configurações básicas de cada projeto estão no <code class="language-plaintext highlighter-rouge">Edit &gt; Project Settings &gt; Player Settings</code>, como lock de rotação do device, habilitar split screen multitasking para o iPad Air2 / iPad Pro, estilo e posicionamento da Status Bar, Ícone, Company Name, Bundle ID, Launch Screen, versão do iOS mínima e várias outras coisas.</p>

<h2 id="layouts-e-canvas">Layouts e Canvas</h2>

<h3 id="layouts-específicos-para-os-devices">Layouts específicos para os devices</h3>

<p>Vou começar falando da parte ruim do sistema de UI da Unity, que é o fato dela não saber lidar muito bem com os layouts aparelhos de dpi diferentes e resoluções parecidas, infelizmente nos forçando a fazer algo parecido com isso:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">//O Device.generation retorna um enum com a versão específica do device, então também é possível utilizar ele para saber se o usuário tem um iPad Pro ou um iPad Air, por exemplo</span>
<span class="k">if</span><span class="p">(</span><span class="n">UnityEngine</span><span class="p">.</span><span class="n">iOS</span><span class="p">.</span><span class="n">Device</span><span class="p">.</span><span class="n">generation</span><span class="p">.</span><span class="nf">ToString</span><span class="p">().</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"iPhone"</span><span class="p">)){</span>
	<span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Estou num iPhone!"</span><span class="p">);</span>
	<span class="c1">//Carrega a UI específica do iPhone</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"Estou num iPad!"</span><span class="p">);</span>
	<span class="c1">//Carrega a UI específica do iPad</span>
<span class="p">}</span>

</code></pre></div></div>

<!-- http://docs.unity3d.com/ScriptReference/iOS.DeviceGeneration.html -->

<h3 id="canvas">Canvas</h3>

<p>A Unity, na versão 4.6, ganhou um sistema novo de UI (<a href="https://bitbucket.org/Unity-Technologies/ui">open source, btw</a>), com  suporte muito melhor para lidar com múltiplas resoluções, aspectos e variações de DPI. Um dos componentes mais importantes desse sistema é o <code class="language-plaintext highlighter-rouge">Canvas Scaler</code>, responsável por coordenar a escala dos elementos no aparelho. Existem algumas formas de configurar ele:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Constant Pixel Size</code>: É a configuração padrão do Scaler, e nela os elementos retém o tamanho original deles, e pode ser bem enganadora. É o que causa uma interface a ficar boa em um iPad 2, mas minúscula em um iPad Air. Tem seus usos, mas tome cuidado ao decidir ficar nela.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Scale With Screen Size</code>: Nesta configuração a Unity escala os elementos de acordo com a resolução da tela, e você tem uma resolução virtual para trabalhar com os seus elementos.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Constant Physical Size</code>: Na última configuração, os valores de pontos da Unity são trocados por valores em dp. Esta configuração depende do device reportar adequadamente o dpi de sua tela, e você pode especificar um valor de DPI padrão como fallback.</p>
  </li>
</ul>

<p>A configuração mais “segura” de todas é usar o <code class="language-plaintext highlighter-rouge">Scale With Screen Size</code>, com resolução virtual de 1080p, e o <code class="language-plaintext highlighter-rouge">Match Width or Height</code> configurado para 0.5.</p>

<iframe src="https://gfycat.com/ifr/RewardingCreepyHowlermonkey" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>

<p>Também é possível incluir o Canvas dentro do mundo do seu jogo, como um elemento que faz parte dele. Usar isto é útil para quando você quiser colocar um nome em cima dos jogadores, por exemplo, mas desabilita completamente qualquer tipo de escala de acordo com o tamanho da tela.</p>

<h3 id="input-handling">Input Handling</h3>

<p>A classe <code class="language-plaintext highlighter-rouge">Input</code> controla todo tipo de input feito no jogo na Unity3D, desde o apertar de teclas no teclado, a movimentação dos analógicos em um controle e claro, por que não, os toques em uma tela.</p>

<h4 id="multitouch">Multitouch</h4>

<iframe src="https://gfycat.com/ifr/RealCluelessDrongo" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>
<p><span class="caption text-muted">Testando com o UnityRemote no computador</span></p>

<p>O <code class="language-plaintext highlighter-rouge">Input</code> possui suporte fácil ao multitouch, com a propriedade <code class="language-plaintext highlighter-rouge">Input.touches</code>, que nada mais é do que um array de <a href="http://docs.unity3d.com/ScriptReference/Touch.html">toques</a>, com a posição, delta de movimento e tempo, posição, pressão no caso de aparelhos como o 6S e até se ele veio do dedo do usuário ou de uma <a href="http://docs.unity3d.com/ScriptReference/Touch-type.html">Apple Pencil</a>.</p>

<h4 id="swiping">Swiping</h4>

<iframe src="https://gfycat.com/ifr/OpulentSeparateArizonaalligatorlizard" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>
<p><span class="caption text-muted">Gravei da tela do iPhone pra mostrar como é fácil usar o UnityRemote</span></p>

<p>Infelizmente a Unity não tem nada para detecção de swipe, então nesse caso nós temos uma alternativa bem legal: Usar uma lib externa, o <a href="https://github.com/prime31/TouchKit">TouchKit</a>.</p>

<p>O uso do TouchKit é bem simples para detectar swiping:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>            
            <span class="n">TKSwipeRecognizer</span> <span class="n">recognizer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">TKSwipeRecognizer</span><span class="p">(</span><span class="n">TKSwipeDirection</span><span class="p">.</span><span class="n">All</span><span class="p">);</span> <span class="c1">//É possível limitar as direções do swipe que o TK vai detectar   </span>
            
            <span class="n">recognizer</span><span class="p">.</span><span class="n">gestureRecognizedEvent</span> <span class="p">+=</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
                    <span class="c1">//Ação desejada no swipe vem aqui</span>
                    <span class="n">swipeText</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">completedSwipeDirection</span><span class="p">.</span><span class="nf">ToString</span><span class="p">();</span>
                    <span class="n">Color</span> <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">black</span><span class="p">;</span>
                    <span class="k">switch</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">completedSwipeDirection</span><span class="p">){</span>
                        <span class="k">case</span> <span class="n">TKSwipeDirection</span><span class="p">.</span><span class="n">Down</span><span class="p">:</span>
                            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">green</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">TKSwipeDirection</span><span class="p">.</span><span class="n">Up</span><span class="p">:</span>
                            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">blue</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">TKSwipeDirection</span><span class="p">.</span><span class="n">Left</span><span class="p">:</span>
                            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">magenta</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="n">TKSwipeDirection</span><span class="p">.</span><span class="n">Right</span><span class="p">:</span>
                            <span class="n">color</span> <span class="p">=</span> <span class="n">Color</span><span class="p">.</span><span class="n">yellow</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span>
                            <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">background</span><span class="p">.</span><span class="n">color</span> <span class="p">=</span> <span class="n">color</span><span class="p">;</span>
            <span class="p">};</span> 
                  
            <span class="n">TouchKit</span><span class="p">.</span><span class="nf">addGestureRecognizer</span><span class="p">(</span><span class="n">recognizer</span><span class="p">);</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>O <code class="language-plaintext highlighter-rouge">TKSwipeRecognizer</code> retorna valores bem completos sobre o swipe, com posição de início, posição final, direção e velocidade do swipe, de forma bem fácil de tratar no código. Além do Swipe, o TouchKit também traz informações sobre pinch, tap, long press, pan e até toques normais, caso necessário.</p>

<h4 id="aceleração">Aceleração</h4>

<p>O input de aceleração é reportado como um <code class="language-plaintext highlighter-rouge">Vector3</code> que representa a aceleração em valores de força G que o device está recebendo. É possível capturar e utilizar estes dados de forma bem simples, com o <code class="language-plaintext highlighter-rouge">Input.acceleration</code>:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="n">IEnumerator</span> <span class="nf">NonSmoothedAccelerate</span><span class="p">(){</span>
            <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">){</span>
                <span class="n">transform</span><span class="p">.</span><span class="n">localPosition</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">acceleration</span> <span class="p">*</span> <span class="n">strength</span><span class="p">;</span>
                <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForEndOfFrame</span><span class="p">();</span>                
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<p>O problema de usar o valor direto assim é esse aqui:</p>

<iframe src="https://gfycat.com/ifr/ShockedAthleticAlligatorsnappingturtle" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>
<p><span class="caption text-muted"><code class="language-plaintext highlighter-rouge">Input.acceleration</code>do jeito que ele realmente é</span></p>

<p>Você muito provavelmente vai querer suavizar estes valores pro jogador não achar que ele tem alguma tremedeira ou coisa do tipo, e é bem simples, é só usar o <code class="language-plaintext highlighter-rouge">SmoothDamp</code> do próprio <code class="language-plaintext highlighter-rouge">Vector3</code> que a gente pode definir o valor que vai ser suavizado, a “força” com que ele vai ser suavizado, e o delay da suavização, fazendo algo parecido com o seguinte código:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="n">IEnumerator</span> <span class="nf">Accelerate</span><span class="p">(){</span>
            <span class="n">Vector3</span> <span class="n">lastFramePosition</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">localPosition</span><span class="p">;</span>
            <span class="n">Vector3</span> <span class="n">velocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>            
            <span class="k">while</span><span class="p">(</span><span class="k">true</span><span class="p">){</span>
                <span class="n">baseline</span> <span class="p">=</span> <span class="n">Input</span><span class="p">.</span><span class="n">acceleration</span><span class="p">;</span>
                <span class="n">Vector3</span> <span class="n">accelData</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="nf">SmoothDamp</span><span class="p">(</span><span class="n">lastFramePosition</span><span class="p">,</span> <span class="n">baseline</span><span class="p">,</span> <span class="k">ref</span> <span class="n">velocity</span><span class="p">,</span> <span class="m">0.1f</span><span class="p">);</span> <span class="c1">//Inputs do sensor devem ser "limpos", senão ele fica pulando loucamente por aí              </span>
                <span class="n">Vector2</span> <span class="n">ad</span> <span class="p">=</span> <span class="p">(</span><span class="n">Vector2</span><span class="p">)</span> <span class="n">accelData</span><span class="p">;</span>  
                <span class="n">transform</span><span class="p">.</span><span class="nf">Translate</span><span class="p">(</span><span class="n">ad</span> <span class="p">*</span> <span class="n">strength</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">);</span>
                <span class="n">lastFramePosition</span> <span class="p">=</span> <span class="n">transform</span><span class="p">.</span><span class="n">localPosition</span><span class="p">;</span>            
                <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">WaitForEndOfFrame</span><span class="p">();</span>                
            <span class="p">}</span>
        <span class="p">}</span>

</code></pre></div></div>

<iframe src="https://gfycat.com/ifr/SarcasticDismalEidolonhelvum" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>
<p><span class="caption text-muted"><code class="language-plaintext highlighter-rouge">Input.acceleration</code> com suavização</span></p>

<h4 id="vibração">Vibração</h4>

<p>Não dá pra ter muito controle da vibração do device mas é bem fácil de fazer ele vibrar, caso o device tenha como fazer isso. (Não adianta tentar num iPad, por exemplo :p )</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">Vibrar</span><span class="p">(){</span>
	<span class="n">Handheld</span><span class="p">.</span><span class="nf">Vibrate</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="integração-com-o-mundo-nativo">Integração com o mundo nativo</h3>

<p>A Unity permite que o código C# interaja com várias linguagens de programação específicas de outros sistemas, como no nosso caso, o Objective-C, através dos <a href="http://docs.unity3d.com/Manual/NativePlugins.html">Native Plugins</a>. Não só isso, como ela também disponibiliza alguns wrappers básicos, para que você não se perca na burocracia de trazer o resultado do Obj-C para o C#.</p>

<h4 id="gamecenter">GameCenter</h4>

<p>As APIs da Unity já provem um nível bem básico de integração com o GameCenter, utilizando a classe <a href="http://docs.unity3d.com/ScriptReference/Social.html">Social</a>, que possui as funcionalidades básicas de autenticação, leaderboards e achievements.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="k">void</span> <span class="nf">Start</span> <span class="p">()</span> <span class="p">{</span>
            <span class="n">Social</span><span class="p">.</span><span class="n">localUser</span><span class="p">.</span><span class="nf">Authenticate</span><span class="p">(</span><span class="n">SocialUserLogin</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">void</span> <span class="nf">SocialUserLogin</span><span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">success</span><span class="p">){</span>
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"do stuff with logged user here"</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>                
                <span class="n">Debug</span><span class="p">.</span><span class="nf">Log</span><span class="p">(</span><span class="s">"disable gamecenter features until player logs in"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
</code></pre></div></div>

<h4 id="low-power-mode">Low Power Mode</h4>

<p>Com a interoperabilidade de código, podemos fazer coisas interessantes, como reduzir o framerate do nosso jogo quando o iOS9 está em modo Low Power para economizar bateria.</p>

<p>Esse exemplo é bem simples, e mostra como é fácil misturar o Objective C com o C#. Em um arquivo .mm, tenho o seguinte código:</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">extern</span> <span class="s">"C"</span> <span class="n">bool</span> <span class="nf">getLowPowerMode</span><span class="p">(){</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">NSProcessInfo</span> <span class="nf">processInfo</span><span class="p">]</span> <span class="nf">isLowPowerModeEnabled</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>E eu acesso esse código na minha classe pelo namespace <code class="language-plaintext highlighter-rouge">System.Runtime.InteropServices</code>, apenas declarando o nome e o retorno do método no corpo da classe:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.Runtime.InteropServices</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">CocoaHeadsBR</span><span class="p">{</span>   
    <span class="k">public</span> <span class="k">class</span> <span class="nc">DeviceManager</span> <span class="p">{</span>        
        <span class="p">[</span><span class="nf">DllImport</span> <span class="p">(</span><span class="s">"__Internal"</span><span class="p">)]</span> <span class="k">private</span> <span class="k">static</span> <span class="k">extern</span> <span class="kt">bool</span> <span class="nf">getLowPowerMode</span><span class="p">();</span>
        
        <span class="k">public</span> <span class="k">static</span> <span class="kt">bool</span> <span class="n">isLowPowerActive</span><span class="p">{</span>
            <span class="k">get</span><span class="p">{</span>
                <span class="k">return</span> <span class="nf">getLowPowerMode</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>E aí, preferencialmente no startup do nosso jogo, modificamos o framerate alvo do jogo, que será menor caso o Low Power Mode esteja ativo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">void</span> <span class="nf">Start</span><span class="p">(){</span>
	<span class="n">Application</span><span class="p">.</span><span class="n">targetFrameRate</span> <span class="p">=</span> <span class="n">DeviceManager</span><span class="p">.</span><span class="n">isLowPowerActive</span><span class="p">?</span> <span class="m">30</span><span class="p">:</span> <span class="m">60</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="câmera">Câmera</h4>

<p>Como com os nossos outros exemplos, a Unity dá uma forma bem fácil de acessar a câmera também. Usando a classe <code class="language-plaintext highlighter-rouge">WebCamTexture</code>.</p>

<iframe src="https://gfycat.com/ifr/GloomySpitefulAmericanwigeon" frameborder="0" scrolling="no" width="600" height="340" allowfullscreen=""></iframe>

<p>Na minha cena tenho algumas texturas que eu quero que sejam fotos que eu vou tirar na hora (Aqueles quadrados brancos ali no meio dos estandartes), e é bem simples de fazer isso funcionar.</p>

<p>Para capturar a imagem, as ações dos botões na tela são estas:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="n">GameObject</span> <span class="n">cameraOverlay</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">RawImage</span> <span class="n">camImage</span><span class="p">;</span> 
        
        <span class="n">WebCamTexture</span> <span class="n">wct</span><span class="p">;</span>
        
        <span class="k">void</span> <span class="nf">Awake</span><span class="p">(){</span>
            <span class="n">wct</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebCamTexture</span><span class="p">();</span>                                               
        <span class="p">}</span>     

        <span class="k">public</span> <span class="k">void</span> <span class="nf">StartCamera</span><span class="p">(){</span>
            <span class="n">camImage</span><span class="p">.</span><span class="n">texture</span> <span class="p">=</span> <span class="n">wct</span><span class="p">;</span>            
            <span class="n">camImage</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">mainTexture</span> <span class="p">=</span> <span class="n">wct</span><span class="p">;</span>            
            <span class="n">wct</span><span class="p">.</span><span class="nf">Play</span><span class="p">();</span> <span class="c1">//Começa a modificar a RawImage que aparecerá como overlay na tela</span>
            <span class="n">cameraOverlay</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">//Abre o overlay</span>
        <span class="p">}</span>
        
        <span class="k">public</span> <span class="k">void</span> <span class="nf">CaptureImage</span><span class="p">(){</span>
            <span class="n">cameraOverlay</span><span class="p">.</span><span class="nf">SetActive</span><span class="p">(</span><span class="k">false</span><span class="p">);</span> <span class="c1">//Fecha o overlay</span>
            <span class="n">wct</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span> <span class="c1">//Para o RawImage no último frame capturado</span>
            <span class="n">CameraSceneManager</span><span class="p">.</span><span class="n">sharedInstance</span><span class="p">.</span><span class="nf">PostPictureIntoStandard</span><span class="p">(</span><span class="n">camImage</span><span class="p">.</span><span class="n">texture</span><span class="p">);</span>     
        <span class="p">}</span>
</code></pre></div></div>

<p>Para colocar a imagem dentro do jogo, na textura, o <code class="language-plaintext highlighter-rouge">CameraSceneManager</code> faz isto:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="k">void</span> <span class="nf">PostPictureIntoStandard</span><span class="p">(</span><span class="n">Texture</span> <span class="n">photo</span><span class="p">){</span>
            <span class="k">foreach</span><span class="p">(</span><span class="n">Standard</span> <span class="n">s</span> <span class="k">in</span> <span class="n">standards</span><span class="p">){</span>
                <span class="n">s</span><span class="p">.</span><span class="nf">ApplyPhoto</span><span class="p">(</span><span class="n">photo</span><span class="p">);</span>    
            <span class="p">}</span>
        <span class="p">}</span>        
</code></pre></div></div>

<p>E cada um dos estandartes na cena só faz isso:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">public</span> <span class="n">MeshRenderer</span> <span class="n">meshToApplyPhoto</span><span class="p">;</span> <span class="c1">//Esse MeshRenderer é colocado direto no Inspector da Unity</span>
        
        <span class="k">public</span> <span class="k">void</span> <span class="nf">ApplyPhoto</span><span class="p">(</span><span class="n">Texture</span> <span class="n">photo</span><span class="p">){</span>
            <span class="n">meshToApplyPhoto</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">mainTexture</span> <span class="p">=</span> <span class="n">photo</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Fazer funcionar direito é outra história. A texture que a Unity retornou no <code class="language-plaintext highlighter-rouge">WebCamTexture</code> está invertida, mas como com o exemplo da aceleração, é possível brincar o suficiente com esses settings para deixar o input da câmera bem legalzinho :)</p>

<h2 id="conclusão">Conclusão</h2>

<p>Com esse material todo aí vocês já tem uma boa base para desenvolver o jogo usando as features do iOS que tanto queriam. Mal posso esperar para ver o que vocês vão fazer!</p>

<p>O projeto que eu usei para fazer todas as imagens e vídeos utilizados para ilustrar os code samples estão no <a href="https://github.com/loloop/equinox">GitHub</a> :D</p>

<p>A imagem do Header é do jogo <a href="http://www.firewatchgame.com"><strong>Firewatch</strong></a>, desenvolvido pela empresa americana <a href="http://www.camposanto.com">Campo Santo</a> com Unity3D para PS4 e OS X, a imagem que abre o post é de <a href="https://superhotgame.com"><strong>SUPER HOT</strong></a>, também desenvolvido com Unity3D, para OS X. A Unity tem um espaço de showcase dos jogos desenvolvidos usando ela, o <a href="http://madewith.unity.com/games?type=featured&amp;search=&amp;platform=ios&amp;genre=">Made With Unity</a>. Se você quiser conhecer mais jogos desenvolvidos com ela, é só dar um pulinho lá :)</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/xcode/2016/03/09/vamos-falar-de-xcode/" data-toggle="tooltip" data-placement="top" title="Vamos falar de Xcode">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/regex/2016/03/11/o-que-sao-expressoes-regulares/" data-toggle="tooltip" data-placement="top" title="Seja um desenvolvedor regular">Próximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto — Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
