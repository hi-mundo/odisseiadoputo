<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento ‚Äî artigos, tutoriais e opini√£o.">

    <title>Enums para o nosso bem - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/ios/2017/03/16/swift-enums/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Enums para o nosso bem</h1>
                        
                        <h2 class="subheading">c√≥digo mais seguro, otimizado e leg√≠vel</h2>
                        
                        <span class="meta">Postado por Daniel Bonates em 16/03/2017</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Enums para o nosso bem&url=http://localhost:4000/ios/2017/03/16/swift-enums/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/ios/2017/03/16/swift-enums/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/ios/2017/03/16/swift-enums/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/ios/2017/03/16/swift-enums/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p><a href="https://bonates.com" target="_blank">Daniel Bonates</a>, problem solver &amp; iOS guy at Peixe Urbano. Minhas paix√µes digitais s√£o <a href="https://dribbble.com/dbonates" target="_blank">design</a> e desenvovimento de <a href="http://bonates.com/index.html#easybalance" target="_blank">apps</a> para a plataforma Apple. Vivo dessas coisas desde 1998 e meu primeiro app foi para o MacOS 9, em 1991, um player de audio ;) Fiquei desviado produzindo backend e frontend para web, at√© que a chegada do iPhone me salvou mais uma vez, quando ent√£o comprei um Mac e voltei a ser feliz, hoje focado em MacOS, iOS e derivados!</p>
</blockquote>

<h4 id="disclaimer-1-estarei-tratando-aqui-do-assunto-enum-usado-swift"><code class="language-plaintext highlighter-rouge">Disclaimer 1</code>: Estarei tratando aqui do assunto <em>Enum</em> usado <strong>Swift</strong>.</h4>

<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Sempre que falo de Enums, o fa√ßo com um sentimento de gratid√£o por um recurso que j√° fez muito por mim e pelo c√≥digo que escrevo. Antes dele, era quase tudo literal, sabe‚Ä¶fr√°geis strings e constantes para todo lado! Nesse artigo enfrentarei 3 desafios: passar conte√∫do √∫til, ser pragm√°tico e objetivo, e testar minha capacidade de s√≠ntese escrevendo o m√≠nimo de bl√°bl√°bl√° poss√≠vel.</p>

<h3 id="sobre-a-minha-querida-objective-c">Sobre a minha querida Objective-C:</h3>
<p><img src="https://media.giphy.com/media/13tHtQriubWlHy/giphy.gif" alt="Amor eterno." /></p>

<p><em>mas voltando ao assunto‚Ä¶</em></p>

<h2 id="enum-fundamental">Enum fundamental</h2>
<p>Come√ßando do come√ßo, usamos enums para enumerar casos poss√≠veis (ou se preferir, cases ou ainda, statements):</p>

<p>Considere essa estrutura:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Oferta</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">titulo</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">tipo</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span></code></pre></figure>

<p>Essa <em>struct</em> possui um t√≠tulo que provavelmente √© √∫nico. Mas ser√° que podemos dizer o mesmo do <em>tipo</em>? Vejamos o caso desse array:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">ofertas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Agua Mineral"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"normal"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Macarr√£o"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"extra"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Vassoura"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"normal"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Shampoo"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"normal"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Sabonente"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"extra"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Coleira"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"extra"</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Nutella"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="s">"relampago"</span><span class="p">)</span>
<span class="p">]</span></code></pre></figure>

<p>Repeti√ß√£o, margem de erro, retardamento no entendimento de todos os tipos‚Ä¶ tudo isso eu sou capaz de sofrer. Ent√£o, que tal enumerar os tipos de ofertas? Sugest√£o:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">DescontoTipo</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">normal</span>
    <span class="k">case</span> <span class="n">extra</span>
    <span class="k">case</span> <span class="n">relampago</span>
<span class="p">}</span></code></pre></figure>

<p>Da√≠ nossa struct ficaria ao inv√©s de usar String em <em>tipo</em>, usa nosso enum <em>DescontoTipo</em>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Oferta</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">titulo</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">tipo</span><span class="p">:</span> <span class="kt">DescontoTipo</span>
<span class="p">}</span></code></pre></figure>

<p>da√≠ o nosso array de ofertas fica assim:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">ofertas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Agua Mineral"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Macarr√£o"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">extra</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Vassoura"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Shampoo"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Sabonente"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">extra</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Coleira"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">extra</span><span class="p">),</span>
    <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Nutella"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">relampago</span><span class="p">)</span>
<span class="p">]</span></code></pre></figure>

<p>Simples, efetivo e <strong>strongly typed</strong>! Sempre que formos criar uma <code class="language-plaintext highlighter-rouge">Oferta</code>, o compilador n√£o vai aceitar nada que seja diferente de <strong>DescontoTipo</strong> na propriedade <em>tipo</em>, prevenindo erros, entre outras vantagens que j√° citei.</p>

<h2 id="refor√ßando-tipos-e-legibilidade">Refor√ßando tipos e legibilidade</h2>

<p><strong>Enums</strong> tamb√©m podem tornar seu c√≥digo muito mais leg√≠vel e flex√≠vel. Por exemplo, e se nossa <code class="language-plaintext highlighter-rouge">Oferta</code> possuir um status de disponibilidade? Talvez o nosso primeiro impulso seria o de criar uma propriedade do tipo <em>Bool</em>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Oferta</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">titulo</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">tipo</span><span class="p">:</span> <span class="kt">DescontoTipo</span>
    <span class="k">let</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">Bool</span>
<span class="p">}</span></code></pre></figure>

<p>√â ok trabalhar aqui com <strong>true/false</strong>. Vai dar conta de boa, certo?! Depende!</p>

<p>Fazendo isso voc√™ acaba de condenar a coitada da <code class="language-plaintext highlighter-rouge">Oferta</code> a estar dispon√≠vel ou n√£o, apenas 2 estados! Quer ver? E se a turma de produto chega depois e diz que a oferta pode estar dispon√≠vel, indispon√≠vel, suspensa, encerrada, etc?</p>

<p><img src="http://i.giphy.com/l0MYNLZmHQbryIMFO.gif" alt="Tudo √© relativo!" /></p>

<p>Veja como o uso de um <em>enum</em> no lugar de Bool, vai te dar muito mais flexibilidade:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">OfertaStatus</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">disponivel</span>
    <span class="k">case</span> <span class="n">expirada</span>
    <span class="k">case</span> <span class="n">suspensa</span>
    <span class="k">case</span> <span class="n">encerrada</span>
<span class="p">}</span></code></pre></figure>

<p>Nossa <code class="language-plaintext highlighter-rouge">Oferta</code> fica assim:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">struct</span> <span class="kt">Oferta</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">titulo</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">tipo</span><span class="p">:</span> <span class="kt">DescontoTipo</span>
    <span class="k">let</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">OfertaStatus</span>
<span class="p">}</span></code></pre></figure>

<p>da√≠ para criar uma uma oferta:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">oferta</span> <span class="o">=</span> <span class="kt">Oferta</span><span class="p">(</span><span class="nv">titulo</span><span class="p">:</span> <span class="s">"Nutella"</span><span class="p">,</span> <span class="nv">tipo</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">,</span> <span class="nv">status</span><span class="p">:</span> <span class="o">.</span><span class="n">disponivel</span><span class="p">)</span></code></pre></figure>

<p>nice üòä!</p>

<p>Acredito que at√© aqui, j√° deu pra ver que usar <strong>enums</strong> √© uma obriga√ß√£o se voc√™ pretende manter seu c√≥digo leg√≠vel e eficiente. Ent√£o vamos agora a um case bem mais comum e pragm√°tico.</p>

<hr />

<h2 id="enum-na-rota-um-caso-mais-pro">Enum na rota, um caso mais ‚ÄúPRO‚Äù</h2>

<p>Diz-se que em <strong>Swift</strong> <em>enums</em> tem super poderes. E com raz√£o. S√£o value types, podem ter extensions, variaveis computadas, receber parametros, ter metodos etc. Vamos explorar algumas dessas ferramentas e mostrar como isso pode ser bom pra gente:</p>

<p>A partir daqui:</p>

<blockquote>
  <p>Nosso <strong>cen√°rio</strong>: vamos simular que nosso app consome uma API da web, que possui v√°rias rotas e vers√µes.</p>
</blockquote>

<blockquote>
  <p>Nossa <strong>miss√£o</strong>: criar um <strong>enum</strong> <code class="language-plaintext highlighter-rouge">Router</code> para gerenciar todas as rotas do nosso app.</p>
</blockquote>

<h4 id="disclaimer-2-sobre-a-sacada-que-vamos-abordar"><code class="language-plaintext highlighter-rouge">Disclaimer 2</code>: Sobre a ‚Äòsacada‚Äô que vamos abordar:</h4>

<p>Embora a solu√ß√£o final que vou apresentar aqui n√£o seja de minha autoria, acho que vale como caso real pois foi justamente num app super complexo de ecommerce que a vi implementada. Achei uma solu√ß√£o sensacional assim que vi, e a partir da√≠ adotei (com pequenas modifica√ß√µes) em todo app que trabalho. O autor dessa sacada genial foi o <a href="https://twitter.com/CassiusPacheco_" target="_blank">Cassius Pacheco</a> que havia deixado sua marca no app pouco antes de eu chegar na empresa. Vamos destrinchar passo a passo essa solu√ß√£o pra entender como ele conseguiu resolver um sistema complexo de rotas de uma API explorando todo poder de um <strong>Enum</strong> em <em>Swift</em>.</p>

<p>Mas vamos come√ßar devagar, com uma vers√£o bem simples da <em>API</em> e vamos aumentando a complexidade para ver at√© onde o uso de um <strong>enum</strong> pode nos ajudar.</p>

<p>Nossa primeira vers√£o da <em>API</em> √© <code class="language-plaintext highlighter-rouge">https://bonates.com/usuarios</code>, que retorna um <em>json</em> com a lista dos usu√°rios.</p>

<p>Essa √© a <code class="language-plaintext highlighter-rouge">func</code> que usaremos para testar a constru√ß√£o da nossa rota:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// essa √© a nossa fun√ß√£o que carrega dados da web</span>
<span class="kd">func</span> <span class="nf">loadData</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">URLRequest</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTask</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="k">in</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"loaded!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Para a primeira vers√£o da <em>API</em>, esse c√≥digo d√° conta de fazer o download dos dados:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">usersURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bonates.com/usuarios"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">usersURL</span><span class="p">)</span>

<span class="c1">// carregando a lista de usu√°rios</span>
<span class="nf">loadData</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span></code></pre></figure>

<p><em>Usei <strong>force unwrap</strong> aqui! Relaxa que j√° vai passar!</em></p>

<p>Isso pro seu teste num <em>Playground</em> t√° ok, mas num app, consumindo uma API de verdade, uma url s√≥ n√£o √© nossa realidade, confere?</p>

<p>E tem mais! Agora precisamos acessar agora uma nova rota da nossa api que retorna a lista de ofertas: <code class="language-plaintext highlighter-rouge">https://bonates.com/ofertas</code>. Bastaria criar uma nova e fedorenta variavel <code class="language-plaintext highlighter-rouge">ofertasURL</code>, certo? N√£o! Vamos criar nosso <em>enum</em> para come√ßar a cuidar das rotas:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">Router</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">usuarios</span> <span class="o">=</span> <span class="s">"https://bonates.com/usuarios"</span>
    <span class="k">case</span> <span class="n">ofertas</span> <span class="o">=</span> <span class="s">"https://bonates.com/ofertas"</span>
<span class="p">}</span></code></pre></figure>

<p>Da√≠ basta usar nosso <em>Router</em> pra buscar a url da vez:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">usersURL</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="kt">Router</span><span class="o">.</span><span class="n">usuarios</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span><span class="o">!</span> <span class="c1">// force unwrap de novo :boom:</span></code></pre></figure>

<p>Pronto, de novo nos livramos de literais e quem olhar essa linha de c√≥digo vai saber que estamos recuperando uma url relacionada a <em>usuarios</em>. Bem mais profissional, n√£o?! (Eu sei, mas ainda tem a exclama√ß√£o do mal ali, calma, j√° disse)</p>

<p>Mas isso √© muito pouco perto do que ainda podemos fazer pra esse c√≥digo ficar bom. E tem mais uma novidade: nossa api retorna tamb√©m ofertas favoritas do usu√°rio logado. O link √© esse: <code class="language-plaintext highlighter-rouge">https://bonates.com/ofertas/favoritas</code></p>

<p><strong>Enums</strong> aceitam vari√°veis computadas, ent√£o, ao inv√©s de criar outro case <code class="language-plaintext highlighter-rouge">favoritas</code> e retornar toda a <strong>url inteira</strong>, podemos torna-la mais din√¢mica gerando-a a partir de seus componentes. Isso fica assim:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">Router</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">usuarios</span>
    <span class="k">case</span> <span class="n">ofertas</span>
    <span class="k">case</span> <span class="n">favoritas</span>
    
    <span class="c1">// host comum a todos</span>
    <span class="k">var</span> <span class="nv">basePath</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://bonates.com"</span>
    <span class="p">}</span>
    
    <span class="c1">// o path que varia de acordo com o case</span>
    <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">usuarios</span><span class="p">:</span> <span class="k">return</span> <span class="s">"usuarios"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ofertas</span><span class="p">:</span> <span class="k">return</span> <span class="s">"ofertas"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">favoritas</span><span class="p">:</span> <span class="k">return</span> <span class="s">"ofertas/favoritas"</span>
        <span class="p">}</span>
    <span class="p">}</span>
       
    <span class="c1">// o request que nos interessa</span>
    <span class="k">var</span> <span class="nv">request</span><span class="p">:</span><span class="kt">URLRequest</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">let</span> <span class="nv">baseUrlPath</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">basePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">"</span>
        <span class="k">let</span> <span class="nv">baseURL</span> <span class="o">=</span> <span class="kt">URLComponents</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">baseUrlPath</span><span class="p">)</span>
        
        <span class="k">guard</span>
            <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">baseURL</span><span class="p">?</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Imposs√≠vel iniciar request com essa url."</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Nosso <code class="language-plaintext highlighter-rouge">Router</code> agora nos retorna um <strong>request</strong> pronto, bastando pra isso dizer qual request queremos, inclusive com a ajuda do <em>auto complete</em> para os mais pregui√ßosos, me included o/</p>

<p><img src="/img/dbonates/enums-autocomplete.png" /></p>

<p>So far, so good ;) Olha como agora um simples <em>if-let</em> resolve nossos problemas de request v√°lido e uso de <em>force unwrap</em>. No c√≥digo a seguir, o <strong>request</strong> vai me retornar <code class="language-plaintext highlighter-rouge">https://bonates.com/ofertas/favoritas</code> lindamente, safe and sound!</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">if</span> <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">Router</span><span class="o">.</span><span class="n">favoritas</span><span class="o">.</span><span class="n">request</span> <span class="p">{</span>
    <span class="nf">loadData</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h3 id="passando-parametros-e-query-strings">Passando parametros e query strings</h3>

<p>Nossa api agora tem um recurso que lista apenas os usu√°rios ativos: <code class="language-plaintext highlighter-rouge">https://bonates.com/usuarios?status=ativos</code>. Da√≠, evoluindo nosso enum:</p>

<p>1 - mudamos o case <code class="language-plaintext highlighter-rouge">.usuarios</code> para aceitar parametros:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">case</span> <span class="nf">usuarios</span><span class="p">([</span><span class="kt">String</span><span class="p">:</span><span class="kt">Any</span><span class="p">])</span></code></pre></figure>

<p>2 - adicionamos uma vari√°vel computada:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="nv">parametros</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">usuarios</span><span class="p">(</span><span class="k">let</span> <span class="nv">urlParams</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">urlParams</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[:]</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>3 - E fazemos uso dela na gera√ß√£o do <em>request</em>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="o">...</span>
<span class="n">baseURL</span><span class="p">?</span><span class="o">.</span><span class="n">queryItems</span> <span class="o">=</span> <span class="n">parametros</span><span class="o">.</span><span class="n">map</span><span class="p">{</span> <span class="n">qParamter</span> <span class="k">in</span>
    <span class="k">return</span> <span class="kt">URLQueryItem</span><span class="p">(</span>
        <span class="nv">name</span><span class="p">:</span> <span class="n">qParamter</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> 
        <span class="nv">value</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">qParamter</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span>
    <span class="p">)</span>
<span class="p">}</span>
<span class="o">...</span></code></pre></figure>

<p>Agora qualquer quantidade de parametros passados como <code class="language-plaintext highlighter-rouge">String:Any</code> vai ser aceito e entrar como <em>query string</em>:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// request vai retornar: </span>
<span class="c1">// https://bonates.com/usuarios?cidade=rio-de-janeiro&amp;status=ativo</span>
<span class="k">let</span> <span class="nv">parametros</span> <span class="o">=</span> <span class="p">[</span><span class="s">"status"</span><span class="p">:</span><span class="s">"ativo"</span><span class="p">,</span> <span class="s">"cidade"</span><span class="p">:</span> <span class="s">"rio-de-janeiro"</span><span class="p">]</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">usuariosAtivosReq</span> <span class="o">=</span> <span class="kt">Router</span><span class="o">.</span><span class="nf">usuarios</span><span class="p">(</span><span class="n">parametros</span><span class="p">)</span><span class="o">.</span><span class="n">request</span> <span class="p">{</span>
    <span class="nf">loadData</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<h3 id="metodo-http">Metodo HTTP</h3>

<p>Perto do que j√° fizemos, incluir a capacidade de atribuir um m√©todo http de acordo com o caso acaba sendo trivial. Basta adicionar uma vari√°vel no <em>Router</em> com essa finalidade:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="nv">metodo</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"GET"</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>S√≥ deixei o <code class="language-plaintext highlighter-rouge">GET</code> implementado como case padr√£o. Incrementar um <code class="language-plaintext highlighter-rouge">POST, DELETE, etc</code> √© com voc√™!</p>

<p><img src="https://media.giphy.com/media/yoJC2K6rCzwNY2EngA/giphy.gif" alt="" /></p>

<p>O Router at√© aqui ficou assim:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">Router</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">usuarios</span><span class="p">([</span><span class="kt">String</span><span class="p">:</span><span class="kt">Any</span><span class="p">])</span>
    <span class="k">case</span> <span class="n">ofertas</span>
    <span class="k">case</span> <span class="n">favoritas</span>
    
    <span class="k">var</span> <span class="nv">basePath</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">"https://bonates.com"</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">path</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">usuarios</span><span class="p">:</span> <span class="k">return</span> <span class="s">"usuarios"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">ofertas</span><span class="p">:</span> <span class="k">return</span> <span class="s">"ofertas"</span>
        <span class="k">case</span> <span class="o">.</span><span class="nv">favoritas</span><span class="p">:</span> <span class="k">return</span> <span class="s">"ofertas/favoritas"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">parametros</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">case</span> <span class="o">.</span><span class="nf">usuarios</span><span class="p">(</span><span class="k">let</span> <span class="nv">urlParams</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">urlParams</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[:]</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">metodo</span><span class="p">:</span> <span class="kt">String</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="k">self</span> <span class="p">{</span>
        <span class="k">default</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"GET"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">request</span><span class="p">:</span><span class="kt">URLRequest</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="k">let</span> <span class="nv">baseUrlPath</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">basePath</span><span class="se">)</span><span class="s">/</span><span class="se">\(</span><span class="n">path</span><span class="se">)</span><span class="s">"</span>
        <span class="k">var</span> <span class="nv">baseURL</span> <span class="o">=</span> <span class="kt">URLComponents</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">baseUrlPath</span><span class="p">)</span>
        
        <span class="n">baseURL</span><span class="p">?</span><span class="o">.</span><span class="n">queryItems</span> <span class="o">=</span> <span class="n">parametros</span><span class="o">.</span><span class="n">map</span><span class="p">{</span> <span class="n">qParamter</span> <span class="k">in</span>
            <span class="k">return</span> <span class="kt">URLQueryItem</span><span class="p">(</span><span class="nv">name</span><span class="p">:</span> <span class="n">qParamter</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nv">value</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">qParamter</span><span class="o">.</span><span class="n">value</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">guard</span>
            <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">baseURL</span><span class="p">?</span><span class="o">.</span><span class="n">url</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Imposs√≠vel iniciar request com essa url."</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        
        
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">URLRequest</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">request</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Pronto! Cobrimos um caso real explorando os recursos de enumera√ß√£o dispon√≠veis em <strong>Swift</strong> para criarmos um sistema de rotas f√°cil de escalar e fazer manuten√ß√£o. Tem mais possibilidades, mas basicamente elas seriam uma combina√ß√£o do que j√° fizemos aqui ;)</p>

<h2 id="enums--generics---o-poder-n√£o-tem-limites">Enums + Generics - o poder n√£o tem limites!</h2>

<p>E pra fechar, voc√™ sabia que uma vari√°vel optional na real implementa o enum Optional da biblioteca padr√£o do Swift?</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="c1">// Optional simplificado</span>
<span class="kd">enum</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">none</span>
    <span class="k">case</span> <span class="nf">some</span><span class="p">(</span><span class="kt">T</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>ou seja, quando definimos uma vari√°vel como <em>optional</em>, basicamente estamos fazendo isso:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">variavel1</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span> <span class="c1">// nil</span>
<span class="k">let</span> <span class="nv">variavel2</span><span class="p">:</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">.</span><span class="k">none</span> <span class="c1">// nil</span>
<span class="k">let</span> <span class="nv">variavel3</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span> <span class="o">=</span> <span class="mi">42</span> <span class="c1">// 42</span>
<span class="k">let</span> <span class="nv">variavel4</span><span class="p">:</span> <span class="kt">Optional</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="o">.</span><span class="nf">some</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="c1">//42</span></code></pre></figure>

<p>Viu s√≥?! <strong>Enum</strong> est√° no cora√ß√£o do Swift üòä!</p>

<p>Usando essa mesma id√©ia, podemos criar por exemplo um recurso muito √∫til para tratar erro e sucesso em requests:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">enum</span> <span class="kt">RequestResult</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nf">successo</span><span class="p">(</span><span class="kt">T</span><span class="p">)</span>
    <span class="k">case</span> <span class="nf">erro</span><span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>A dica aqui √© sua rotina retornar um enum <em>RequestResult</em>, verificando o resultado da opera√ß√£o:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">WebService</span><span class="o">.</span><span class="nf">json</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span>
    <span class="k">switch</span> <span class="n">result</span> <span class="p">{</span>
    <span class="k">case</span> <span class="o">.</span><span class="nf">erro</span><span class="p">(</span><span class="k">let</span> <span class="nv">erro</span><span class="p">):</span>
        <span class="c1">// tratar o erro</span>
        
    <span class="k">case</span> <span class="o">.</span><span class="nf">successo</span><span class="p">(</span><span class="k">let</span> <span class="nv">json</span><span class="p">):</span>
        <span class="c1">// usar os dados retornados</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Fica f√°cil, n√©?!</p>

<h2 id="considera√ß√µes-finais">Considera√ß√µes finais</h2>

<p>Bem, esses s√£o os meus argumentos pra te convencer de que enumerar seus dados usando os super poderes da nossa linguagem do cora√ß√£o, vai deixar seu c√≥digo lindo, seus coleguinhas v√£o curtir quando precisarem dar manuten√ß√£o e provavelmente o Crashlytics vai dar uma relaxada porque voc√™ n√£o tipou errado! Espero ter contribu√≠do com algumas id√©ias e uma inspira√ß√£o a mais para tornar seu c√≥digo mais seguro, organizado e f√°cil de ler.</p>

<p>D√∫vidas, coment√°rios, whatever, pode tacar por aqui, me parar na rua, ou me procurar l√° no <a href="http://iosdevbr.herokuapp.com">Slack da comunidade iOS</a>, onde estou sempre presente, ainda que apenas invis√≠vel s√≥ acompanhando as <em>tretas</em>!</p>

<p>Abra√ßos e at√© logo!</p>



                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/reativo/2017/03/16/Eu-preciso-reativar-minha-aplicacao/" data-toggle="tooltip" data-placement="top" title="Eu preciso reativar minha aplica√ß√£o?">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/view-code/2017/03/17/com-quantas-views-se-faz-um-APP/" data-toggle="tooltip" data-placement="top" title="Com quantas views se faz uma APP?">Pr√≥ximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto ‚Äî Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
