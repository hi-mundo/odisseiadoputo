<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento ‚Äî artigos, tutoriais e opini√£o.">

    <title>LLDB √© seu amigo - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/ios/2017/03/07/lldb-e-seu-amigo/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>LLDB √© seu amigo</h1>
                        
                        <h2 class="subheading">Como usar LLDB para melhorar seu workflow</h2>
                        
                        <span class="meta">Postado por Fernando Cezar Bunn em 07/03/2017</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=LLDB √© seu amigo&url=http://localhost:4000/ios/2017/03/07/lldb-e-seu-amigo/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/ios/2017/03/07/lldb-e-seu-amigo/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/ios/2017/03/07/lldb-e-seu-amigo/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/ios/2017/03/07/lldb-e-seu-amigo/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>Fernando Bunn (<a href="https://twitter.com/fcbunn" target="_blank">@fcbunn</a>) come√ßou a trabalhar com mobile como um hobby desde 2006 na √©poca que os apps eram feitos em J2ME. Dedicou sua carreira ao iOS desde 2008. J√° fez apps para empresas Fortune 500, foi CEO de uma empresa focada em mobile apps, atualmente trabalha como Mobile Lead Developer e nas horas vagas gosta de reclamar do cocoapods no <a href="http://iosdevbr.herokuapp.com" target="_blank">Slack</a>.</p>
</blockquote>

<h2 id="motiva√ß√£o">Motiva√ß√£o</h2>
<p>Esse dezembro dei uma palestra na <a href="http://cocoaheadsconference.com.br" target="_blank">primeira confer√™ncia nacional do CocoaHeads</a> (Valeu pelo convite, pessoal) e decidi falar sobre LLDB. Fiquei um pouco preocupado no in√≠cio por talvez ser um assunto ‚Äúbatido‚Äù, mas tive um feedback muito positivo tanto pessoalmente quanto no twitter <a href="https://twitter.com/guibayma/status/805104900464111616" target="_blank">1</a>, <a href="https://twitter.com/walmyrcarvalho/status/805104805748346880" target="_blank">2</a>, <a href="https://twitter.com/emannuel_oc/status/805101998924320768" target="_blank">3</a>‚Ä¶ e gra√ßas a press√£o social do <a href="https://twitter.com/_inside" target="_blank">Rambo</a> e <a href="https://twitter.com/tholanda" target="_blank">Holanda</a>, resolvi escrever esse blog post sobre o assunto aqui no EquinociOS.</p>

<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>LLDB √© um assunto extenso, ao inv√©s de um blog post daria para escrever um livro sobre esse tema, mas a ideia aqui √© passar algumas dicas de como tenho usado o LLDB ao longo desses anos alguns exemplos pr√°ticos para realmente ajudar o dia a dia. Para uma vis√£o aprofundada e detalhada sobre LLDB, recomendo o <a href="http://lldb.llvm.org" target="_blank">site do projeto</a></p>

<h2 id="o-que-√©-lldb">O que √© LLDB?</h2>
<p>LLDB √© basicamente o debugger default que vem nas novas vers√µes do Xcode. Ele veio para substituir o antigo GDB e uma das coisas bacanas dele √© que ele utiliza a LLVM para expression parse, algo muito √∫til que vamos ver mais √† frente.</p>

<p>Curiosidade: O LLDB no <a href="http://lldb.llvm.org" target="_blank">site oficial do projeto</a> suporta C/C++, RenderScript e Objective-C. A vers√£o que vem no Xcode est√° no <a href="https://github.com/apple/swift-lldb" target="_blank">Github da Apple</a>. Isso pode ser conferido ao rodar o comando <code class="language-plaintext highlighter-rouge">language</code> que lista as linguagens suportadas.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) language
     Commands specific to a source language.

Syntax: language &lt;language-name&gt; &lt;subcommand&gt; [&lt;subcommand-options&gt;]

The following subcommands are supported:

      cplusplus    -- Commands for operating on the C++ language runtime.
      objc         -- Commands for operating on the Objective-C language
                      runtime.
      renderscript -- Commands for operating on the RenderScript runtime.
      swift        -- A set of commands for operating on the Swift Language
                      Runtime.

For more help on any particular subcommand, type 'help &lt;command&gt; &lt;subcommand&gt;'.
</code></pre></div></div>

<p>E comparando os comment headers do runtime do <a href="https://github.com/apple/swift-lldb/blob/68b732cd24e2f2376c53a6117f114d8e07c51964/source/Target/SwiftLanguageRuntime.cpp" target="_blank">Swift</a> e do <a href="https://github.com/apple/swift-lldb/blob/68b732cd24e2f2376c53a6117f114d8e07c51964/source/Target/ObjCLanguageRuntime.cpp" target="_blank">Objectiive-C</a></p>

<h2 id="s√≥-um-testezinho">S√≥ um ‚Äútestezinho‚Äù</h2>
<p>Quantas vezes voc√™ j√° alterou o seu c√≥digo apenas para fazer ‚Äúum testezinho‚Äù? Coisas simples como situa√ß√µes onde voc√™ quer saber o valor de uma vari√°vel e acaba fazendo algo como isso</p>

<pre><code class="language-objective-c">NSLog(@"WTF %@", whatIsThis);
</code></pre>
<p>Ou precisou for√ßar uma condi√ß√£o para testar um fluxo espec√≠fico e fez isso aqui?</p>

<pre><code class="language-objective-c">if (myCondition || YES) {
    //do stuff
}
</code></pre>
<p>Sem contar que toda vez voc√™ tem que recompilar, rodar o app, esperar o simulador ou device e chegar no lugar no qual voc√™ quer testar (que com sorte √© f√°cil de chegar), e a√≠ sim ver o resultado. Fazer isso uma vez ou outra at√© que n√£o parece o fim do mundo, mas somando pequenas itera√ß√µes como essa no final do dia √© muito tempo jogado fora.</p>

<p>Mas qual o pior problema? Altera√ß√£o de c√≥digo!
Esse tipo de altera√ß√£o √© altamente problem√°tica, √© muito f√°cil esquecer uma mudan√ßa no c√≥digo e acabar mandando pra production.
Inclusive o <code class="language-plaintext highlighter-rouge">NSLog</code> que a princ√≠pio √© inofensivo, pode gerar muita dor de cabe√ßa se for enviado para a app store. J√° vi alguns apps que logavam a minha senha no console durante a fase de login, e tudo ficava salvo em plain text no seu aparelho.</p>

<p><img src="/img/bunn/senha_console.png" alt="" /></p>

<h2 id="breakpoints">Breakpoints</h2>
<p>OK, alterar c√≥digo √© ruim, mas qual a alternativa para o ‚Äútestezinho‚Äù? <strong>Breakpoints!</strong>
Um breakpoint nada mais √© do que uma maneira de pausar a execu√ß√£o e te dar controle sobre a continua√ß√£o do fluxo do seu app.
Para adicionar um breakpoint basta clicar na linha que voc√™ quer que a execu√ß√£o pare.</p>

<p><img src="/img/bunn/breakpointSS.jpg" alt="" /></p>

<p>Por tr√°s dos panos o que est√° acontecendo nada mais √© do que uma chamada como essa:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>breakpoint set --file ViewController.m --line 15
</code></pre></div></div>

<p>Inclusive, se voc√™ decidir rodar esse comando no CLI do LLDB o breakpoint vai ser criado. A diferen√ßa √© que fazendo assim o breakpoint n√£o fica salvo entre diferentes sess√µes, ao contr√°rio do Xcode que salva seu breakpoint at√© que voc√™ decida remov√™-lo. Importante perceber que existe uma rela√ß√£o direta com o que voc√™ faz na UI do Xcode e os comandos dispon√≠veis do LLDB.</p>

<p>Xcode e LLDB s√£o dois projetos distintos, ou seja, tudo que voc√™ faz no Xcode existe uma ‚Äúalternativa‚Äù diretamente no CLI, por√©m, nem tudo que voc√™ consegue fazer no CLI est√° dispon√≠vel no Xcode. Vamos ver mais √† frente alguns exemplos quando eu comentar das ‚Äúextens√µes‚Äù do LLDB.</p>

<p>Assim que o seu breakpoint for adicionado e a execu√ß√£o do seu app passar por ele, o console do LLDB vai aparecer na parte inferior do Xcode.</p>

<p><img src="/img/bunn/xcode_lldb.png" alt="" /></p>

<p>Logo no header do console voc√™ pode ver alguns bot√µes que servem para controlar o fluxo da sua aplica√ß√£o, da esquerda para direita:</p>

<ul>
  <li><strong>Hide debug area</strong>: Serve para dar hide/show do CLI do LLDB;</li>
  <li><strong>Deactivate breakpoints</strong>: √â um bot√£o toggle que vai ligar/desligar todos os seus breakpoints sem remov√™-los;</li>
  <li><strong>Continue</strong>: Continua a execu√ß√£o normalmente do seu app;</li>
  <li><strong>Step Over</strong>: Executa a linha onde o programa est√° esperando e para na pr√≥xima instru√ß√£o;</li>
  <li><strong>Step Into</strong>: Entra na declara√ß√£o de um m√©todo;</li>
  <li><strong>Step Out</strong>: Sai da declara√ß√£o de um m√©todo e volta para quem o chamou.</li>
</ul>

<h2 id="comandos-lldb">Comandos LLDB</h2>

<p>Como escrevi anteriormente, os comandos do Xcode que interagem com o LLDB sempre possuem uma contraparte no CLI, os bot√µes de Continue, Step Over, Step Into e Step Out vistos acima tamb√©m podem ser executados diretamente no CLI atrav√©s dos respectivos comandos: <code class="language-plaintext highlighter-rouge">continue</code>, <code class="language-plaintext highlighter-rouge">step</code>, <code class="language-plaintext highlighter-rouge">stepi</code> e <code class="language-plaintext highlighter-rouge">finish</code>.</p>

<p>OK, o programa est√° parado l√° no seu breakpoint, voc√™ consegue ir passo a passo e investigar o que est√° acontecendo, mas seria legal ter maneiras de interagir com seus dados e fluxo de execu√ß√£o. Pra isso existem alguns comandos no LLDB pra te ajudar, aqui √© uma breve lista de alguns comandos que vamos ver com mais detalhes mais para frente:</p>

<ul>
  <li><strong>Expression</strong>: O expression vai basicamente rodar <em>(evaluate)</em> uma express√£o que voc√™ digitar. Essa express√£o pode ser, por exemplo, uma linha de c√≥digo exatamente como voc√™ digitaria no Xcode, inclusive √© permitido <strong>alterar</strong> valores em runtime. Expression √© t√£o importante que uma boa parte de comandos s√£o apenas um alias do expression com certos par√¢metros;</li>
  <li><strong>Print</strong>: O comando Print serve para printar uma vari√°vel, geralmente utilizado para printar tipos primitivos;</li>
  <li><strong>Print Object</strong>: Parecido com o print, mas geralmente √© utilizado para printar objetos. Ele vai retornar o objeto formatado de uma maneira mais f√°cil de entender pois o resultado vem do m√©todo <code class="language-plaintext highlighter-rouge">debugDescription</code>  e faz fallback para o <code class="language-plaintext highlighter-rouge">description</code>. Inclusive √© poss√≠vel customizar esses resultados fazendo override desses m√©todos;</li>
  <li><strong>Watchpoint</strong>: Esse aqui √© legal para acompanhar se um valor foi alterado. Digamos que voc√™ tem uma vari√°vel e quer ser avisado de toda vez que ela sofrer uma altera√ß√£o.</li>
</ul>

<p>Para ver mais comandos do LLDB basta digitar <code class="language-plaintext highlighter-rouge">help</code> no CLI. <a href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/gdb_to_lldb_transition_guide/document/lldb-command-examples.html" target="_blank">Este site</a> tamb√©m tem uma lista legal comparando os comandos do GDB com do LLDB.</p>

<p>Vale notar que o LLDB faz matching do prefixo dos comandos, ou seja, voc√™ pode digitar apenas <code class="language-plaintext highlighter-rouge">p</code> ao inv√©s de <code class="language-plaintext highlighter-rouge">print</code>, <code class="language-plaintext highlighter-rouge">e</code> ao inv√©s de <code class="language-plaintext highlighter-rouge">expression</code>, etc.</p>

<h2 id="printing">Printing</h2>

<p>Digamos que voc√™ quer saber o valor de uma vari√°vel, um <code class="language-plaintext highlighter-rouge">NSInteger</code> por exemplo. Ao inv√©s de escrever um <code class="language-plaintext highlighter-rouge">NSLog(@"Integer %li", counter);</code> voc√™ pode simplesmente adicionar um breakpoint no local de interesse, e quando o CLI do LLDB abrir apenas digite:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) p counter
(NSInteger) $0 = 1
</code></pre></div></div>

<p>Pronto, seu valor <code class="language-plaintext highlighter-rouge">1</code> foi retornado sem nenhuma altera√ß√£o no seu c√≥digo. Vamos tentar a mesma coisa para uma <code class="language-plaintext highlighter-rouge">UILabel</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) p countLabel
(UILabel *) $1 = 0x00007fefb650a7f0
</code></pre></div></div>

<p>Hmm, esse resultado n√£o parece muito √∫til se o nosso objetivo √© saber o valor dessa label. Isso acontece porque o <code class="language-plaintext highlighter-rouge">print</code> est√° retornando o ponteiro da nossa <code class="language-plaintext highlighter-rouge">UILabel</code>. Como a <code class="language-plaintext highlighter-rouge">UILabel</code> √© um objeto, para pegarmos um resultado mais interessante basta usarmos o <code class="language-plaintext highlighter-rouge">po</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) po self.countLabel
&lt;UILabel: 0x7fefb650a7f0; frame = (122 274; 76.5 20.5); text = 'Count = 1'; opaque = NO; autoresize = RM+BM; userInteractionEnabled = NO; layer = &lt;_UILabelLayer: 0x618000088f70&gt;&gt;
</code></pre></div></div>

<p>Muito melhor, mas o que aconteceria se usarmos o mesmo <code class="language-plaintext highlighter-rouge">po</code> no nosso <code class="language-plaintext highlighter-rouge">self</code> que nesse caso √© um <code class="language-plaintext highlighter-rouge">UIViewController</code> ?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) po self
&lt;SampleViewController: 0x7fba51e03db0&gt;
</code></pre></div></div>

<p>O que est√° acontecendo de errado? <code class="language-plaintext highlighter-rouge">SampleViewController</code> √© um objeto, estou usando um <code class="language-plaintext highlighter-rouge">po</code> que deveria dar mais informa√ß√µes √∫teis desse objeto, assim como aconteceu com o <code class="language-plaintext highlighter-rouge">UILabel</code>. 
O problema √© que o <code class="language-plaintext highlighter-rouge">po</code> vai retornar o resultado do m√©todo <code class="language-plaintext highlighter-rouge">debugDescription</code> fazendo fallback para o <code class="language-plaintext highlighter-rouge">description</code>. Nenhum desses m√©todos est√£o implementados no <code class="language-plaintext highlighter-rouge">SampleViewController</code>, ent√£o vamos mudar isso:</p>

<pre><code class="language-objective-c">- (NSString *)debugDescription {
    return [NSString stringWithFormat:@"Debug description from ViewController [%@], Current count [%li], Label Value [%@]", self, (long)_counter, self.countLabel.text];
}
</code></pre>

<p>E esse √© o novo resultado quando rodamos o <code class="language-plaintext highlighter-rouge">po</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) po self
Debug description from ViewController [SampleViewController], Current count [1], Label Value [Count = 1]
</code></pre></div></div>

<p>Recomendo fortemente sempre implementar o <code class="language-plaintext highlighter-rouge">debugDescription</code> pois isso facilita muito a vida de quem est√° manuseando seus objetos.</p>

<h2 id="watching">Watching</h2>

<p>Considere uma situa√ß√£o onde voc√™ tem uma vari√°vel qualquer que est√° sendo alterada e n√£o deveria, mas voc√™ n√£o sabe quem, quando ou onde ela est√° mudando. Uma solu√ß√£o seria ca√ßar todos os lugares do seu projeto, mas isso d√° muito trabalho. Outra possibilidade seria fazer um override do setter dessa vari√°vel (caso ele n√£o exista), mas isso altera c√≥digo, precisa compilar de novo, e todos aqueles problemas que j√° comentei anteriormente.</p>

<p>Para isso existe uma solu√ß√£o muito boa chamada <code class="language-plaintext highlighter-rouge">watchpoint</code> e para usar √© muito simples</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) watchpoint set variable _counter
Watchpoint created: Watchpoint 1: addr = 0x7fdf52c00d88 size = 8 state = enabled type = w
    watchpoint spec = '_counter'
    new value: 0
</code></pre></div></div>

<p>E a pr√≥xima vez que o seu <code class="language-plaintext highlighter-rouge">counter</code> for alterado, o Xcode vai parar no frame onde isso acontece, e no CLI voc√™ vai ver o resultado com o valor antigo e o valor novo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Watchpoint 1 hit:
old value: 0
new value: 1
</code></pre></div></div>

<p>Para listar todos os seus watchpoints use o comando <code class="language-plaintext highlighter-rouge">list</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) watchpoint list
Number of supported hardware watchpoints: 4
Current watchpoints:
Watchpoint 1: addr = 0x7fdf52c00d88 size = 8 state = enabled type = w
    watchpoint spec = '_counter'
    old value: 0
    new value: 1
</code></pre></div></div>

<p>E assim que n√£o precisar dele, apenas delete o watchpoint desejado com <code class="language-plaintext highlighter-rouge">delete</code>
Nesse caso o nosso watchpoint tem o n√∫mero 1, ent√£o para deletar ele:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) watchpoint delete 1
1 watchpoints deleted.
</code></pre></div></div>

<h2 id="interacting">Interacting</h2>

<p>J√° vimos como inspecionar suas vari√°veis e fluxo da aplica√ß√£o, mas e situa√ß√µes onde voc√™ quer interagir com a execu√ß√£o, mudar vari√°veis, criar outras, como fazer isso tudo sem ter que mudar seu c√≥digo, compilar e tudo mais?</p>

<p>Usando o <code class="language-plaintext highlighter-rouge">expression</code> voc√™ pode fazer tudo isso, vamos ver alguns exemplos pr√°ticos de como ele pode ser utilizado.</p>

<p>Imagine uma situa√ß√£o onde voc√™ tenha um counter e queira testar um caso onde esse counter seja <code class="language-plaintext highlighter-rouge">100</code> por√©m ele √© incrementado apenas de 1 em 1 ao apertar um bot√£o.</p>

<p>Voc√™ poderia ir diretamente no c√≥digo e alterar o valor para 100, mas novamente, isso altera c√≥digo, adiciona bugs, precisa ser recompilado. N√£o √© uma solu√ß√£o v√°lida.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) p counter
(NSInteger) $0 = 1
(lldb) e counter = 100
(NSInteger) $1 = 100
(lldb) p counter
(NSInteger) $2 = 100
</code></pre></div></div>

<p>Usando o <code class="language-plaintext highlighter-rouge">expression</code> ou <code class="language-plaintext highlighter-rouge">e</code>  foi poss√≠vel mudar o valor que antes era 1 para 100, isso tudo sem precisar alterar uma √∫nica linha de c√≥digo.</p>

<p>Outra situa√ß√£o bem comum, voc√™ tem uma tela com um background meio feio, quer fazer alguns testes mas sempre precisa fazer uma altera√ß√£o no c√≥digo como essa:</p>

<pre><code class="language-objective-c">self.view.backgroundColor = [UIColor purpleColor];
</code></pre>

<p>Por√©m, se voc√™ lembrar que o LLDB √© seu amigo (roll credits) voc√™ pode pegar exatamente o mesmo trecho de c√≥digo e rodar no <code class="language-plaintext highlighter-rouge">expression</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) e self.view.backgroundColor = [UIColor purpleColor];
(UICachedDeviceRGBColor *) $3 = 0x00006080000735c0
</code></pre></div></div>

<p>Pronto! O background color da sua <code class="language-plaintext highlighter-rouge">UIView</code> foi alterado durante a execu√ß√£o do seu projeto, assim fica bem f√°cil te testar v√°rias cores diferentes sem ter que compilar o c√≥digo a cada tentativa.</p>

<p>Voc√™ pode ter notado que o background s√≥ mudou a cor depois de voc√™ continuar a execu√ß√£o do seu projeto, pois antes ele estava preso no frame do seu breakpoint. Uma maneira de for√ßar a altera√ß√£o da view sem precisar dar <code class="language-plaintext highlighter-rouge">continue</code> no LLDB √© rodar o seguinte comando</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>e [CATransaction flush]
</code></pre></div></div>

<p>Outra coisa bem legal de fazer com o expression √© a cria√ß√£o de novas vari√°veis ou at√© mesmo hierarquias de views:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) e [[UIView alloc] initWithFrame:CGRectMake(10, 10, 100, 100)]
(UIView *) $6 = 0x00007fd968409620
</code></pre></div></div>

<p>Assim voc√™ tem uma nova <code class="language-plaintext highlighter-rouge">UIView</code> criada diretamente no CLI do LLDB. E se voc√™ tem prestado aten√ß√£o, toda vez que uma <code class="language-plaintext highlighter-rouge">expression</code> com retorno √© executada, na linha logo abaixo sempre vemos um <code class="language-plaintext highlighter-rouge">${n√∫mero}</code> como <code class="language-plaintext highlighter-rouge">$6</code> nesse c√≥digo acima. Isso s√£o vari√°veis que o LLDB est√° criando para voc√™, ent√£o podemos continuar a cria√ß√£o da nossa <code class="language-plaintext highlighter-rouge">UIView</code> a partir disso.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) e $6.backgroundColor = [UIColor redColor];
(UICachedDeviceRGBColor *) $7 = 0x000061800007a180
(lldb) e [self.view addSubview:$6];
(lldb) e [CATransaction flush]
</code></pre></div></div>
<p>Com isso voc√™ j√° pode ver um quadrado vermelho no seu simulador sem nem ao menos ter que sair do modo de debugger.</p>

<p>Acho que agora d√° para ter uma ideia legal de como o LLDB pode ser √∫til para diversas tarefas no seu dia-a-dia, as possibilidades s√£o grandes e estamos apenas na ‚Äúponta do iceberg‚Äù, para ilustrar outra situa√ß√£o bem comum e diferente do que j√° vimos, √© como simular um memory warning no seu device.</p>

<p>No simulador n√≥s podemos apenas ir no <code class="language-plaintext highlighter-rouge">Simulate Memory Warning</code>. Mas e no device?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) e [[UIApplication sharedApplication] performSelector:@selector(_performMemoryWarning)]
</code></pre></div></div>
<p>Chamando essa linha no LLDB seu app vai se comportar exatamente como se voc√™ desse um click no <code class="language-plaintext highlighter-rouge">Simulate Memory Warning</code> no seu simulador. Ent√£o fica not√°vel a versatilidade do LLDB em diversas situa√ß√µes diferentes.</p>

<h2 id="breakpoint-actions">Breakpoint Actions</h2>

<p>Agora sabemos como criar os comandos para pegar mais informa√ß√µes do seu app ou at√© mesmo alterar comportamento sem mudar uma linha do seu c√≥digo, mas seria bom se tivesse uma maneira de salvar essas fun√ß√µes para n√£o ter que escrever o tempo todo. Por exemplo, voc√™ sempre quer saber o valor de uma vari√°vel X, fica muito ruim ficar fazendo um <code class="language-plaintext highlighter-rouge">p</code> ou <code class="language-plaintext highlighter-rouge">po</code> o tempo todo. Pra resolver isso n√≥s temos o breakpoint actions.</p>

<p>Pare acessar o breakpoint action voc√™ d√° um duplo click no seu breakpoint ou acessa pelo atalho Command + Alt + click.</p>

<p><img src="/img/bunn/breakpoint_action.png" alt="" /></p>

<p>Aqui voc√™ consegue definir alguns par√¢metros para seu breakpoint, como:</p>

<ul>
  <li><strong>Condition</strong>: Caso voc√™ queira fazer uma condi√ß√£o especial para seu breakpoint ser executado, por exemplo, durante um parser, voc√™ quer parar quando uma vari√°vel X for igual a Y. O c√≥digo que voc√™ usa aqui √© praticamente o mesmo que voc√™ escreveria no programa;</li>
  <li><strong>Ignore</strong>: Caso voc√™ queira ignorar o seu breakpoint num n√∫mero X de vezes, por exemplo num loop;</li>
  <li><strong>Action</strong>: Aqui voc√™ seleciona qual a√ß√£o seu breakpoint vai executar, vamos ver com detalhes mais pra frente;</li>
  <li><strong>Options</strong>: Basicamente uma op√ß√£o para continuar, caso voc√™ n√£o queira que o programa pare nesse breakpoint, √∫til para logs, por exemplo. (N√£o sei porque est√° no plural se √© apenas um checkbox).</li>
</ul>

<h2 id="actions">Actions</h2>

<p>No painel de Breakpoint quando voc√™ clickar no <code class="language-plaintext highlighter-rouge">actions</code> uma lista com v√°rias op√ß√µes vai aparecer, essas s√£o as op√ß√µes de que a√ß√µes voc√™ quer que rode assim que seu breakpoint for executado.</p>

<p><img src="/img/bunn/breakpoint_action_list.png" alt="" /></p>

<ul>
  <li><strong>Apple Script</strong>: Executar um Apple Script toda vez que o breakpoint √© ativado. Uma utilidade seria ter um script que mande um e-mail ou uma slack message enquanto roda num CI;</li>
  <li><strong>Capture GPU Frame</strong>: Mais utilizado caso voc√™ esteja fazendo algo com OpenGL;</li>
  <li><strong>Debugger Command</strong>: Todos os comandos que vimos anteriormente podem ser rodados aqui, ent√£o √© uma das actions mais utilizadas no meu dia-a-dia;</li>
  <li><strong>Log Message</strong>: Gosto bastante desse tamb√©m porque ele prov√™ uma maneira simples de adicionar logs no seu console, assim n√£o precisa mais dos prints;</li>
  <li><strong>Shell Command</strong>: Parecido com o Apple Script, mas nesse √© focado em shell mesmo;</li>
  <li><strong>Sound</strong>: Pode ser √∫til caso voc√™ tenha alguma situa√ß√£o com muita coisa acontecendo e quer ser notificado, nada mais √© do que mais uma forma de voc√™ receber uma ‚Äúnotifica√ß√£o‚Äù do Xcode.</li>
</ul>

<p>E voc√™ pode encadear v√°rios no mesmo breakpoint, por exemplo rodar um log message e um som ao mesmo tempo depois que um debugger command for executado.</p>

<h2 id="auto-login">Auto Login</h2>

<p>Vamos pegar o breakpoint actions para resolver um problema que todos n√≥s j√° tivemos que fazer uma vez ou outra: Login no seu app. Toda vez que voc√™ roda um app que precisa de login voc√™ tem que perder momentos preciosos da sua vida para</p>

<ul>
  <li>Digitar o usu√°rio;</li>
  <li>Digitar a senha;</li>
  <li>Apertar o bot√£o de login.</li>
</ul>

<p>Pode parecer pouco, mas fazer isso, toda vez que voc√™ roda o app, sendo que voc√™ roda o app in√∫meras vezes em apenas um dia, rapidamente d√° pra ver que √© um fluxo que consome bastante tempo. Como resolvemos isso?</p>

<pre><code class="language-objective-c">self.loginTextField.text = @"email@email.com";
self.passwordTextField.text = @"senhaSuperSegura";
</code></pre>
<p>N√£o! Nee! Niet! Nein! Imagina se um c√≥digo desse vai pra production? Imagina se todos seus usu√°rios do dia pra noite tem um usu√°rio hardcoded porque voc√™ esqueceu de remover esse c√≥digo antes de mandar para a app store.</p>

<p>Para resolver esse problema, podemos criar um breakpoint (no lugar de sua prefer√™ncia, mas aqui eu decidi usar o <code class="language-plaintext highlighter-rouge">viewDidAppear</code>) com duas actions de <strong>debugger command</strong> e selecionar a op√ß√£o de automatically continue:</p>

<p>Assim que voc√™ rodar o app √© poss√≠vel ver no console suas duas expressions rodando</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(__NSCFString *) $0 = 0x0000610000055420 @"email@email.com"
(__NSCFString *) $1 = 0x000060000005b450 @"senhaSuperSegura"
</code></pre></div></div>

<p>Resolvido, n√£o temos mais o problema de enviar uma senha hardcoded para production e tamb√©m n√£o precisamos mais perder momentos preciosos de nossa vida escrevendo a mesma coisa v√°rias vezes ao dia. Mas e esse bot√£o de login? Vamos automatizar isso tamb√©m, afinal, ningu√©m tem tempo para ficar clickando no mesmo bot√£o o tempo todo.</p>

<p><img src="/img/bunn/breakpoint_automatic_login.png" alt="" /></p>

<p>Nada mais fiz do que adicionar mais um <strong>debugger command</strong> chamando manualmente o m√©todo de login, e tamb√©m adicionei um <strong>Log Message</strong> para deixar claro o que est√° acontecendo.</p>

<p>Pr√≥xima vez que seu breakpoint for chamado seu campo de login e password v√£o ser automaticamente preenchidos e al√©m disso, o login vai ser chamado sem voc√™ precisar fazer mais nada, e esse √© o output do console:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(__NSCFString *) $0 = 0x000060800005c500 @"email@email.com"
(__NSCFString *) $1 = 0x000060000005b450 @"senhaSuperSegura"
Automatic Login Enabled
</code></pre></div></div>

<p>E caso voc√™ n√£o queira mais essas a√ß√µes, voc√™ pode ou deletar seu breakpoint ou apenas desativ√°-lo momentaneamente.</p>

<h2 id="sharing">Sharing</h2>
<p>Outra coisa legal que √© poss√≠vel fazer com breakpoints √© compartilhar ele no seu projeto. Um motivo interessante para fazer share de um breakpoint √© quando voc√™ for criar um novo bug no <a href="https://developer.apple.com/bug-reporting/" target="_blank">Bug Reporter</a> da Apple.
Com isso voc√™ cria o projeto demo e j√° adiciona os breakpoints com log messages ou at√© chamando os m√©todos que tem que ser chamados para causar o bug.</p>

<p>Outra situa√ß√£o √© simplesmente ter logs padr√µes ou breakpoints para facilitar a vida do desenvolvedor diretamente no seu reposit√≥rio. Mas cuidado, ao fazer isso as informa√ß√µes do breakpoint v√£o ficar salvas em plain text dentro do seu <code class="language-plaintext highlighter-rouge">xcshareddata</code>. Ou seja, voc√™ n√£o quer adicionar nenhuma informa√ß√£o sens√≠vel num shared breakpoint.</p>

<p>Para fazer share do seu breakpoint basta ir no breakpoint navigator (‚åò + 7), clicar com o bot√£o direito no seu breakpoint e selecionar ‚ÄúShare‚Äù.</p>

<p><img src="/img/bunn/breakpoint_share.png" alt="" /></p>

<h2 id="lldb-plugins">LLDB plugins</h2>

<p>√â poss√≠vel escrever plugins para o <a href="https://lldb.llvm.org/python-reference.html" target="_blank">LLDB em Python</a> com isso voc√™ pode escrever seus pr√≥prios comandos, o que √© muito pr√°tico pois permite a cria√ß√µes de plugins excelentes como o <a href="https://github.com/facebook/chisel" target="_blank">Chisel</a>.</p>

<p>O Chisel nada mais √© do que uma cole√ß√£o de novos comandos para voc√™ usar no seu LLDB. Ap√≥s instalar o Chisel, ao escrever <code class="language-plaintext highlighter-rouge">help</code> no CLI do LLDB, voc√™ vai ver uma s√©rie de novos comandos dentro da section <code class="language-plaintext highlighter-rouge">Current user-defined commands</code>.</p>

<p>Recomendo fortemente dar uma conferida em todos os comandos do Chisel, mas vou listar apenas alguns que uso diariamente.</p>

<h3 id="mask">mask</h3>
<p>Quantas vezes j√° alteramos o c√≥digo com alguma coisa do tipo:</p>

<pre><code class="language-objective-c">self.loginTextField.backgroundColor = [UIColor redColor];
</code></pre>
<p>apenas para ver certinho os bounds que essa view est√° usando?
Com o <strong>mask</strong> voc√™ pode apenas fazer:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) mask self.loginTextField
</code></pre></div></div>
<p><img src="/img/bunn/chisel_mask.png" alt="" /></p>

<p>E para remover:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) unmask self.loginTextField
</code></pre></div></div>

<h3 id="mwarning">mwarning</h3>
<p>Lembra quando eu usei o seguinte comando para simular um memory warning?</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) e [[UIApplication sharedApplication] performSelector:@selector(_performMemoryWarning)]
</code></pre></div></div>

<p>Ent√£o, com o Chisel tudo que precisa ser feito √©:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) mwarning
</code></pre></div></div>

<h3 id="pvc">pvc</h3>
<p>Faz o print recursivo de um <code class="language-plaintext highlighter-rouge">UIVIewController</code>, por exemplo esse UINavigationController:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(lldb) pvc self.navigationController
&lt;UINavigationController: 0x7ffd6801e200; view = &lt;UILayoutContainerView; 0x7ffd67e04290&gt;; frame = (0, 0; 320, 568)&gt;
   | &lt;LoginViewController: 0x7ffd67f08160; view = &lt;UIView; 0x7ffd67e102c0&gt;; frame = (0, 64; 320, 504)&gt;
   | &lt;SecondViewController: 0x7ffd69d01600; view = &lt;UIView; 0x7ffd69e00d80&gt;; frame = (0, 0; 320, 568)&gt;
</code></pre></div></div>

<h2 id="conclus√£o">Conclus√£o</h2>

<p>√â not√°vel a diferen√ßa que uma boa aplica√ß√£o do LLDB faz no nosso fluxo de trabalho. Sem contar que nos d√° uma seguran√ßa muito melhor pois sabemos que nenhum log errado, nenhum c√≥digo de ‚Äútestezinho‚Äù vai ser enviado para nossos clientes. Isso sem contar nos in√∫meros ‚Äúbuild &amp; runs‚Äù que se tornam completamente desnecess√°rios e que certamente nos salvam incont√°veis horas no decorrer de pouco tempo.</p>

<p>Sempre que voc√™ pensar em alterar um c√≥digo para fazer ‚Äúum testezinho‚Äù, sempre que voc√™ for apertar aquele bot√£o de run do Xcode para compilar e rodar seu projeto, lembre-se do LLDB, talvez ele consiga resolver esse problema para voc√™, afinal, o LLDB √© seu amigo üòä</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/testes/2017/03/06/unit-tests-101/" data-toggle="tooltip" data-placement="top" title="Unit Tests 101">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/testes/2017/03/09/voce-tem-um-momento-para-falar-sobre-testar-suas-view-controllers/" data-toggle="tooltip" data-placement="top" title="Voc√™ tem um momento para falar sobre testar suas View Controllers?">Pr√≥ximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto ‚Äî Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
