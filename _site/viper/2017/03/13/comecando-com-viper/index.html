<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento — artigos, tutoriais e opinião.">

    <title>Começando com VIPER - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/viper/2017/03/13/comecando-com-viper/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Começando com VIPER</h1>
                        
                        <h2 class="subheading">Entendendo e aplicando sem muito sofrimento</h2>
                        
                        <span class="meta">Postado por Vitor Santos Mesquita em 13/03/2017</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Começando com VIPER&url=http://localhost:4000/viper/2017/03/13/comecando-com-viper/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/viper/2017/03/13/comecando-com-viper/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/viper/2017/03/13/comecando-com-viper/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/viper/2017/03/13/comecando-com-viper/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<p>Antes de começarmos gostaria de dizer que sou um entusiasta sobre VIPER e o post é contando um pouco sobre o que sei e entendo e a minha experiência sobre o assunto.</p>

<hr />

<h1 id="intro">Intro</h1>

<p>VIPER já é uma arquitetura bastante conhecida e utilizada pela comunidade iOS.
E para quem está começando a pesquisar alguma arquitetura além do famoso MVC pode se surpreender com ela.</p>

<p>Eu comecei a pesquisar sobre VIPER pois tinha algumas grandes dificuldades sobre a arquitetura MVC como: </p>

<ul>
  <li>Desacoplamento de código </li>
  <li>Classes muito extensas </li>
  <li>Classes muito complexas </li>
  <li>Dificuldade na hora de dar manutenção no código</li>
  <li>Dificuldade em testar</li>
</ul>

<p>Se você tem algumas desses dificuldades, seja com seu código ou não, VIPER pode te ajudar a soluciona-las.
Mas lembrando que ela não irá operar milagres no seu código, na meu caso me ajudou a pensar mais, arquitetar mais, desacoplar mais e assim aumentar meu nível de código.</p>

<hr />

<p>VIPER é baseada na arquitetura Clean disseminada pelo famoso “tio” Bob (Uncle Bob), que por sua vez é baseada na arquitetura de cebola (Onion architecture) com junção de mais outras 3, onde separa sua aplicação em camadas distintas que são: </p>

<h2 id="camada-de-apresentação-presentation">Camada de apresentação (presentation)</h2>

<p>É a camada mais superficial dá sua aplicação. Onde o usuário irá interagir, no caso do iOS seria nossas Views, ViewController, TabBarViewContoller …</p>

<p>É a camada responsável por dar “cara” na nossa aplicação, montar tela, mudar cor, mostrar ou esconder elementos entre outras várias coisas relacionadas.</p>

<h2 id="camada-de-domíniodomain">Camada de domínio (domain)</h2>

<p>É a camada do coração dá sua aplicação, pois ela é responsável por conter todas as regras de negócios e casos de uso dá sua aplicação.</p>

<h2 id="camada-de-dadosdata">Camada de dados (data)</h2>

<p>É a camada responsável por conversar com o externo dá sua aplicação. Seja API ou Banco de dados, ela que irá manusear toda essa interação com o externo.</p>

<p><img src="/img/vitormesquita/clean.png" /></p>

<hr />

<h1 id="entendido-clean-vamos-entender-o-viper">Entendido Clean vamos entender o VIPER.</h1>

<p>Cada letra do nome representa um tipo de objeto/classe que iremos ter são:</p>

<ul>
  <li>View</li>
  <li>Interactor</li>
  <li>Presenter</li>
  <li>Entity</li>
  <li>Router</li>
</ul>

<h3 id="formando-viper">Formando V.I.P.E.R!!</h3>

<p><img src="/img/vitormesquita/Viper-Module.png" /></p>

<h2 id="view">View</h2>
<p>Representa tudo onde o usuário irá interagir.<br />
Sua responsabilidade é mostrar o que o <b>Presenter</b> manda ela mostrar, e lidar com interações do usuario com a tela passando-as para o Presenter.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="cm">/*Protocolo que define as interações Presenter -&gt; View */</span>
<span class="kd">protocol</span> <span class="kt">ViewProtocol</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">setVisibilityActivityIndicator</span><span class="p">(</span><span class="nv">isVisible</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">presenterProtocol</span><span class="p">:</span> <span class="kt">PresenterProtocol</span><span class="o">!</span>
    
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">activityIndicator</span><span class="p">:</span> <span class="kt">UIActivityIndicatorView</span><span class="o">!</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">tableView</span><span class="p">:</span> <span class="kt">UITableView</span><span class="o">!</span>
    
    <span class="k">let</span> <span class="nv">dispose</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="n">presenterProtocol</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="nf">bind</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">bind</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">presenterProtocol</span><span class="o">.</span><span class="n">repositoriesChanged</span><span class="o">.</span><span class="n">bindNext</span> <span class="p">{[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">strongSelf</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
            <span class="n">strongSelf</span><span class="o">.</span><span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">dispose</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">ViewProtocol</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">setVisibilityActivityIndicator</span><span class="p">(</span><span class="nv">isVisible</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">activityIndicator</span><span class="o">.</span><span class="n">isHidden</span> <span class="o">=</span> <span class="o">!</span><span class="n">isVisible</span>
        <span class="k">if</span> <span class="n">isVisible</span> <span class="p">{</span>
            <span class="n">activityIndicator</span><span class="o">.</span><span class="nf">startAnimating</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">activityIndicator</span><span class="o">.</span><span class="nf">stopAnimating</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="presenter">Presenter</h2>
<p>Representa toda a lógica dá view.<br />
Ele recebe eventos da View e reage a eles.<br />
Ele recebe dados do <b>Interactor</b>, aplica a lógica da View e manda mostrar o que for preciso.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RxSwift</span>
<span class="kd">import</span> <span class="kt">RxCocoa</span>

<span class="cm">/* Protocolo que define as interações View -&gt; Presenter */</span>
<span class="kd">protocol</span> <span class="kt">PresenterProtocol</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">numberOfRows</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    <span class="k">var</span> <span class="nv">repositoriesChanged</span><span class="p">:</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span><span class="k">get</span><span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span>
    <span class="kd">func</span> <span class="nf">getItem</span><span class="p">(</span><span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Repository</span><span class="p">?</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">Presenter</span> <span class="p">{</span>
    
    <span class="k">weak</span> <span class="k">var</span> <span class="nv">viewProtocol</span><span class="p">:</span> <span class="kt">ViewProtocol</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">interactorProtocol</span><span class="p">:</span> <span class="kt">RepositoryInput</span><span class="o">!</span>
    
    <span class="k">var</span> <span class="nv">repositories</span> <span class="o">=</span> <span class="kt">Variable</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repository</span><span class="p">]</span><span class="o">&gt;</span><span class="p">([])</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Presenter</span><span class="p">:</span> <span class="kt">PresenterProtocol</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">numberOfRows</span><span class="p">:</span> <span class="kt">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">self</span><span class="o">.</span><span class="n">repositories</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>
    
    <span class="k">var</span> <span class="nv">repositoriesChanged</span><span class="p">:</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">repositories</span><span class="o">.</span><span class="nf">asObservable</span><span class="p">()</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="k">in</span>
            
        <span class="p">})</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
		<span class="n">viewProtocol</span><span class="p">?</span><span class="o">.</span><span class="nf">setVisibilityActivityIndicator</span><span class="p">(</span><span class="nv">isVisible</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
		<span class="n">interactorProtocol</span><span class="o">.</span><span class="nf">searchRepositories</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="s">"alguma lib"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">getItem</span><span class="p">(</span><span class="nv">indexPath</span><span class="p">:</span> <span class="kt">IndexPath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Repository</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">repositories</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">indexPath</span><span class="o">.</span><span class="n">row</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Protocolo de output do interactor */</span>
<span class="kd">extension</span> <span class="kt">Presenter</span><span class="p">:</span> <span class="kt">RepositoryOutput</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">foundRepositories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="p">[</span><span class="kt">Repository</span><span class="p">]?)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">repositories</span> <span class="o">=</span> <span class="n">repositories</span> <span class="k">else</span> <span class="p">{</span><span class="k">return</span><span class="p">}</span>
        <span class="n">viewProtocol</span><span class="p">?</span><span class="o">.</span><span class="nf">setVisibilityActivityIndicator</span><span class="p">(</span><span class="nv">isVisible</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">repositories</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">repositories</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="interactor">Interactor</h2>
<p>Representa um caso de uso.<br />
Ele que é responsável por aplicar a lógica de determinado caso.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RxSwift</span>

<span class="cm">/* Protocolo que define as interações Presenter -&gt; Interactor */</span>
<span class="kd">protocol</span> <span class="kt">RepositoryInput</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">searchRepositories</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>

<span class="cm">/* Protocolo que define as interações Interactor -&gt; Presenter */</span>
<span class="kd">protocol</span> <span class="kt">RepositoryOutput</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">foundRepositories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:[</span><span class="kt">Repository</span><span class="p">]?)</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="kt">RepositoryInteractor</span> <span class="p">{</span>

    <span class="k">weak</span> <span class="k">var</span> <span class="nv">output</span><span class="p">:</span> <span class="kt">RepositoryOutput</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">dispose</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">RepositoryInteractor</span><span class="p">:</span> <span class="kt">RepositoryInput</span> <span class="p">{</span>
    
    <span class="kd">func</span> <span class="nf">searchRepositories</span><span class="p">(</span><span class="nv">query</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">APIClient</span>
            <span class="o">.</span><span class="nf">getRepositories</span><span class="p">(</span><span class="nv">byName</span><span class="p">:</span> <span class="n">query</span><span class="p">)</span>
            <span class="o">.</span><span class="n">bindNext</span> <span class="p">{[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="p">(</span><span class="n">repositories</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">strongSelf</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="n">strongSelf</span><span class="o">.</span><span class="n">output</span><span class="p">?</span><span class="o">.</span><span class="nf">foundRepositories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="n">repositories</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">addDisposableTo</span><span class="p">(</span><span class="n">dispose</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="entity">Entity</h2>
<p>Representa a entidade da API e/ou do Banco</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">ObjectMapper</span>

<span class="cm">/* Repositorio pego da API do Github */</span>
<span class="kd">class</span> <span class="kt">Repository</span><span class="p">:</span> <span class="kt">Mappable</span> <span class="p">{</span>
    
    <span class="k">var</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">htmlURLString</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">description</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">starsCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">language</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span>
    <span class="k">var</span> <span class="nv">forksCount</span><span class="p">:</span> <span class="kt">Int</span><span class="p">?</span>
    
    <span class="kd">required</span> <span class="nf">init</span><span class="p">?(</span><span class="nv">map</span><span class="p">:</span> <span class="kt">Map</span><span class="p">)</span> <span class="p">{}</span>
    
    <span class="kd">func</span> <span class="nf">mapping</span><span class="p">(</span><span class="nv">map</span><span class="p">:</span> <span class="kt">Map</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">id</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span>
        <span class="n">name</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span>
        <span class="n">htmlURLString</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"html_url"</span><span class="p">]</span>
        <span class="n">description</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"description"</span><span class="p">]</span>
        <span class="n">starsCount</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"stargazers_count"</span><span class="p">]</span>
        <span class="n">language</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"language"</span><span class="p">]</span>
        <span class="n">forksCount</span> <span class="o">&lt;-</span> <span class="n">map</span><span class="p">[</span><span class="s">"forks_count"</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="router">Router</h2>
<p>Representa toda a lógica de navegação da sua aplicação.<br />
Ele que sabe para qual tela tem que ir e para qual tem que voltar.<br />
<b>É um objeto composto por 2 (Presenter e WireFrame).</b></p>

<h4 id="wireframe">Wireframe</h4>
<p>É encarregado de instanciar todas as dependências necessárias.<br />
E ele que também é encarregado de chamar outro WireFrame para assim instanciar sua tala/feature.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">UIKit</span>

<span class="cm">/**/</span>
<span class="kd">class</span> <span class="kt">WireFrame</span><span class="p">:</span> <span class="kt">NSObject</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">viewController</span> <span class="o">=</span> <span class="kt">ViewController</span><span class="p">(</span><span class="nv">nibName</span><span class="p">:</span><span class="s">"ViewController"</span><span class="p">,</span> <span class="nv">bundle</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="k">let</span> <span class="nv">presenter</span> <span class="o">=</span> <span class="kt">Presenter</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">interactor</span> <span class="o">=</span> <span class="kt">RepositoryInteractor</span><span class="p">()</span>

    <span class="k">override</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="n">viewController</span><span class="o">.</span><span class="n">presenterProtocol</span> <span class="o">=</span> <span class="n">presenter</span>
        <span class="n">presenter</span><span class="o">.</span><span class="n">viewProtocol</span> <span class="o">=</span> <span class="n">viewController</span>
        <span class="n">presenter</span><span class="o">.</span><span class="n">interactorProtocol</span> <span class="o">=</span> <span class="n">interactor</span>
        <span class="n">interactor</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">presenter</span>
    <span class="p">}</span>
    
    <span class="kd">func</span> <span class="nf">present</span><span class="p">(</span><span class="nv">window</span><span class="p">:</span> <span class="kt">UIWindow</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">window</span><span class="o">.</span><span class="n">rootViewController</span> <span class="o">=</span> <span class="n">viewController</span>
    <span class="p">}</span>
	
	<span class="kd">func</span> <span class="nf">showRepositoryDetails</span><span class="p">(</span><span class="nv">repository</span><span class="p">:</span> <span class="kt">Repository</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">let</span> <span class="nv">wireFrameDetails</span> <span class="o">=</span> <span class="kt">RepoDetailsWireFrame</span><span class="p">(</span><span class="nv">repository</span><span class="p">:</span> <span class="n">repository</span><span class="p">)</span>
		<span class="n">wireFrameDetails</span><span class="o">.</span><span class="nf">present</span><span class="p">(</span><span class="nv">withVC</span><span class="p">:</span> <span class="n">viewController</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="presenter-1">Presenter</h4>
<p>Nesse caso é encarregado de falar para o WireFrame fazer algum tipo de navegação, seja para outra tela, como desistanciar a tela corrente.</p>

<hr />

<h1 id="dicas">Dicas</h1>

<p>Quando comecei a implementar essa arquitetura tive alguns problemas que deixaram o desenvolvimento um pouco mais complicado, mas com essas dicas pode ficar bem mais simples desenvolver.</p>

<p>Como sabemos no desenvolvimento iOS sempre temos que cuidar a memoria que nossa aplicação consome (famoso Memory Leak). E com o VIPER por ter muitas dependências e dependências ciclicas, tive muito problema em desalocar meu ViewController e suas dependências.</p>

<h3 id="com-a-weak-var-esse-problema-pode-ser-facilmente-resolvido">Com a <code class="language-plaintext highlighter-rouge">weak var</code> esse problema pode ser facilmente resolvido.</h3>

<p>Colocando ponteiros fracos nas dependências ciclicas como segue o diagrama:</p>

<p><img src="/img/vitormesquita/weak-diagram.png" /></p>

<p>Um simples ponteiro fraco causa desalocamento em cadeia e assim não tendo que se preocupar em ficar desalocando dependencia por dependencia na mão.</p>

<p>Mas para criar ponteiros fracos de <code class="language-plaintext highlighter-rouge">protocol</code> é necessário falar para o protocolo que somente classes podem implementa-las.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protocol</span> <span class="kt">ViewProtocol</span><span class="p">:</span> <span class="kd">class</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div></div>
<p>–</p>

<p>Para quem está começando com VIPER pode ser meio confuso abstrair o que cada parte deve fazer e/ou implementar. Para isso comecei a separar as camadas do clean em pacotes, como:</p>

<p><img src="/img/vitormesquita/folders.png" /></p>

<h3 id="presentation">Presentation</h3>

<p>Nesse pacote deverá conter as dependências <code class="language-plaintext highlighter-rouge">view</code>, <code class="language-plaintext highlighter-rouge">presenter</code> e <code class="language-plaintext highlighter-rouge">router (wireFrame)</code> separados por <code class="language-plaintext highlighter-rouge">features</code>.</p>

<p><img src="/img/vitormesquita/presentation.png" /></p>

<h3 id="domain">Domain</h3>

<p>Nesse pacote deverá conter o <code class="language-plaintext highlighter-rouge">interactor</code>.</p>

<p><img src="/img/vitormesquita/domain.png" /></p>

<h3 id="data">Data</h3>

<p>Nesse pacote deverá conter as <code class="language-plaintext highlighter-rouge">entities</code> e todos as implementações de <code class="language-plaintext highlighter-rouge">APIClient</code> ou <code class="language-plaintext highlighter-rouge">DataBase</code></p>

<p><img src="/img/vitormesquita/data.png" /></p>

<h2 id="obs-projeto-exemplo-que-está-no-meu-github"><b>OBS: projeto exemplo que está no meu github</b></h2>

<h2 id="e-agora">E agora?</h2>

<p>Muitas pessoas falam que é muito <code class="language-plaintext highlighter-rouge">overhead</code> fazer um software em VIPER, e de fato digo é mesmo, se sua aplicação é pequena.</p>

<p>Mas antes de julgar ou adotar o VIPER, analise bem seu projeto, verique se ele é um projeto que será escalavél e com varias funcionalidades. Se for o VIPER poderá ser uma arma muito útil que irá facilitar sua vida. Se não, viper poderá atrapalhar sua vida e pode acabar em um <code class="language-plaintext highlighter-rouge">spaghetti code</code> o seu projeto.</p>

<h3 id="viper-exige-um-empenho-muito-grande-de-quem-está-programando-para-se-entender-e-se-aplicar-de-forma-correta">VIPER exige um empenho muito grande de quem está programando para se entender e se aplicar de forma correta.</h3>

<p>Abaixo deixarem uns links para ajudar você que está começando em VIPER a se orientar e praticar.</p>

<ul>
  <li><a href="https://www.objc.io/issues/13-architecture/viper/">https://www.objc.io/issues/13-architecture/viper/</a></li>
  <li><a href="https://www.ckl.io/blog/ios-project-architecture-using-viper/">https://www.ckl.io/blog/ios-project-architecture-using-viper/</a></li>
  <li><a href="https://github.com/vitormesquita/Cocoaheds">https://github.com/vitormesquita/Cocoaheds</a></li>
</ul>

<p>E sempre que precisar de alguma ajuda sobre o assunto pode me contactar no iOSDevBR <b>@vitormes</b>.</p>

<p>Obrigado e espero que gostem!</p>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/swift/2017/03/12/Introducao-e-casos-de-uso-Map-Filter-e-Reduce/" data-toggle="tooltip" data-placement="top" title="Introdução e casos de uso: Map, Filter e Reduce.">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/metaprogramming/2017/03/14/metaprogramacao-para-o-resto-de-nos/" data-toggle="tooltip" data-placement="top" title="Metaprogramação para o resto de nós">Próximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto — Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
