<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Blog de tecnologia e desenvolvimento — artigos, tutoriais e opinião.">

    <title>Criando frameworks para várias plataformas - A odisseia do puto</title>

    <link rel="canonical" href="http://localhost:4000/frameworks/2016/03/25/criando-frameworks/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">
    <link rel="stylesheet" href="/css/odisseia.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">
    
    <!-- Share CSS -->
    <link rel="stylesheet" href="/css/share.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="A odisseia do puto" />

    

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">A odisseia do puto</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
				
                <li>
                    <a href="/about/">Sobre</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
    <div class="intro-header-overlay">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Criando frameworks para várias plataformas</h1>
                        
                        <span class="meta">Postado por Guilherme Martinez Sampaio em 25/03/2016</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="share">
  <li><a href="https://twitter.com/intent/tweet?text=Criando frameworks para várias plataformas&url=http://localhost:4000/frameworks/2016/03/25/criando-frameworks/" rel="nofollow" target="_blank" title="Share on Twitter"><i class="fa fa-twitter-square"></i></a></li>
  <li><a href="https://facebook.com/sharer.php?u=http://localhost:4000/frameworks/2016/03/25/criando-frameworks/" rel="nofollow" target="_blank" title="Share on Facebook"><i class="fa fa-facebook-square"></i></a></li>
  <li><a href="http://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/frameworks/2016/03/25/criando-frameworks/" rel="nofollow" target="_blank" title="Share on Linkedlin"><i class="fa fa-linkedin-square"></i></a></li>
  <li><a href="https://plus.google.com/share?url=http://localhost:4000/frameworks/2016/03/25/criando-frameworks/" rel="nofollow" target="_blank" title="Share on Google+"><i class="fa fa-google-plus-square"></i></a></li>
</ul>

				<blockquote>
  <p>Guilherme Sampaio <a href="https://twitter.com/gsampaio">@gsampaio</a> trabalha desenvolvendo apps para crianças no PlayKids. Gosta de boas práticas de engenharia de software e arquitetura de software.</p>
</blockquote>

<p>Durante o último ano tivemos o lançamento de duas novas plataformas de desenvolvimento da Apple: o tvOS e o watchOS. Com isso cada vez mais é importante compartilharmos código entre diversos projetos.</p>

<p>Assim, neste post iremos tratar de como criar e distribuir frameworks para várias plataformas, além de mostrar dicas de como melhorar a qualidade de seus frameworks. Mas antes disso, caso não tenha lido ainda o <a href="http://equinocios.com/library/2016/03/17/bibliotecas/">post do Igor</a> sobre bibliotecas, esta é uma ótima oportunidade!</p>

<h2 id="zen">Zen</h2>

<p>Para efeitos de demonstração, vamos criar um framework que simplesmente fará wrap da API Zen do Github. Toda vez que fizermos <code class="language-plaintext highlighter-rouge">GET</code> para esta API iremos receber de volta uma frase inspiradora. Para testar o seu funcionamento basta abrir o seu terminal e digitar <code class="language-plaintext highlighter-rouge">curl -X GET https://api.github.com/zen</code>.</p>

<p><img src="/img/gsampaio/zen.png" alt="" />
<span class="caption text-muted">Exemplo de uso da API</span></p>

<h3 id="criando-um-framework-para-ios">Criando um framework para iOS</h3>

<p>Começamos criando um novo workspace dentro do Xcode. Depois iremos criar dois projetos dentro deste workspace, um para o nosso framework iOS e outro para os projetos de exemplo.</p>

<p><img src="/img/gsampaio/workspace.png" alt="" />
<span class="caption text-muted">Workspace com os dois projetos</span></p>

<p>Após criar os dois projetos, vamos <strong>linkar</strong> o nosso framework dentro do nosso target de exemplo. Para isso basta clicar no projeto de exemplo e adicionar na sessão <strong>Linked Frameworks and Libraries</strong> o nosso framework. Note que como não iremos distribuir a app de exemplo, não teremos problema por ela não estar nos <em>Embedded Binaries</em>.</p>

<p>Agora que temos tudo pronto para compilar o Exemplo, vamos começar a implementar o nosso framework. Começamos criando dois arquivos, o primeiro <code class="language-plaintext highlighter-rouge">Zen.swift</code>, e o segundo <code class="language-plaintext highlighter-rouge">ZenResponse.swift</code>.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//  Zen.swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="c1">/// Type for request zen strings to github</span>
<span class="kd">public</span> <span class="kd">struct</span> <span class="kt">Zen</span> <span class="p">{</span>
    
    <span class="c1">/// Public initilizer</span>
    <span class="kd">public</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{}</span>
    
    <span class="c1">/// Fetches a Zen String from the Github API</span>
    <span class="c1">///</span>
    <span class="c1">/// - parameter session: NSURLSession to perform the request.</span>
    <span class="c1">/// Fallback to the sharedSession in case it is not provided</span>
    <span class="c1">///</span>
    <span class="c1">/// - parameter completion: Closure that receives a ZenResponse with the response of the network request</span>
    <span class="kd">public</span> <span class="kd">func</span> <span class="nf">retrieveZen</span><span class="p">(</span><span class="nv">session</span><span class="p">:</span> <span class="kt">NSURLSession</span> <span class="o">=</span> <span class="kt">NSURLSession</span><span class="o">.</span><span class="nf">sharedSession</span><span class="p">(),</span> <span class="nv">completion</span><span class="p">:</span> <span class="kt">ZenResponse</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">NSURL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://api.github.com/zen"</span><span class="p">)</span><span class="o">!</span>
        <span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">NSURLRequest</span><span class="p">(</span><span class="kt">URL</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">dataTask</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="nf">dataTaskWithRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">data</span> <span class="k">else</span> <span class="p">{</span>

                <span class="kt">NSOperationQueue</span><span class="o">.</span><span class="nf">mainQueue</span><span class="p">()</span><span class="o">.</span><span class="n">addOperationWithBlock</span> <span class="p">{</span>
                    <span class="nf">completion</span><span class="p">(</span><span class="o">.</span><span class="kt">Failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="k">return</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="k">let</span> <span class="nv">zenString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">NSUTF8StringEncoding</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">NSOperationQueue</span><span class="o">.</span><span class="nf">mainQueue</span><span class="p">()</span><span class="o">.</span><span class="n">addOperationWithBlock</span> <span class="p">{</span>
                    <span class="nf">completion</span><span class="p">(</span><span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="n">zenString</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kt">NSOperationQueue</span><span class="o">.</span><span class="nf">mainQueue</span><span class="p">()</span><span class="o">.</span><span class="n">addOperationWithBlock</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="kt">NSError</span><span class="p">(</span><span class="nv">domain</span><span class="p">:</span> <span class="s">"com.gsampaio.zen.error"</span><span class="p">,</span> <span class="nv">code</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">userInfo</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
                    <span class="nf">completion</span><span class="p">(</span><span class="o">.</span><span class="kt">Failure</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">dataTask</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note que por se tratar de um framework, temos que nos preocupar com a visibilidade dos nossos tipos. Swift tem como padrão a visibilidade <em>internal</em>, portanto como queremos que <code class="language-plaintext highlighter-rouge">Zen</code> seja exposto precisamos marcá-lo como <em>public</em>, bem como toda função que queremos expor para a aplicação que usará o nosso código.</p>

<p>Por conta disso, tivemos que criar um <code class="language-plaintext highlighter-rouge">public init()</code> mesmo que o Swift, por padrão, crie initializers para structs.</p>

<p>Como a nossa função <code class="language-plaintext highlighter-rouge">retrieveZen</code> retorna de forma assíncrona, criamos um enum <code class="language-plaintext highlighter-rouge">ZenResponse</code> que encapsula a lógica de sucesso e falha, como podemos ver no próximo snippet.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//  ZenResponse.swift</span>

<span class="kd">import</span> <span class="kt">Foundation</span>

<span class="kd">public</span> <span class="kd">enum</span> <span class="kt">ZenResponse</span> <span class="p">{</span>
    <span class="k">case</span> <span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span>
    <span class="k">case</span> <span class="kt">Failure</span><span class="p">(</span><span class="kt">NSError</span><span class="p">?)</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">ZenResponse</span> <span class="p">:</span> <span class="kt">Equatable</span> <span class="p">{}</span>

<span class="kd">public</span> <span class="kd">func</span> <span class="o">==</span><span class="p">(</span><span class="nv">lhs</span><span class="p">:</span> <span class="kt">ZenResponse</span><span class="p">,</span> <span class="nv">rhs</span><span class="p">:</span> <span class="kt">ZenResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="k">let</span> <span class="nv">leftZen</span><span class="p">),</span> <span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="k">let</span> <span class="nv">rightZen</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">leftZen</span> <span class="o">==</span> <span class="n">rightZen</span>
    <span class="k">case</span> <span class="p">(</span><span class="o">.</span><span class="kt">Failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">leftError</span><span class="p">),</span> <span class="o">.</span><span class="kt">Failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">rightError</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">leftError</span> <span class="o">==</span> <span class="n">rightError</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Este enumerador representa um sucesso com o tipo associado <code class="language-plaintext highlighter-rouge">String</code>, ou uma falha com um tipo associado <code class="language-plaintext highlighter-rouge">NSError?</code>. Estendemos o nosso tipo para conformar com Equatable, o que é uma <a href="https://developer.apple.com/videos/play/wwdc2015/414/?time=1115">boa prática para value types em swift</a></p>

<h3 id="projeto-de-exemplo">Projeto de Exemplo</h3>

<p>Com isso acabamos a implementação do nosso framework. Agora vamos implementar no view controller do exemplo uma maneira fácil de mostrar para os usuários do nosso framework como ele funciona. Para fins de demonstração, vamos colocar tudo dentro do próprio view controller. Na vida real considere separar a lógica de apresentação da lógica de network. <a href="http://equinocios.com/arquitetura/2016/03/08/minimizando-acoplamento-view-e-viewcontrollers/">O Diogo escreveu um post excelente</a> falando como arquitetar um app, recomendo dar uma olhada nele.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//  ViewController.swift</span>

<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">Zen</span>

<span class="kd">class</span> <span class="kt">ViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="k">let</span> <span class="nv">zen</span> <span class="o">=</span> <span class="kt">Zen</span><span class="p">()</span>
    <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">label</span><span class="p">:</span> <span class="kt">UILabel</span><span class="p">?</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidAppear</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">label</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
        <span class="n">zen</span><span class="o">.</span><span class="n">retrieveZen</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">zenResponse</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">zenResponse</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="k">let</span> <span class="nv">zenString</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"Zen: </span><span class="se">\(</span><span class="n">zenString</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
                <span class="k">self</span><span class="p">?</span><span class="o">.</span><span class="n">label</span><span class="p">?</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">zenString</span>
            <span class="k">case</span> <span class="o">.</span><span class="kt">Failure</span><span class="p">(</span><span class="k">let</span> <span class="nv">error</span><span class="p">):</span>
                <span class="nf">print</span><span class="p">(</span><span class="s">"error: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fazendo algumas alterações no Storyboard conseguimos chegar a um exemplo parecido com a imagem abaixo. 
<img src="/img/gsampaio/exemplo-ios.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<h3 id="criando-um-framework-para-tv">Criando um framework para TV</h3>

<p>Uma vez que temos o nosso framework para iOS, vamos criar um framework para tvOS. Crie um target <em>TV Framework</em> no projeto Zen. Após criar o framework vai no <em>Build Settings</em> e altere o <em>Product Name</em> para <em>Zen</em>.</p>

<p><img src="/img/gsampaio/tvos-framework.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p>Como não estamos usando nenhuma API que não está disponível em ambas as plataformas, podemos adicionar diretamente ao framework tvOS os arquivos <code class="language-plaintext highlighter-rouge">Zen.swift</code> e <code class="language-plaintext highlighter-rouge">ZenResponse.swift</code>.</p>

<p><img src="/img/gsampaio/target-membership.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p>Caso fosse necessário no futuro diversificar o que esta disponível para cada plataforma, poderíamos usar as marcações de OS ou availability como mostro abaixo.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#if os(tvOS)</span>

<span class="c1">// Código que será disponível apenas para tvOS</span>

<span class="cp">#endif</span>

<span class="k">if</span> <span class="kd">#available(tvOS 9.1, *)</span> <span class="p">{</span>
    <span class="c1">// Código disponível apenas para tvOS 9.1 para frente</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Pronto, com isso temos o nosso framework tvOS. Agora podemos criar outro projeto de exemplo para tvOS e colocar o mesmo código do ViewController de exemplo do iOS, e chegamos ao resultado abaixo.</p>

<p><img src="/img/gsampaio/exemplo-tvos.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<h2 id="distribuindo-seu-framework">Distribuindo seu framework</h2>

<p>Agora que temos os nossos frameworks prontos, vamos pensar em como distribuí-los. Para isso daremos suporte tanto ao Carthage quanto ao CocoaPods, que são os dois gerenciadores de dependência mais utilizados pela comunidade.</p>

<h3 id="carthage">Carthage</h3>

<p>O <a href="https://github.com/Carthage/Carthage">Carthage</a> é um gerenciador de dependência para iOS/OSX/watchOS/tvOS que não tem um repositório central de dependências. Para utilizá-lo você precisa criar um <code class="language-plaintext highlighter-rouge">Cartfile</code> no seu projeto e adicionar as referências ao repositórios que deseja utilizar. Ao rodar <code class="language-plaintext highlighter-rouge">carthage update</code> no seu projeto, o Carthage irá fazer checkout de todas as dependências e procurar por shared build schemes dentro dos projetos das dependências, buildando um a um.</p>

<p>Para adicionarmos o suporte ao Carthage, a única alteração que vamos ter que fazer no nosso workspace é fazer com que nossos frameworks estejam com seu build scheme marcados com <em>Shared</em>. Para isso vá em <em>Product</em> &gt; <em>Scheme</em> &gt; <em>Manage Schemes</em> e marque ambos os frameworks como shared.</p>

<p><img src="/img/gsampaio/shared-schemes.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p>Pronto. Para testar basta criar um novo projeto do Xcode, criar um <code class="language-plaintext highlighter-rouge">Cartfile</code>, adicionar a referência para o repositório que contém o framework e rodar <code class="language-plaintext highlighter-rouge">carthage update</code>. Depois disso, teremos uma nova pasta Carthage no seu diretório com duas pastas: Build e Checkouts. Na pasta Build você encontrará ambos os framework buildados.</p>

<h3 id="cocoapods">CocoaPods</h3>

<p>CocoaPods é o gerenciador de dependências mais famoso para desenvolvimento para as plataformas da Apple. Diferente do Carthage, o CocoaPods contém um repositório central de <code class="language-plaintext highlighter-rouge">pods</code>, fazendo a integração automática e criando um workspace onde todas as dependências são compiladas junto com o seu projeto.</p>

<p>Para permitir o uso do CocoaPods precisamos criar um <code class="language-plaintext highlighter-rouge">podspec</code>, que indica quais arquivos serão usados para buildar os frameworks:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Pod</span><span class="o">::</span><span class="no">Spec</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">name</span>         <span class="o">=</span> <span class="s2">"Zen"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">version</span>      <span class="o">=</span> <span class="s2">"0.0.1"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">summary</span>      <span class="o">=</span> <span class="s2">"Swift implementation of the Zen API from Github"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">description</span>  <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">DESC</span><span class="sh">
    Zen provides an easy way to access the Zen API provided by folks at Github
</span><span class="no">  DESC</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">homepage</span> <span class="o">=</span> <span class="s2">"http://github.com/gsampaio/Zen"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">license</span> <span class="o">=</span> <span class="s2">"MIT"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">author</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"Guilherme Sampaio"</span> <span class="o">=&gt;</span> <span class="s2">"guilhermesampaio@gmail.com"</span> <span class="p">}</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">social_media_url</span> <span class="o">=</span> <span class="s2">"http://twitter.com/gsampaio"</span>
  
  <span class="n">s</span><span class="p">.</span><span class="nf">ios</span><span class="p">.</span><span class="nf">deployment_target</span> <span class="o">=</span> <span class="s2">"8.0"</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">tvos</span><span class="p">.</span><span class="nf">deployment_target</span> <span class="o">=</span> <span class="s2">"9.0"</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">source</span>       <span class="o">=</span> <span class="p">{</span> <span class="ss">:git</span> <span class="o">=&gt;</span> <span class="s2">"https://github.com/gsampaio/Zen.git"</span><span class="p">,</span> <span class="ss">:tag</span> <span class="o">=&gt;</span> <span class="s2">"0.0.1"</span> <span class="p">}</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">source_files</span>  <span class="o">=</span> <span class="s2">"Zen/Zen/*.{swift}"</span>

  <span class="n">s</span><span class="p">.</span><span class="nf">requires_arc</span> <span class="o">=</span> <span class="kp">true</span>
<span class="k">end</span>

</code></pre></div></div>

<p>Agora, basta criar um novo projeto e um <code class="language-plaintext highlighter-rouge">Podfile</code>, adicionando a linha <code class="language-plaintext highlighter-rouge">pod 'Zen', :path=&gt; "path do nosso podspec"</code>.</p>

<h2 id="utilitários">Utilitários</h2>

<p>Agora que sabemos como criamos e distribuímos frameworks, iremos plugar alguma ferramentas que irão ajudar na qualidade. Nesta sessão vamos abordar <strong>Testes Unitários e Cobertura</strong>, <strong>Documentação</strong> e <strong>Integração Contínua</strong>.</p>

<h3 id="testes-unitários-e-cobertura-de-código">Testes unitários e cobertura de código.</h3>

<p>Para termos certeza - ou ao menos segurança - que o nosso código funciona, vamos adicionar casos de testes aos nossos frameworks e depois vamos gerar relatórios de cobertura para entender melhor quais partes do nosso código estamos testando.</p>

<h4 id="testes-unitários">Testes Unitários</h4>

<p>Vamos começar implementando testes no arquivo <code class="language-plaintext highlighter-rouge">ZenTests.swift</code>, dentro do target <code class="language-plaintext highlighter-rouge">ZenTests</code>. Para executar os testes, vamos criar uma fake classe de <code class="language-plaintext highlighter-rouge">NSURLSession</code> e <code class="language-plaintext highlighter-rouge">NSURLSessionDataTask</code> para mockar seu funcionamento e injetarmos o resultado que queremos.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//  ZenTests.swift</span>

<span class="kd">import</span> <span class="kt">XCTest</span>
<span class="kd">@testable</span> <span class="kd">import</span> <span class="kt">Zen</span>

<span class="kd">class</span> <span class="kt">ZenTests</span><span class="p">:</span> <span class="kt">XCTestCase</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">testSuccess</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">string</span> <span class="o">=</span> <span class="s">"Practicality beats purity."</span> <span class="k">as</span> <span class="kt">NSString</span>
        <span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="nf">dataUsingEncoding</span><span class="p">(</span><span class="kt">NSUTF8StringEncoding</span><span class="p">)</span><span class="o">!</span>
        
        <span class="k">let</span> <span class="nv">zen</span> <span class="o">=</span> <span class="kt">Zen</span><span class="p">()</span>
        <span class="n">zen</span><span class="o">.</span><span class="nf">retrieveZen</span><span class="p">(</span><span class="kt">FakeURLSession</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">))</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
            <span class="k">switch</span> <span class="n">response</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="nv">zen</span><span class="p">:</span> <span class="k">let</span> <span class="nv">zenString</span><span class="p">):</span>
                <span class="kt">XCTAssertEqual</span><span class="p">(</span><span class="n">zenString</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="kt">XCTFail</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">FakeURLSession</span> <span class="p">:</span> <span class="kt">NSURLSession</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">NSData</span>
    
    <span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">NSData</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="k">override</span> <span class="kd">func</span> <span class="nf">dataTaskWithRequest</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="kt">NSURLRequest</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">NSData</span><span class="p">?,</span> <span class="kt">NSURLResponse</span><span class="p">?,</span> <span class="kt">NSError</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">NSURLSessionDataTask</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="kt">FakeURLSessionDataTask</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="n">completionHandler</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">private</span> <span class="kd">final</span> <span class="kd">class</span> <span class="kt">FakeURLSessionDataTask</span> <span class="p">:</span> <span class="kt">NSURLSessionDataTask</span> <span class="p">{</span>
    
    <span class="k">let</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">NSData</span><span class="p">?</span>
    <span class="k">let</span> <span class="nv">completion</span><span class="p">:</span> <span class="p">(</span><span class="kt">NSData</span><span class="p">?,</span> <span class="kt">NSURLResponse</span><span class="p">?,</span> <span class="kt">NSError</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span>
    <span class="nf">init</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="kt">NSData</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">(</span><span class="kt">NSData</span><span class="p">?,</span> <span class="kt">NSURLResponse</span><span class="p">?,</span> <span class="kt">NSError</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">self</span><span class="o">.</span><span class="n">completion</span> <span class="o">=</span> <span class="n">completionHandler</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="k">override</span> <span class="kd">func</span> <span class="nf">resume</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">completion</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Não vou entrar em mais detalhes sobre a implementação de testes de network, mas caso você tenha mais interesse, recomendo dar uma olhada no <a href="http://github.com/venmo/DVR">DVR</a> e no <a href="https://github.com/AliSoftware/OHHTTPStubs">OHHTTPStubs</a>.</p>

<h4 id="cobertura-de-testes">Cobertura de testes</h4>

<p>Uma das mudanças do Xcode 7 foi a integração de cobertura de testes dentro da IDE. Para isso, precisamos editar o scheme Zen, marcar <code class="language-plaintext highlighter-rouge">Gather coverage data</code> na área de <code class="language-plaintext highlighter-rouge">Test</code> do scheme Zen, como ilustra a imagem abaixo:</p>

<p><img src="/img/gsampaio/cobertura-xcode.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p>Rodando nossos testes unitários, agora é possível olhar a cobertura dentro do próprio Xcode.</p>

<p><img src="/img/gsampaio/xcode-cobertura.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<h4 id="slather">Slather</h4>

<p><a href="https://github.com/SlatherOrg/slather">Slather</a> é uma ferramenta para gerar relatórios de cobertura de código. Com ele, é possível gerar relatórios HTML para visualizar cobertura de testes, assim como relatórios XML para uso em ambientes de integração contínua.</p>

<p>Para fins de exemplo, iremos gerar um HTML com o relatório de cobertura. Para isso, basta instalar o Slather e rodar o comando abaixo:</p>

<p><code class="language-plaintext highlighter-rouge">slather coverage --html --show Zen/Zen.xcodeproj</code></p>

<p><img src="/img/gsampaio/slather.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<p>Caso exista interesse, é possível plugar o slather dentro do seu ambiente de integração continua e enviar relatórios de cobertura para serviços como o <a href="https://coveralls.io">Coveralls</a>, e assim acompanhar a evolução da cobertura do seu projeto. Um exemplo é o <a href="https://github.com/venmo/VENCore">VENCore</a>, que tem <a href="https://coveralls.io/github/venmo/VENCore">seus relatórios de cobertura</a> publicados.</p>

<h3 id="documentação">Documentação</h3>

<p>Uma vez que temos testes unitários e relatórios de cobertura, queremos agora garantir que conseguimos gerar a documentação para que seja mais fácil utilizar o nosso framework.</p>

<p>Caso você não seja familiar com o formato de documentação do Swift, recomendo dar uma olhada <a href="http://ericasadun.com/2015/06/14/swift-header-documentation-in-xcode-7/">neste post da Erika Sadun</a>. Talvez você tenha percebido que o arquivo <code class="language-plaintext highlighter-rouge">Zen.swift</code> já esta documentado com Swift Header Documentation.</p>

<p>Outro ponto importante de documentação é escrever um <code class="language-plaintext highlighter-rouge">README.md</code> bem explicativo para que as pessoas que encontrarem o seu framework saibam exatamente o que ele faz e todas as suas capacidades. O <a href="https://github.com/Alamofire/Alamofire">Alamofire</a> tem um excelente <code class="language-plaintext highlighter-rouge">README.md</code> para se inspirar.</p>

<h4 id="jazzy-">Jazzy ♪♫</h4>

<p>Para gerar documentação HTML e ser compatível com o <a href="http://cocoadocs.org">CocoaDocs</a> vamos utilizar o <a href="https://github.com/realm/jazzy">Jazzy</a>. Uma vez documentado o seu framework, basta instalarmos o Jazzy e rodarmos o comando abaixo para gerar o HTML:</p>

<p><code class="language-plaintext highlighter-rouge">jazzy -x -scheme,Zen</code></p>

<p><img src="/img/gsampaio/jazzy.png" alt="" style="display: block; margin-left: auto; margin-right: auto;" /></p>

<h3 id="integração-contínua">Integração contínua</h3>

<p>Por fim, agora que temos testes e documentação, queremos ter um processo de integração contínua para nos ajudar em tasks relacionadas ao nosso framework. Para isso recomendo dar uma olhada no <a href="https://travis-ci.org">Travis CI</a>, no <a href="https://circleci.com">Circle CI</a> ou no <a href="https://jenkins-ci.org">Jenkins</a> para executar as suas tasks.</p>

<h4 id="fastlane">Fastlane</h4>

<p>Nesta última semana tivemos <a href="http://equinocios.com/ios/2016/03/24/fastlane/">um excelente post sobre o fastlane</a> feito pelo <a href="http://www.twitter.com/fabintk">Fábio</a>. Assim, não entrarei muito em detalhes, apenas listarei algumas actions que podem ajudar no test/deploy do seu framework.</p>

<table>
  <thead>
    <tr>
      <th>Action</th>
      <th>Descrição</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">set_github_release</code></td>
      <td>Cria uma release nova no github. É útil para distribuir frameworks compilados pelo carthage</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">pod_push</code></td>
      <td>Faz deploy do seu podspec para o trunk ou para um repositório privado do cocoapods</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">slather</code></td>
      <td>Executa o slather para gerar coverage reports</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">jazzy</code></td>
      <td>Executa o jazzy para gerar documentação</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">scan</code></td>
      <td>Roda os unit tests da sua framework</td>
    </tr>
  </tbody>
</table>

<h2 id="considerações-finais">Considerações finais</h2>

<p>Gosto muito do conceito de criar frameworks pequenos e ir expandindo a sua aplicação em cima deles. Recomendo assistir a talk sobre <a href="https://realm.io/news/justin-spahr-summers-library-oriented-programming/">Library Oriented Programming</a> do Justin Spahr Summers, que conta sobre desenvolver frameworks.</p>

<p>Por fim, muitas das práticas que aplicamos nestes frameworks são aplicáveis ao seus aplicativos. Testes/Cobertura e Integração contínua são excelentes exemplos.</p>

<p>Se tiverem alguma dúvida me procurem no <a href="https://twitter.com/gsampaio">twitter</a> ou no slack do <a href="http://iosdevbr.herokuapp.com/">iOSDevBR</a>.</p>

<p>Espero que tenham gostado!</p>



                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/optionals/2016/03/24/optionals-e-o-gato-de-schrodinger/" data-toggle="tooltip" data-placement="top" title="Optionals e o Gato de Schrödinger">&larr; Post Anterior</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/extensions/2016/03/26/app-extension-today-widget/" data-toggle="tooltip" data-placement="top" title="App Extension - Today Widget">Próximo Post &rarr;</a>
                    </li>
                    
                </ul>

                <!-- Disqus Content -->

                <div id="disqus_thread">
                    <script>
                        /**
                        * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
                        * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
                        */

                        /*
                        var disqus_config = function () {
                            this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
                            this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
                        };
                        */

                        (function() { // DON'T EDIT BELOW THIS LINE
                        var d = document, s = d.createElement('script');

                        s.src = '//equinocios.disqus.com/embed.js';

                        s.setAttribute('data-timestamp', +new Date());
                        (d.head || d.body).appendChild(s);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
                </div>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                </ul>
                <p class="copyright text-muted">A odisseia do puto — Raimundo Pessoa & Frederico Do</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


</body>

</html>
